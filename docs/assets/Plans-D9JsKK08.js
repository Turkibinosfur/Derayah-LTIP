import{a as He,s as P,j as e}from"./index-DDk1oefv.js";import{u as Be,r as g,a as Ye}from"./react-vendor-xiFAdxLt.js";import{f as ge}from"./dateUtils-DoPl8O0G.js";import{w as pe,F as fe,c as Oe,U as _e,P as be,n as ye,o as ve,C as Ve,z as Fe,H as Xe,K as ze}from"./ui-vendor-B0ZOy8uN.js";import"./supabase-vendor-B-LuImWU.js";function Je(){const{t:c,i18n:je}=He(),p=je.language==="ar",Ne=Be(),[w,we]=g.useState([]),[R,Pe]=g.useState([]),[ee,Se]=g.useState([]),[Ce,Le]=g.useState(!0),[ke,K]=g.useState(!1),[V,te]=g.useState(null),[re,ie]=g.useState(null),[se,oe]=g.useState(null),[ce,ae]=g.useState(null),[F,Te]=g.useState({total:0,allocated:0}),[$,Ae]=g.useState({total:0,allocated:0,available:0}),[Q,B]=g.useState(""),[X,de]=g.useState(!1),[Y,D]=g.useState(null),[le,U]=g.useState(null),[M,ne]=g.useState(null),E=g.useRef(null),[z,ue]=g.useState(!1),[O,q]=g.useState(null),[G,I]=g.useState(null),[L,Z]=g.useState(null),T=g.useRef(null),[s,o]=g.useState({plan_name_en:"",plan_name_ar:"",plan_type:"LTIP_RSU",plan_code:"",description_en:"",description_ar:"",vesting_schedule_type:"time_based",vesting_schedule_template_id:"",ltip_pool_id:"",total_shares_allocated:0,start_date:"",end_date:"",status:"active",vesting_years:4,cliff_months:12,vesting_frequency:"monthly"});g.useEffect(()=>{J()},[]),g.useEffect(()=>{if(s.vesting_schedule_template_id&&R.length>0){const t=R.find(l=>l.id===s.vesting_schedule_template_id);if(t){const l={vesting_years:Math.floor(t.total_duration_months/12),cliff_months:t.cliff_months,vesting_frequency:t.vesting_frequency};if(s.start_date){const n=new Date(s.start_date),a=new Date(n);a.setMonth(a.getMonth()+t.total_duration_months),l.end_date=a.toISOString().split("T")[0]}o(n=>({...n,...l}))}}},[s.vesting_schedule_template_id,s.start_date,R]),g.useEffect(()=>{if(s.start_date&&s.vesting_schedule_template_id&&R.length>0){const t=R.find(l=>l.id===s.vesting_schedule_template_id);if(t){const l=new Date(s.start_date),n=new Date(l);n.setMonth(n.getMonth()+t.total_duration_months),o(a=>({...a,end_date:n.toISOString().split("T")[0]}))}}},[s.start_date,s.vesting_schedule_template_id,R]);const J=async()=>{try{const{data:{user:t}}=await P.auth.getUser();if(!t)return;const{data:l}=await P.from("company_users").select("company_id").eq("user_id",t.id).single();if(l){const[n,a,d,f,b]=await Promise.all([P.from("incentive_plans").select("*").eq("company_id",l.company_id).order("created_at",{ascending:!1}),P.from("shareholders").select("shares_owned").eq("company_id",l.company_id).eq("shareholder_type","employee").eq("is_active",!0),P.from("incentive_plans").select("total_shares_allocated").eq("company_id",l.company_id).eq("status","active"),P.from("vesting_schedules").select("*").eq("company_id",l.company_id).eq("is_template",!0).order("created_at",{ascending:!1}),P.from("ltip_pools").select("*").eq("company_id",l.company_id).eq("status","active").order("created_at",{ascending:!1})]);if(n.error)throw n.error;if(f.data&&Pe(f.data),b.data){Se(b.data);const h=b.data.reduce((m,k)=>({total:m.total+Number(k.total_shares_allocated||0),allocated:m.allocated+Number(k.shares_used||0),available:m.available+Number(k.shares_available||0)}),{total:0,allocated:0,available:0});Ae(h)}const A=await Promise.all((n.data||[]).map(async h=>{const{data:m}=await P.from("grants").select("id, total_shares, status, grant_number, employee_id").eq("plan_id",h.id),k=(m==null?void 0:m.reduce((r,u)=>r+Number(u.total_shares||0),0))||0;let i=0;const y=(m||[]).map(r=>r.id).filter(Boolean);if(y.length>0){const{data:r}=await P.from("vesting_events").select("grant_id, shares_to_vest, status").in("grant_id",y),u=["vested","transferred","exercised"];i=(r==null?void 0:r.reduce((_,x)=>u.includes(x.status)?_+Number(x.shares_to_vest||0):_,0))||0}h.plan_name_en==="Derayah Employee Stock Plan 2025"&&(console.log("=== DEBUGGING DERAYAH EMPLOYEE STOCK PLAN 2025 ==="),console.log("Plan ID:",h.id),console.log("Plan Name:",h.plan_name_en),console.log("Plan Total Allocated:",h.total_shares_allocated),console.log("Grants Data:",m),console.log("Number of grants found:",(m==null?void 0:m.length)||0),console.log("Actual Granted (calculated):",k),console.log("Plan Shares Granted (stored):",h.shares_granted),console.log("Plan Shares Available (stored):",h.shares_available),m&&m.length>0?m.forEach((r,u)=>{console.log(`Grant ${u+1}:`,{grant_number:r.grant_number,total_shares:r.total_shares,status:r.status,employee_id:r.employee_id})}):(console.log("No grants found for this plan!"),console.log("This could mean:"),console.log("1. No grants exist for this plan"),console.log("2. Grants exist but have different plan_id"),console.log("3. Database connection issue")));const S=h.total_shares_allocated-k;return{...h,actual_shares_granted:k,actual_shares_available:Math.max(0,S),actual_shares_vested:i}}));we(A);const j=(a.data||[]).reduce((h,m)=>h+Number(m.shares_owned),0),N=(d.data||[]).reduce((h,m)=>h+Number(m.total_shares_allocated),0);Te({total:j,allocated:N})}}catch(t){console.error("Error loading plans:",t)}finally{Le(!1)}},W=()=>{ie(null),oe(null)},xe=(t,l,n)=>{if(l){const a=ee.find(f=>f.id===l);if(!a)return B("Selected LTIP Pool not found"),!1;let d=a.shares_available;if(n){const f=w.find(b=>b.id===n);f&&f.ltip_pool_id===l&&(d+=f.total_shares_allocated)}if(t>d)return B(`Cannot allocate ${t.toLocaleString()} shares. Only ${d.toLocaleString()} shares available in LTIP pool "${a.pool_name_en}" (Pool Total: ${a.total_shares_allocated.toLocaleString()}, Used: ${a.shares_used.toLocaleString()})`),!1}else{F.total-F.allocated;let a=F.allocated;if(n){const f=w.find(b=>b.id===n);f&&(a-=f.total_shares_allocated)}const d=F.total-a;if(t>d)return B(`Cannot allocate ${t.toLocaleString()} shares. Only ${d.toLocaleString()} shares available from Employee shares in Cap Table (Total: ${F.total.toLocaleString()}, Already Allocated: ${a.toLocaleString()})`),!1}return B(""),!0},$e=async()=>{if(!s.plan_name_en.trim()){alert("Plan name (English) is required");return}if(!s.plan_code.trim()){alert("Plan code is required");return}if(!s.start_date){alert("Start date is required");return}if(!s.ltip_pool_id){alert("LTIP pool is required. Please select an LTIP pool for this plan.");return}if(s.total_shares_allocated<=0){alert("Total shares allocated must be greater than 0");return}if(xe(s.total_shares_allocated,s.ltip_pool_id))try{const{data:{user:t}}=await P.auth.getUser();if(!t)return;const{data:l}=await P.from("company_users").select("company_id, id").eq("user_id",t.id).single();if(!l)return;const n={years:s.vesting_years,cliff_months:s.cliff_months,frequency:s.vesting_frequency},a={company_id:l.company_id,plan_name_en:s.plan_name_en,plan_name_ar:s.plan_name_ar||s.plan_name_en,plan_type:s.plan_type,plan_code:s.plan_code,description_en:s.description_en,description_ar:s.description_ar,vesting_schedule_type:s.vesting_schedule_type,vesting_config:n,total_shares_allocated:s.total_shares_allocated,shares_available:s.total_shares_allocated,status:s.status,start_date:s.start_date,end_date:s.end_date||null,created_by:l.id};s.vesting_schedule_template_id&&(a.vesting_schedule_template_id=s.vesting_schedule_template_id),a.ltip_pool_id=s.ltip_pool_id;const{error:d}=await P.from("incentive_plans").insert(a);if(d)throw console.error("Plan creation error:",d),d;K(!1),B(""),o({plan_name_en:"",plan_name_ar:"",plan_type:"LTIP_RSU",plan_code:"",description_en:"",description_ar:"",vesting_schedule_type:"time_based",vesting_schedule_template_id:"",ltip_pool_id:"",total_shares_allocated:0,start_date:"",end_date:"",status:"draft",vesting_years:4,cliff_months:12,vesting_frequency:"monthly"}),J()}catch(t){console.error("Error creating plan:",t),t&&typeof t=="object"&&"message"in t?alert(`Failed to create plan: ${t.message}`):alert("Failed to create plan. Please check the console for details.")}},Ee=async t=>{try{const{error:l}=await P.from("incentive_plans").delete().eq("id",t);if(l)throw l;ae(null),J()}catch(l){console.error("Error deleting plan:",l),alert("Failed to delete plan")}},Ie=t=>{var l,n,a,d;te(t),o({plan_name_en:t.plan_name_en,plan_name_ar:"",plan_type:t.plan_type,plan_code:t.plan_code,description_en:"",description_ar:"",vesting_schedule_type:((l=t.vesting_config)==null?void 0:l.type)||"time_based",vesting_schedule_template_id:t.vesting_schedule_template_id||"",ltip_pool_id:t.ltip_pool_id||"",vesting_years:((n=t.vesting_config)==null?void 0:n.vesting_years)||4,cliff_months:((a=t.vesting_config)==null?void 0:a.cliff_months)||12,vesting_frequency:((d=t.vesting_config)==null?void 0:d.frequency)||"monthly",total_shares_allocated:t.total_shares_allocated,start_date:t.start_date,end_date:t.end_date||"",status:t.status}),W()},Re=async()=>{if(V){if(!s.ltip_pool_id){alert("LTIP pool is required. Please select an LTIP pool for this plan.");return}if(xe(s.total_shares_allocated,s.ltip_pool_id,V.id))try{const t={type:s.vesting_schedule_type,vesting_years:s.vesting_years,cliff_months:s.cliff_months,frequency:s.vesting_frequency},l={plan_name_en:s.plan_name_en,plan_type:s.plan_type,plan_code:s.plan_code,vesting_config:t,total_shares_allocated:s.total_shares_allocated,start_date:s.start_date,end_date:s.end_date||null,status:s.status};s.vesting_schedule_template_id&&(l.vesting_schedule_template_id=s.vesting_schedule_template_id),s.ltip_pool_id&&(l.ltip_pool_id=s.ltip_pool_id);const{error:n}=await P.from("incentive_plans").update(l).eq("id",V.id);if(n)throw console.error("Plan update error:",n),n;te(null),B(""),o({plan_name_en:"",plan_name_ar:"",plan_type:"LTIP_RSU",plan_code:"",description_en:"",description_ar:"",vesting_schedule_type:"time_based",vesting_schedule_template_id:"",ltip_pool_id:"",total_shares_allocated:0,start_date:"",end_date:"",status:"draft",vesting_years:4,cliff_months:12,vesting_frequency:"monthly"}),J()}catch(t){console.error("Error updating plan:",t),alert("Failed to update plan")}}},he=t=>{W(),Ne(`/dashboard/grants?plan_id=${t.id}&plan_name=${encodeURIComponent(t.plan_name_en)}`)},Me={LTIP_RSU:"bg-blue-100 text-blue-800",LTIP_RSA:"bg-purple-100 text-purple-800",LTIP_ESOP:"bg-green-100 text-green-800"},qe={draft:"bg-gray-100 text-gray-800",active:"bg-green-100 text-green-800",closed:"bg-red-100 text-red-800",suspended:"bg-yellow-100 text-yellow-800"},me=w.reduce((t,l)=>t+Number(l.total_shares_allocated||0),0),De=w.reduce((t,l)=>t+Number((l.actual_shares_granted??l.shares_granted)||0),0),Ue=w.reduce((t,l)=>t+Number((l.actual_shares_available??l.shares_available??l.total_shares_allocated-(l.actual_shares_granted??0))||0),0);return Ce?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:`space-y-6 ${p?"text-right":"text-left"}`,children:[e.jsxs("div",{className:`flex items-center justify-between ${p?"flex-row-reverse":""}`,children:[e.jsxs("div",{children:[e.jsxs("h1",{className:`text-3xl font-bold text-gray-900 flex items-center gap-3 ${p?"flex-row-reverse":""}`,children:[c("plans.title"),e.jsx("span",{className:"inline-flex items-center justify-center w-10 h-10 rounded-full bg-blue-600 text-white text-lg font-semibold",children:w.length})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:c("plans.description")})]}),e.jsxs("button",{onClick:()=>K(!0),className:`flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition ${p?"space-x-reverse":""}`,children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:c("plans.createNewPlan")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(fe,{className:"w-6 h-6 text-blue-600"})}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(Oe,{className:"w-6 h-6 text-green-600"})})]}),e.jsxs("div",{className:p?"text-left":"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500",children:c("plans.totalPlans")}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:w.length})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:c("plans.active")}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[w.filter(t=>t.status==="active").length," / ",w.length]})]}),(()=>{const t=w.filter(a=>a.status==="active").length,l=w.length||1,n=Math.round(t/l*100);return e.jsxs("div",{children:[e.jsx("div",{className:"w-full h-2 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-2 bg-green-500 rounded-full",style:{width:`${n}%`,transition:"width 200ms linear"}})}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:[n,"% ",c("plans.activePercent")]})]})})()]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-slate-100 rounded-lg",children:e.jsx(_e,{className:"w-6 h-6 text-slate-600"})}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:$.total.toLocaleString()})]}),e.jsx("p",{className:"text-gray-600 font-medium mb-2",children:c("plans.ltipPool")}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[c("plans.totalAllocated"),":"]}),e.jsx("span",{className:"text-sm font-bold text-gray-900",children:$.total.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[c("plans.plannedShares"),":"]}),e.jsx("span",{className:"text-sm font-bold text-gray-900",children:me.toLocaleString()})]}),e.jsxs("div",{className:p?"pr-4":"pl-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-[11px] text-gray-500",children:[c("plans.granted"),":"]}),e.jsx("span",{className:"text-xs font-medium text-gray-900",children:De.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-[11px] text-gray-500",children:[c("plans.ungranted"),":"]}),e.jsx("span",{className:"text-xs font-medium text-gray-900",children:Ue.toLocaleString()})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[c("plans.availableToPlan"),":"]}),e.jsx("span",{className:"text-sm font-bold text-green-600",children:$.available.toLocaleString()})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx("div",{children:e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{onClick:()=>ue(!z),className:"flex items-center justify-between mb-4 cursor-pointer hover:bg-gray-50 transition p-2 -m-2 rounded",title:z?"Collapse legend":"Expand legend",role:"button",tabIndex:0,onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),ue(!z))},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-3 bg-cyan-100 rounded-lg",children:e.jsx(be,{className:"w-6 h-6 text-cyan-600"})}),e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"LTIP Pool vs Planned"})]}),e.jsx("div",{className:"text-gray-500",children:z?e.jsx(ye,{className:"w-5 h-5"}):e.jsx(ve,{className:"w-5 h-5"})})]}),(()=>{const t=$.total||0,l=me||0,n=Math.max(0,t-l),a=t||1;if(t===0)return e.jsx("div",{className:"flex items-center justify-center h-40 text-gray-400 text-sm",children:"No LTIP pool data"});const d=l/a*100,f=n/a*100,b=l/a*360,A=n/a*360,j=-90,N=j+b,h=N,m=h+A,k=(i,y,S)=>{const r=i*(Math.PI/180),u=y*(Math.PI/180),_=60+50*Math.cos(r),x=60+50*Math.sin(r),v=60+50*Math.cos(u),C=60+50*Math.sin(u),H=S>180?1:0;return`M 60 60 L ${_} ${x} A 50 50 0 ${H} 1 ${v} ${C} Z`};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{ref:T,className:"relative w-full h-40 flex items-center justify-center",onClick:i=>{(i.target===i.currentTarget||i.target.tagName==="svg")&&(Z(null),I(null),q(null))},children:[e.jsxs("svg",{viewBox:"0 0 120 120",className:"w-full max-w-40 h-40 cursor-pointer",onMouseLeave:()=>{q(null),L||I(null)},children:[l>0&&(()=>{const i=L==="Planned Shares",y=G==="Planned Shares",S=L?!i:G!==null&&!y;return e.jsx("path",{d:k(j,N,b),fill:"#3b82f6",stroke:"white",strokeWidth:i||y?3:2,className:"cursor-pointer",style:{opacity:i?1:S?.3:y?1:.85,filter:i||y?"brightness(1.2)":L?"brightness(0.5)":"none",transition:"none"},onMouseEnter:r=>{if(T.current){const u=T.current.getBoundingClientRect(),_=r.clientX-u.left,x=r.clientY-u.top;q({label:"Planned Shares",value:l,percentage:d,x:_,y:x}),L||I("Planned Shares")}},onClick:r=>{if(r.stopPropagation(),T.current){const u=T.current.getBoundingClientRect(),_=r.clientX-u.left,x=r.clientY-u.top;q({label:"Planned Shares",value:l,percentage:d,x:_,y:x})}Z(u=>{const _=u==="Planned Shares"?null:"Planned Shares";return I(_),_})}})})(),n>0&&(()=>{const i=L==="Unplanned Shares",y=G==="Unplanned Shares",S=L?!i:G!==null&&!y;return e.jsx("path",{d:k(h,m,A),fill:"#94a3b8",stroke:"white",strokeWidth:i||y?3:2,className:"cursor-pointer",style:{opacity:i?1:S?.3:y?1:.85,filter:i||y?"brightness(1.2)":L?"brightness(0.5)":"none",transition:"none"},onMouseEnter:r=>{if(T.current){const u=T.current.getBoundingClientRect(),_=r.clientX-u.left,x=r.clientY-u.top;q({label:"Unplanned Shares",value:n,percentage:f,x:_,y:x}),L||I("Unplanned Shares")}},onClick:r=>{if(r.stopPropagation(),T.current){const u=T.current.getBoundingClientRect(),_=r.clientX-u.left,x=r.clientY-u.top;q({label:"Unplanned Shares",value:n,percentage:f,x:_,y:x})}Z(u=>{const _=u==="Unplanned Shares"?null:"Unplanned Shares";return I(_),_})}})})(),e.jsx("circle",{cx:"60",cy:"60",r:"30",fill:"white"}),(()=>{const i=t.toLocaleString(),y=i.length>12?"9":i.length>9?"10":i.length>6?"11":"12";return e.jsx("text",{x:"60",y:"56",textAnchor:"middle",className:"font-bold",fill:"#111827",fontSize:y,children:i})})(),e.jsx("text",{x:"60",y:"70",textAnchor:"middle",fill:"#6b7280",fontSize:"9",children:"Total Pool"})]}),O&&e.jsxs("div",{className:"absolute z-10 bg-gray-900 text-white text-xs rounded-lg px-3 py-2 shadow-lg pointer-events-none whitespace-nowrap",style:{left:`${O.x+10}px`,top:`${O.y-10}px`,transform:"translate(-50%, -100%)"},children:[e.jsx("div",{className:"font-semibold",children:O.label}),e.jsxs("div",{className:"text-gray-300",children:[O.percentage.toFixed(2),"%"]}),e.jsxs("div",{className:"text-gray-400 text-[10px] mt-1",children:[O.value.toLocaleString()," shares"]})]})]}),z&&e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto border-t pt-2",children:["Planned Shares","Unplanned Shares"].map(i=>{const y=L===i,S=G===i,r=i==="Planned Shares"?l:n,u=i==="Planned Shares"?d:f,_=i==="Planned Shares"?"bg-blue-500":"bg-slate-400";return r<=0?null:e.jsxs("div",{className:`flex items-center gap-2 text-xs p-1 rounded cursor-pointer transition-colors ${y||S?"bg-blue-50":"hover:bg-gray-50"}`,onMouseEnter:()=>{if(T.current){const x=T.current.getBoundingClientRect();q({label:i,value:r,percentage:u,x:x.width/2,y:x.height/2}),L||I(i)}},onMouseLeave:()=>{q(null),L||I(null)},onClick:x=>{x.stopPropagation(),Z(v=>{const C=v===i?null:i;return I(C),C})},children:[e.jsx("div",{className:`w-3 h-3 rounded-full flex-shrink-0 ${_}`}),e.jsx("span",{className:"text-gray-600 flex-1",children:i}),e.jsxs("span",{className:"text-gray-900 font-medium",children:[r.toLocaleString()," (",u.toFixed(1),"%)"]})]},i)})})]})})()]})})}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx("div",{children:e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{onClick:()=>de(!X),className:"flex items-center justify-between mb-4 cursor-pointer hover:bg-gray-50 transition p-2 -m-2 rounded",title:X?"Collapse legend":"Expand legend",role:"button",tabIndex:0,onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),de(!X))},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(be,{className:"w-6 h-6 text-purple-600"})}),e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Planned Shares by Plan"})]}),e.jsx("div",{className:"text-gray-500",children:X?e.jsx(ye,{className:"w-5 h-5"}):e.jsx(ve,{className:"w-5 h-5"})})]}),(()=>{const t=w.filter(a=>a.total_shares_allocated>0),l=t.reduce((a,d)=>a+d.total_shares_allocated,0),n=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4","#84cc16"];return t.length===0?e.jsx("div",{className:"flex items-center justify-center h-40 text-gray-400 text-sm",children:"No shares allocated"}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{ref:E,className:"relative w-full h-40 flex items-center justify-center",onClick:a=>{(a.target===a.currentTarget||a.target.tagName==="svg")&&(ne(null),U(null),D(null))},children:[e.jsxs("svg",{viewBox:"0 0 120 120",className:"w-full max-w-40 h-40 cursor-pointer",onMouseLeave:()=>{D(null),M||U(null)},children:[t.map((a,d)=>{const f=t.slice(0,d).reduce((x,v)=>x+v.total_shares_allocated/l*360,0),b=a.total_shares_allocated/l*360,A=f+b,j=(f-90)*(Math.PI/180),N=(A-90)*(Math.PI/180),h=60+50*Math.cos(j),m=60+50*Math.sin(j),k=60+50*Math.cos(N),i=60+50*Math.sin(N),y=b>180?1:0,S=a.total_shares_allocated/l*100,r=M===a.id,u=le===a.id,_=M?!r:le!==null&&!u;return e.jsx("path",{d:`M 60 60 L ${h} ${m} A 50 50 0 ${y} 1 ${k} ${i} Z`,fill:n[d%n.length],stroke:"white",strokeWidth:r||u?"3":"2",className:"cursor-pointer",style:{opacity:r?1:_?.3:u?1:.8,filter:r||u?"brightness(1.2)":M?"brightness(0.5)":"none",transition:"none"},onMouseEnter:x=>{if(E.current){const v=E.current.getBoundingClientRect(),C=x.clientX-v.left,H=x.clientY-v.top;M||U(a.id),D({plan:a,percentage:S,x:C,y:H})}},onClick:x=>{if(x.stopPropagation(),E.current){const v=E.current.getBoundingClientRect(),C=x.clientX-v.left,H=x.clientY-v.top;D({plan:a,percentage:S,x:C,y:H})}},onClick:x=>{if(x.stopPropagation(),E.current){const v=E.current.getBoundingClientRect(),C=x.clientX-v.left,H=x.clientY-v.top;D({plan:a,percentage:S,x:C,y:H})}ne(v=>{const C=v===a.id?null:a.id;return U(C),C})}},a.id)}),e.jsx("circle",{cx:"60",cy:"60",r:"30",fill:"white"}),(()=>{const a=l.toLocaleString(),d=a.length>12?"9":a.length>9?"10":a.length>6?"11":"12";return e.jsx("text",{x:"60",y:"56",textAnchor:"middle",className:"font-bold",fill:"#111827",fontSize:d,children:a})})(),e.jsx("text",{x:"60",y:"70",textAnchor:"middle",fill:"#6b7280",fontSize:"9",children:"Shares"})]}),Y&&e.jsxs("div",{className:"absolute z-10 bg-gray-900 text-white text-xs rounded-lg px-3 py-2 shadow-lg pointer-events-none whitespace-nowrap",style:{left:`${Y.x+10}px`,top:`${Y.y-10}px`,transform:"translate(-50%, -100%)"},children:[e.jsx("div",{className:"font-semibold",children:Y.plan.plan_name_en}),e.jsxs("div",{className:"text-gray-300",children:[Y.percentage.toFixed(2),"%"]}),e.jsxs("div",{className:"text-gray-400 text-[10px] mt-1",children:[Y.plan.total_shares_allocated.toLocaleString()," shares"]})]})]}),X&&e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto border-t pt-2",children:t.sort((a,d)=>d.total_shares_allocated-a.total_shares_allocated).map((a,d)=>{const f=a.total_shares_allocated/l*100,b=M===a.id,A=le===a.id;return e.jsxs("div",{className:`flex items-center gap-2 text-xs p-1 rounded cursor-pointer transition-colors ${b||A?"bg-blue-50":"hover:bg-gray-50"}`,onMouseEnter:()=>{if(E.current){const j=E.current.getBoundingClientRect();D({plan:a,percentage:f,x:j.width/2,y:j.height/2}),M||U(a.id)}},onMouseLeave:()=>{D(null),M||U(null)},onClick:j=>{j.stopPropagation(),ne(N=>{const h=N===a.id?null:a.id;return U(h),h})},children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:n[d%n.length]}}),e.jsx("span",{className:"text-gray-600 truncate flex-1",title:a.plan_name_en,children:a.plan_name_en}),e.jsxs("span",{className:"text-gray-900 font-medium",children:[a.total_shares_allocated.toLocaleString()," (",f.toFixed(1),"%)"]})]},a.id)})})]})})()]})})})]}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200",children:w.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(fe,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"No Plans Created Yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Create your first incentive plan to start allocating shares to employees"}),e.jsxs("button",{onClick:()=>K(!0),className:"inline-flex items-center space-x-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:[e.jsx(pe,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Create First Plan"})]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:`px-6 py-3 ${p?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:c("plans.planName")}),e.jsx("th",{className:`px-6 py-3 ${p?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:c("plans.planType")}),e.jsx("th",{className:`px-6 py-3 ${p?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:c("plans.planCode")}),e.jsx("th",{className:`px-6 py-3 ${p?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:c("plans.totalShares")}),e.jsx("th",{className:`px-6 py-3 ${p?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:c("plans.granted")}),e.jsx("th",{className:`px-6 py-3 ${p?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:c("employees.vested")}),e.jsx("th",{className:`px-6 py-3 ${p?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:c("plans.ungranted")}),e.jsx("th",{className:`px-6 py-3 ${p?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:c("plans.vestingScheduleType")}),e.jsx("th",{className:`px-6 py-3 ${p?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:"Period"}),e.jsx("th",{className:`px-6 py-3 ${p?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:c("plans.status")}),e.jsx("th",{className:`px-6 py-3 ${p?"text-left":"text-right"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:c("plans.actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:w.map(t=>{var l,n,a,d;return e.jsxs("tr",{className:"hover:bg-gray-50 transition relative",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("button",{onClick:()=>he(t),className:"text-left",children:[e.jsx("div",{className:"text-sm font-medium text-blue-600 hover:text-blue-800 hover:underline transition",children:t.plan_name_en}),e.jsx("div",{className:"text-xs text-gray-500",children:t.plan_name_ar})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium ${Me[t.plan_type]}`,children:t.plan_type})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:t.plan_code})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-bold text-gray-900",children:t.total_shares_allocated.toLocaleString()})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-bold text-blue-600",children:((l=t.actual_shares_granted)==null?void 0:l.toLocaleString())||t.shares_granted.toLocaleString()})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-bold text-green-600",children:((n=t.actual_shares_vested)==null?void 0:n.toLocaleString())||0})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-bold text-gray-900",children:((a=t.actual_shares_available)==null?void 0:a.toLocaleString())||t.shares_available.toLocaleString()})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900 capitalize",children:(d=t.vesting_config)!=null&&d.type?t.vesting_config.type.replace("_"," "):"Time Based"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-900",children:[e.jsx(Ve,{className:"w-3.5 h-3.5 mr-1"}),e.jsx("span",{children:ge(t.start_date)})]}),t.end_date&&e.jsxs("div",{className:"text-xs text-gray-500",children:["to ",ge(t.end_date)]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium ${qe[t.status]}`,children:t.status})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap relative",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{onClick:f=>{if(f.stopPropagation(),re===t.id){W();return}const b=f.currentTarget.getBoundingClientRect(),A=144,j=176;let N=b.bottom+8,h=b.right-j;N+A>window.innerHeight&&(N=b.top-A-8),h<16&&(h=Math.max(16,b.left));const m=window.innerWidth-j-16;h>m&&(h=Math.max(16,m)),N<16&&(N=16),oe({top:N,left:h}),ie(t.id)},className:"p-1.5 text-gray-500 hover:bg-gray-100 rounded transition",title:"Actions",children:e.jsx(Fe,{className:"w-4 h-4"})})}),re===t.id&&se&&Ye.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:W}),e.jsxs("div",{className:"fixed z-50 w-44 bg-white border border-gray-200 rounded-xl shadow-2xl overflow-hidden",style:{top:`${se.top}px`,left:`${se.left}px`},children:[e.jsxs("button",{onClick:()=>{he(t)},className:"w-full flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[e.jsx(_e,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{children:"View grants"})]}),e.jsxs("button",{onClick:()=>{Ie(t)},className:"w-full flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[e.jsx(Xe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:"Edit plan"})]}),e.jsxs("button",{onClick:()=>{ae(t.id),W()},className:"w-full flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50",children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsx("span",{children:"Delete plan"})]})]})]}),document.body)]})]},t.id)})})]})})}),ke&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Create New Incentive Plan"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Define plan parameters and vesting schedule"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"LTIP Pool Details"}),e.jsxs("p",{className:"text-xs text-blue-700 mt-1",children:["Total: ",$.total.toLocaleString()," | Already Allocated: ",$.allocated.toLocaleString()," | Available: ",$.available.toLocaleString()]})]})})}),Q&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm font-medium text-red-800",children:Q})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[c("plans.planNameEnglish"),"*"]}),e.jsx("input",{type:"text",value:s.plan_name_en,onChange:t=>o({...s,plan_name_en:t.target.value}),className:`w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${p?"text-right":"text-left"}`,placeholder:"e.g., Executive LTIP 2025"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[c("plans.planNameArabic"),"*"]}),e.jsx("input",{type:"text",value:s.plan_name_ar,onChange:t=>o({...s,plan_name_ar:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-right",dir:"rtl",placeholder:"خطة الحوافز التنفيذية 2025"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[c("plans.planCode"),"*"]}),e.jsx("input",{type:"text",value:s.plan_code,onChange:t=>o({...s,plan_code:t.target.value}),className:`w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${p?"text-right":"text-left"}`,placeholder:"LTIP-2025-001"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[c("plans.planType"),"*"]}),e.jsxs("select",{value:s.plan_type,onChange:t=>o({...s,plan_type:t.target.value}),className:`w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${p?"text-right":"text-left"}`,children:[e.jsx("option",{value:"LTIP_RSU",children:"LTIP - Restricted Stock Units"}),e.jsx("option",{value:"LTIP_RSA",children:"LTIP - Restricted Stock Awards"}),e.jsx("option",{value:"LTIP_ESOP",children:"Employee Stock Option Plan"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[c("plans.vestingScheduleType"),"*"]}),e.jsxs("select",{value:s.vesting_schedule_type,onChange:t=>o({...s,vesting_schedule_type:t.target.value}),className:`w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${p?"text-right":"text-left"}`,children:[e.jsx("option",{value:"time_based",children:"Time-Based Vesting"}),e.jsx("option",{value:"performance_based",children:"Performance-Based Vesting"}),e.jsx("option",{value:"hybrid",children:"Hybrid (Time + Performance)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c("plans.vestingScheduleTemplate")}),e.jsxs("select",{value:s.vesting_schedule_template_id,onChange:t=>o({...s,vesting_schedule_template_id:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select a template (optional)"}),R.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.cliff_months,"mo cliff, ",t.vesting_frequency,")"]},t.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select a template to automatically configure vesting rules for all grants under this plan"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"LTIP Pool*"}),e.jsxs("select",{value:s.ltip_pool_id,onChange:t=>o({...s,ltip_pool_id:t.target.value}),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select LTIP Pool"}),ee.map(t=>e.jsxs("option",{value:t.id,children:[t.pool_name_en," (",t.shares_available.toLocaleString()," available)"]},t.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select an LTIP pool to allocate shares from."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Total Shares Allocated*"}),e.jsx("input",{type:"number",value:s.total_shares_allocated,onChange:t=>o({...s,total_shares_allocated:parseInt(t.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"10000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:s.status,onChange:t=>o({...s,status:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"suspended",children:"Suspended"}),e.jsx("option",{value:"closed",children:"Closed"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[c("plans.startDate"),"*"]}),e.jsx("input",{type:"date",value:s.start_date,onChange:t=>o({...s,start_date:t.target.value}),className:`w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${p?"text-right":"text-left"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c("plans.endDate")}),e.jsx("input",{type:"date",value:s.end_date,onChange:t=>o({...s,end_date:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:!!s.vesting_schedule_template_id}),s.vesting_schedule_template_id&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Auto-generated from selected template duration"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vesting Period (Years)*"}),e.jsx("input",{type:"number",value:s.vesting_years,onChange:t=>o({...s,vesting_years:parseInt(t.target.value)||4}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"4",disabled:!!s.vesting_schedule_template_id}),s.vesting_schedule_template_id&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Auto-generated from selected template"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cliff Period (Months)"}),e.jsx("input",{type:"number",value:s.cliff_months,onChange:t=>o({...s,cliff_months:parseInt(t.target.value)||12}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"12",disabled:!!s.vesting_schedule_template_id}),s.vesting_schedule_template_id&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Auto-generated from selected template"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vesting Frequency"}),e.jsx("input",{type:"text",value:s.vesting_frequency==="monthly"?"Monthly":s.vesting_frequency==="quarterly"?"Quarterly":s.vesting_frequency==="annually"?"Annually":"Monthly",onChange:t=>o({...s,vesting_frequency:t.target.value.toLowerCase()}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:!!s.vesting_schedule_template_id,placeholder:"Monthly"}),s.vesting_schedule_template_id&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Auto-generated from selected template"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c("plans.descriptionEnglish")}),e.jsx("textarea",{value:s.description_en,onChange:t=>o({...s,description_en:t.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Describe the plan objectives and eligibility criteria..."})]})]}),e.jsxs("div",{className:`flex-shrink-0 p-6 border-t border-gray-200 bg-white flex items-center ${p?"justify-start flex-row-reverse":"justify-end"} space-x-3 ${p?"space-x-reverse":""}`,children:[e.jsx("button",{onClick:()=>K(!1),className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition",children:c("common.cancel")}),e.jsx("button",{onClick:$e,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:c("plans.createPlan")})]})]})}),ce&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Delete Plan"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to delete this plan? This action cannot be undone and all associated grants will be affected."}),e.jsxs("div",{className:"flex items-center justify-end space-x-3",children:[e.jsx("button",{onClick:()=>ae(null),className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition",children:"Cancel"}),e.jsx("button",{onClick:()=>Ee(ce),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",children:"Delete Plan"})]})]})}),V&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Edit Plan"}),e.jsx("p",{className:"text-gray-600 mt-1",children:V.plan_name_en})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"LTIP Pool Details"}),e.jsxs("p",{className:"text-xs text-blue-700 mt-1",children:["Total: ",$.total.toLocaleString()," | Already Allocated: ",$.allocated.toLocaleString()," | Available: ",$.available.toLocaleString()]})]})}),Q&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm font-medium text-red-800",children:Q})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Plan Name (English)"}),e.jsx("input",{type:"text",value:s.plan_name_en,onChange:t=>o({...s,plan_name_en:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., 2024 Executive LTIP"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Plan Type"}),e.jsxs("select",{value:s.plan_type,onChange:t=>o({...s,plan_type:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"LTIP_RSU",children:"LTIP - RSU (Restricted Stock Units)"}),e.jsx("option",{value:"LTIP_RSA",children:"LTIP - RSA (Restricted Stock Awards)"}),e.jsx("option",{value:"LTIP_ESOP",children:"ESOP (Employee Stock Ownership Plan)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Plan Code"}),e.jsx("input",{type:"text",value:s.plan_code,onChange:t=>o({...s,plan_code:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., LTIP-2024-001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vesting Schedule Type"}),e.jsxs("select",{value:s.vesting_schedule_type,onChange:t=>o({...s,vesting_schedule_type:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"time_based",children:"Time-Based Vesting"}),e.jsx("option",{value:"performance_based",children:"Performance-Based Vesting"}),e.jsx("option",{value:"hybrid",children:"Hybrid (Time + Performance)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vesting Schedule Template"}),e.jsxs("select",{value:s.vesting_schedule_template_id,onChange:t=>o({...s,vesting_schedule_template_id:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select a template (optional)"}),R.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.cliff_months,"mo cliff, ",t.vesting_frequency,")"]},t.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select a template to automatically configure vesting rules for all grants under this plan"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"LTIP Pool*"}),e.jsxs("select",{value:s.ltip_pool_id,onChange:t=>o({...s,ltip_pool_id:t.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[!s.ltip_pool_id&&e.jsx("option",{value:"",children:"Select LTIP Pool"}),ee.map(t=>e.jsxs("option",{value:t.id,children:[t.pool_name_en," (",t.shares_available.toLocaleString()," available)"]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Total Shares Allocated"}),e.jsx("input",{type:"number",value:s.total_shares_allocated,onChange:t=>o({...s,total_shares_allocated:Number(t.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"100000"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:s.start_date,onChange:t=>o({...s,start_date:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date (Optional)"}),e.jsx("input",{type:"date",value:s.end_date,onChange:t=>o({...s,end_date:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:!!s.vesting_schedule_template_id}),s.vesting_schedule_template_id&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Auto-generated from selected template duration"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vesting Period (Years)"}),e.jsx("input",{type:"number",value:s.vesting_years,onChange:t=>o({...s,vesting_years:parseInt(t.target.value)||4}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"4",disabled:!!s.vesting_schedule_template_id}),s.vesting_schedule_template_id&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Auto-generated from selected template"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cliff Period (Months)"}),e.jsx("input",{type:"number",value:s.cliff_months,onChange:t=>o({...s,cliff_months:parseInt(t.target.value)||12}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"12",disabled:!!s.vesting_schedule_template_id}),s.vesting_schedule_template_id&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Auto-generated from selected template"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vesting Frequency"}),e.jsx("input",{type:"text",value:s.vesting_frequency==="monthly"?"Monthly":s.vesting_frequency==="quarterly"?"Quarterly":s.vesting_frequency==="annually"?"Annually":"Monthly",onChange:t=>o({...s,vesting_frequency:t.target.value.toLowerCase()}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:!!s.vesting_schedule_template_id,placeholder:"Monthly"}),s.vesting_schedule_template_id&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Auto-generated from selected template"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:s.status,onChange:t=>o({...s,status:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"suspended",children:"Suspended"}),e.jsx("option",{value:"closed",children:"Closed"})]})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-200 flex items-center justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{te(null),o({plan_name_en:"",plan_name_ar:"",plan_type:"LTIP_RSU",plan_code:"",description_en:"",description_ar:"",vesting_schedule_type:"time_based",total_shares_allocated:0,start_date:"",end_date:"",status:"draft",vesting_years:4,cliff_months:12,vesting_frequency:"monthly"})},className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{onClick:Re,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Update Plan"})]})]})})]})}export{Je as default};
