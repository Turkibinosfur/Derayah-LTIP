import{a as Dt,u as Pt,s as u,j as e}from"./index-DDk1oefv.js";import{e as Ft,r as b,a as Mt}from"./react-vendor-xiFAdxLt.js";import{f as P,c as Be}from"./dateUtils-DoPl8O0G.js";import{g as qt,a as $t,b as We}from"./vestingUtils-Chheyw2X.js";import{I as Tt}from"./InteractiveVestingTimeline-Dep_-bBd.js";import{w as Ye,b as Se,r as oe,a as Xe,F as Q,x as Ke,y as Lt,U as ce,K as Qe,X as de,z as Vt,E as At,H as Ut,N as Ce,s as Ee}from"./ui-vendor-B0ZOy8uN.js";import"./supabase-vendor-B-LuImWU.js";import"./numberUtils-CWVJ76A6.js";function Xt(){var Le,Ve,Ae,Ue,Re,Ie,Oe,ze,He;const{t:N,i18n:Je}=Dt(),M=Je.language==="ar",[me,Ze]=Ft(),[I,et]=b.useState([]),[J,tt]=b.useState([]),[q,st]=b.useState([]),[Z,at]=b.useState([]),[T,rt]=b.useState([]),[nt,lt]=b.useState(!0),[it,ee]=b.useState(!1),[ot,xe]=b.useState(!1),[ct,ue]=b.useState(!1),[m,z]=b.useState(null),[D,ke]=b.useState(null),[w,te]=b.useState(null),[Ge,se]=b.useState([]),[F,De]=b.useState(null),[ge,Pe]=b.useState(0),[he,Fe]=b.useState(0),[Me,$]=b.useState(null),[pe,O]=b.useState(null),[L,dt]=b.useState(""),[ae,mt]=b.useState("all"),[B,fe]=b.useState(null),[_e,be]=b.useState(null),[xt,re]=b.useState(!1),[S,ye]=b.useState([]),[ne,ut]=b.useState(""),[a,V]=b.useState({employee_id:"",plan_id:"",total_shares:0,vesting_start_date:"",vesting_schedule_id:"",performance_metric_ids:[],use_even_distribution:!1}),[C,H]=b.useState({total_shares:0,grant_date:"",vesting_start_date:"",vesting_end_date:"",status:"pending_signature"}),[ve,le]=b.useState([]),{userRole:A,hasPermission:qe}=Pt(),[je,$e]=b.useState(!1),[E,W]=b.useState([]);b.useEffect(()=>{const t=me.get("plan_id"),s=me.get("plan_name");t?(fe(t),be(s)):(fe(null),be(null))},[me]),b.useEffect(()=>{Y()},[]),b.useEffect(()=>{W([])},[L,ae,B,S]);const gt=()=>{fe(null),be(null),Ze({})},ht=()=>{ye([])},pt=t=>{ye(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},ft=t=>{V(s=>({...s,performance_metric_ids:s.performance_metric_ids.includes(t)?s.performance_metric_ids.filter(r=>r!==t):[...s.performance_metric_ids,t]}))},_t=t=>{le(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},ie=J.filter(t=>t.first_name_en.toLowerCase().includes(ne.toLowerCase())||t.last_name_en.toLowerCase().includes(ne.toLowerCase())||t.employee_number.toLowerCase().includes(ne.toLowerCase())),Ne=()=>{V({employee_id:"",plan_id:"",total_shares:0,vesting_start_date:"",vesting_schedule_id:"",performance_metric_ids:[],use_even_distribution:!1})},Te=b.useMemo(()=>{if(!a.plan_id||!a.total_shares||!a.vesting_start_date)return[];const t=q.find(h=>h.id===a.plan_id);if(!t)return[];const s=a.vesting_schedule_id?T.find(h=>h.id===a.vesting_schedule_id):null;let r=null;s?r=s:t.vesting_schedule_template_id&&(r=T.find(h=>h.id===t.vesting_schedule_template_id));let l=48,i=12,d=12;if(r){l=r.total_duration_months||48,i=r.cliff_months||12;const h=r.vesting_frequency||"annually";d=h==="monthly"?1:h==="quarterly"?3:12}else if(t.vesting_config){l=(t.vesting_config.years||4)*12,i=t.vesting_config.cliff_months||12;const h=t.vesting_config.frequency||"annually";d=h==="monthly"?1:h==="quarterly"?3:12}const c=[],f=new Date(a.vesting_start_date);let _=0,o=0;const x=l-i,y=a.use_even_distribution?Math.ceil(x/d):Math.floor(x/d);let g=0,v=0;if(a.use_even_distribution?i>0?(g=Math.floor(a.total_shares/(y+1)),v=Math.floor((a.total_shares-g)/y)):v=Math.floor(a.total_shares/y):i>0?(g=Math.floor(a.total_shares*.25),v=Math.floor((a.total_shares-g)/y)):v=Math.floor(a.total_shares/y),i>0&&g>0){const h=new Date(f);h.setMonth(h.getMonth()+i),o=g,_=g,c.push({type:"Cliff",date:h.toISOString().split("T")[0],shares:g,cumulative:o,monthsFromStart:i})}for(let h=1;h<=y;h++){const p=new Date(f);p.setMonth(p.getMonth()+i+h*d);let n;h===y?n=a.total_shares-_:n=v,_+=n,o=_,c.push({type:`Period ${h}`,date:p.toISOString().split("T")[0],shares:n,cumulative:o,monthsFromStart:i+h*d})}return c},[a.plan_id,a.total_shares,a.vesting_start_date,a.vesting_schedule_id,a.use_even_distribution,q,T]),Y=async()=>{try{const{data:{user:t}}=await u.auth.getUser();if(!t)return;const{data:s}=await u.from("company_users").select("company_id, id").eq("user_id",t.id).single();if(s){const[r,l,i,d,c]=await Promise.all([u.from("grants").select(`
              *,
              employees (first_name_en, last_name_en, email, department),
              incentive_plans (plan_name_en, plan_code, plan_type),
              grant_performance_metrics (
                performance_metric_id,
                performance_metrics (
                  id,
                  name,
                  description,
                  metric_type,
                  unit_of_measure
                )
              )
            `).eq("company_id",s.company_id).order("created_at",{ascending:!1}),u.from("employees").select("id, employee_number, first_name_en, last_name_en, email, department").eq("company_id",s.company_id).eq("employment_status","active"),u.from("incentive_plans").select(`
              id, 
              plan_name_en, 
              plan_code, 
              shares_available,
              start_date,
              vesting_config, 
              vesting_schedule_template_id,
              vesting_schedules (
                total_duration_months,
                cliff_months,
                vesting_frequency
              )
            `).eq("company_id",s.company_id).eq("status","active"),u.from("performance_metrics").select("id, name, description, metric_type, unit_of_measure").eq("company_id",s.company_id).order("name",{ascending:!0}),u.from("vesting_schedules").select("*").eq("company_id",s.company_id).eq("is_template",!0).order("name",{ascending:!0})]);if(r.data&&et(r.data),l.data&&tt(l.data),i.data&&i.data.length>0){const f=i.data.map(g=>g.id),{data:_,error:o}=await u.from("grants").select("plan_id, total_shares, status, grant_number, employee_id").in("plan_id",f);o&&console.error("Error loading grants for plans:",o);const x=(_||[]).reduce((g,v)=>(g[v.plan_id]||(g[v.plan_id]=[]),g[v.plan_id].push(v),g),{}),y=i.data.map(g=>{const v=x[g.id]||[],h=v.reduce((k,G)=>k+Number(G.total_shares||0),0),p=g.total_shares_allocated||0,n=p-h;return g.plan_name_en==="Derayah Employee Stock Plan 2025"&&(console.log("=== DEBUGGING GRANTS PAGE CALCULATION ==="),console.log("Plan:",g.plan_name_en),console.log("Plan ID:",g.id),console.log("Total Allocated:",p),console.log("Grants Data:",v),console.log("Number of grants found:",v.length),console.log("Actual Granted:",h),console.log("Actual Available:",n),console.log("Stored shares_available:",g.shares_available),v.length>0?v.forEach((k,G)=>{console.log(`Grant ${G+1}:`,{grant_number:k.grant_number,total_shares:k.total_shares,status:k.status,employee_id:k.employee_id})}):console.log("No grants found for this plan!")),{...g,actual_shares_available:Math.max(0,n)}});st(y)}d.data&&at(d.data),c.data&&rt(c.data)}}catch(t){console.error("Error loading data:",t)}finally{lt(!1)}},X=async t=>{z(t),xe(!0),te(null),se([]),ke(null),De(null),Pe(0),Fe(0);try{const s=await qt(t.id),{data:r,error:l}=await u.from("vesting_events").select("*").eq("grant_id",t.id).order("sequence_number",{ascending:!0});l&&console.error("Error loading vesting records:",l);let i=t.vested_shares;if(r&&r.length>0){i=r.filter(o=>o.status==="vested"||o.status==="transferred"||o.status==="exercised").reduce((o,x)=>o+Number(x.shares_to_vest||0),0),De(i);const f=r.filter(o=>o.status==="transferred").reduce((o,x)=>o+Number(x.shares_to_vest||0),0),_=r.filter(o=>o.status==="exercised").reduce((o,x)=>o+Number(x.shares_to_vest||0),0);Pe(f),Fe(_)}if(t.grant_number==="GR-20251028-000007"&&(console.log("ðŸ” DEBUG: Grant GR-20251028-000007 vesting records:"),console.log("Grant details:",{id:t.id,grant_number:t.grant_number,total_shares:t.total_shares,vested_shares:t.vested_shares,vesting_start_date:t.vesting_start_date,vesting_end_date:t.vesting_end_date,status:t.status}),console.log("Vesting records count:",(r==null?void 0:r.length)||0),console.log("Vesting records (from vesting_events table):",r),r&&r.length>0)){const c=r.map(o=>o.sequence_number),f=[...new Set(c)];console.log("Sequence numbers:",c),console.log("Unique sequences:",f),c.length!==f.length&&console.warn("âš ï¸ DUPLICATE SEQUENCE NUMBERS DETECTED!");const _=new Date;console.log("ðŸ“… DEBUG: Vesting dates analysis:"),r.forEach((o,x)=>{const y=new Date(o.vesting_date),g=y<=_;console.log(`Record ${x+1}:`,{sequence_number:o.sequence_number,vesting_date:o.vesting_date,formatted_date:y.toDateString(),shares_to_vest:o.shares_to_vest,status:o.status,isPastDue:g,daysPast:Math.floor((_.getTime()-y.getTime())/(1e3*60*60*24))})})}const d={...s,individualVestingRecords:r||[]};ke(d)}catch(s){console.error("Error loading vesting details:",s)}try{const{data:{user:s}}=await u.auth.getUser();if(!s)return;const{data:r}=await u.from("company_users").select("company_id").eq("user_id",s.id).maybeSingle();if(!r)return;const{data:l,error:i}=await u.from("generated_documents").select("*").eq("grant_id",t.id).maybeSingle();if(i&&console.error("Error loading contract:",i),l){const{data:c}=await u.from("e_signatures").select("*").eq("document_id",l.id),f=l.status??(t.employee_acceptance_at?"signed":t.status==="pending_signature"?"pending_signature":"draft");te({...l,status:f,e_signatures:c||[]})}const{data:d}=await u.from("grant_modifications").select("*").eq("grant_id",t.id).order("created_at",{ascending:!1});se(d||[])}catch(s){console.error("Error loading grant details:",s)}},bt=b.useMemo(()=>!m||!w||w.status!=="draft"||!A?!1:A.user_type==="super_admin"||A.role==="super_admin"||A.role==="finance_admin"?!0:A.role==="hr_admin"||A.role==="legal_admin"||A.role==="company_admin"?qe("contract_approval"):!1,[m,w,A,qe]),yt=async()=>{if(!(!m||!w||je))try{$e(!0);const{data:{user:t}}=await u.auth.getUser();if(!t){alert("Unable to approve the contract because no active session was found.");return}const s=new Date().toISOString(),{error:r}=await u.from("generated_documents").update({status:"pending_signature",approved_by:t.id,approved_at:s}).eq("id",w.id);if(r)throw r;await X(m),alert("Contract approved successfully. The employee can now review and sign.")}catch(t){console.error("Error approving contract:",t),alert("Failed to approve the contract. Please try again.")}finally{$e(!1)}},vt=t=>{var s;z(t),H({total_shares:t.total_shares,grant_date:t.grant_date,vesting_start_date:t.vesting_start_date,vesting_end_date:t.vesting_end_date,status:t.status}),le(((s=t.grant_performance_metrics)==null?void 0:s.map(r=>r.performance_metric_id))||[]),ue(!0),$(null)},jt=async()=>{if(m)try{const{error:t}=await u.from("grants").update({total_shares:C.total_shares,grant_date:C.grant_date,vesting_start_date:C.vesting_start_date,vesting_end_date:C.vesting_end_date,status:C.status,updated_at:new Date().toISOString()}).eq("id",m.id);if(t)throw t;if(await u.from("grant_performance_metrics").delete().eq("grant_id",m.id),ve.length>0){const s=ve.map(l=>({company_id:m.company_id,grant_id:m.id,performance_metric_id:l})),{error:r}=await u.from("grant_performance_metrics").insert(s);if(r)throw r}ue(!1),z(null),le([]),Y()}catch(t){console.error("Error updating grant:",t),alert("Failed to update grant")}},Nt=async t=>{try{const{data:s,error:r}=await u.from("vesting_events").select("id").eq("grant_id",t.id);r&&console.error("Error counting vesting events:",r);const l=(s==null?void 0:s.length)||0;let i=`Are you sure you want to delete grant ${t.grant_number}?

`;if(i+=`This will permanently delete:
`,i+=`â€¢ Grant: ${t.grant_number}
`,i+=`â€¢ ${l} vesting event${l!==1?"s":""}
`,i+=`â€¢ All generated documents

`,i+="âš ï¸ This action cannot be undone!",!window.confirm(i))return;const{error:d}=await u.from("grants").delete().eq("id",t.id);if(d)throw d;await u.from("generated_documents").delete().eq("grant_id",t.id),$(null),Y(),alert(`Grant ${t.grant_number} deleted successfully, including ${l} vesting event${l!==1?"s":""}.`)}catch(s){console.error("Error deleting grant:",s),alert("Failed to delete grant")}},wt=async()=>{if(E.length===0){alert("Please select at least one grant to delete");return}try{const t=I.filter(c=>E.includes(c.id));let s=0;const r={};for(const c of t){const{data:f,error:_}=await u.from("vesting_events").select("id").eq("grant_id",c.id);if(_)console.error(`Error counting vesting events for grant ${c.grant_number}:`,_);else{const o=(f==null?void 0:f.length)||0;r[c.id]=o,s+=o}}let l=`Are you sure you want to delete ${E.length} grant${E.length!==1?"s":""}?

`;if(l+=`This will permanently delete:
`,l+=`â€¢ ${E.length} grant${E.length!==1?"s":""}
`,l+=`â€¢ ${s} vesting event${s!==1?"s":""}
`,l+=`â€¢ All generated documents

`,l+=`Grants to be deleted:
`,t.forEach(c=>{l+=`  - ${c.grant_number} (${r[c.id]||0} events)
`}),l+=`
âš ï¸ This action cannot be undone!`,!window.confirm(l))return;const{error:i}=await u.from("grants").delete().in("id",E);if(i)throw i;await u.from("generated_documents").delete().in("grant_id",E);const d=E.length;W([]),Y(),alert(`Successfully deleted ${d} grant${d!==1?"s":""}, including ${s} vesting event${s!==1?"s":""}.`)}catch(t){console.error("Error deleting grants:",t),alert("Failed to delete grants")}},St=async()=>{var t,s,r;try{console.log("ðŸš€ Starting grant creation process...");const{data:{user:l}}=await u.auth.getUser();if(!l){console.error("âŒ No authenticated user found");return}console.log("âœ… User authenticated:",l.id);const{data:i}=await u.from("company_users").select("company_id, id").eq("user_id",l.id).single();if(!i){console.error("âŒ No company user found");return}console.log("âœ… Company user found:",i);const d=q.find(p=>p.id===a.plan_id);if(!d){console.error("âŒ Selected plan not found:",a.plan_id);return}console.log("âœ… Selected plan:",d);const c=d.actual_shares_available||d.shares_available;if(console.log("ðŸ“Š Available shares:",c,"Requested shares:",a.total_shares),a.total_shares>c){console.error("âŒ Not enough shares available"),alert("Not enough shares available in this plan");return}let f=4;if(a.vesting_schedule_id){const p=T.find(n=>n.id===a.vesting_schedule_id);p&&(f=Math.floor(p.total_duration_months/12))}else if(d.vesting_schedule_template_id){const{data:p}=await u.from("vesting_schedules").select("total_duration_months").eq("id",d.vesting_schedule_template_id).eq("is_template",!0).single();p&&(f=Math.floor(p.total_duration_months/12))}else f=((t=d.vesting_config)==null?void 0:t.years)||4;const _=new Date(a.vesting_start_date);_.setFullYear(_.getFullYear()+f),console.log("ðŸ’¾ Inserting grant into database...");const o={company_id:i.company_id,plan_id:a.plan_id,employee_id:a.employee_id,total_shares:a.total_shares,vesting_start_date:a.vesting_start_date,vesting_end_date:_.toISOString().split("T")[0],grant_date:new Date().toISOString().split("T")[0],created_by:i.id,status:"active",use_even_distribution:a.use_even_distribution};a.vesting_schedule_id&&(o.vesting_schedule_id=a.vesting_schedule_id),console.log("ðŸ“ Grant data to insert:",o);let x,y;const{data:g,error:v}=await u.from("grants").insert(o).select("*, incentive_plans(plan_type)").single();if(x=g,y=v,y&&y.code==="PGRST204"&&((s=y.message)!=null&&s.includes("vesting_schedule_id")||(r=y.message)!=null&&r.includes("use_even_distribution"))){console.warn("âš ï¸ Column not found in schema, retrying without optional columns");const{vesting_schedule_id:p,use_even_distribution:n,...k}=o,{data:G,error:U}=await u.from("grants").insert(k).select("*, incentive_plans(plan_type)").single();x=G,y=U}if(y)throw console.error("âŒ Grant insertion error:",y),y;console.log("âœ… Grant created successfully:",x);const h={};if(a.vesting_schedule_id&&!x.vesting_schedule_id&&(h.vesting_schedule_id=a.vesting_schedule_id,console.log("ðŸ”„ Will update grant with vesting_schedule_id:",a.vesting_schedule_id)),a.use_even_distribution!==void 0&&x.use_even_distribution===void 0&&(h.use_even_distribution=a.use_even_distribution,console.log("ðŸ”„ Will update grant with use_even_distribution:",a.use_even_distribution)),Object.keys(h).length>0){const{error:p}=await u.from("grants").update(h).eq("id",x.id);p?console.warn("âš ï¸ Could not update grant fields:",p):(console.log("âœ… Updated grant with missing fields:",h),Object.assign(x,h))}if(await u.from("incentive_plans").update({shares_granted:d.shares_available-a.total_shares,shares_available:d.shares_available-a.total_shares}).eq("id",a.plan_id),x){if(a.performance_metric_ids.length>0)try{const j=a.performance_metric_ids.map(Gt=>({company_id:i.company_id,grant_id:x.id,performance_metric_id:Gt})),{error:R}=await u.from("grant_performance_metrics").insert(j);R&&console.warn("âš ï¸ Could not link performance metrics (RLS policy issue):",R)}catch(j){console.warn("âš ï¸ Error linking performance metrics:",j)}let p=!1,n=null;const k=async()=>{try{console.warn("âš ï¸ Trying RPC function as fallback (bypasses RLS)...");const j={p_grant_id:x.id};a.vesting_schedule_id&&(j.p_schedule_id=a.vesting_schedule_id,console.log("ðŸ“Œ Passing schedule_id to RPC:",a.vesting_schedule_id));const{error:R}=await u.rpc("generate_vesting_events_for_grant",j);return R?(console.error("âŒ RPC function also failed:",R),n=R,!1):(console.log("âœ… Vesting events generated successfully using RPC function"),!0)}catch(j){return console.error("âŒ RPC function error:",j),n=j,!1}};try{console.log("ðŸ”„ Generating vesting events using preview logic (matches preview exactly)..."),console.log("   - Schedule ID:",a.vesting_schedule_id||"none"),console.log("   - Total shares:",a.total_shares),console.log("   - Start date:",a.vesting_start_date),console.log("   - Even distribution:",a.use_even_distribution),await $t(x.id,a.vesting_schedule_id||null,a.total_shares,a.vesting_start_date,a.use_even_distribution),console.log("âœ… Vesting events generated successfully using preview logic"),p=!0}catch(j){if(console.error("âŒ Error generating vesting events using preview logic:",j),n=j,j&&typeof j=="object"&&"code"in j&&j.code==="42501"&&(console.warn("âš ï¸ RLS error detected, trying RPC function as fallback..."),p=await k()),!p){console.warn("âš ï¸ Preview-based generation failed, trying milestone-based approach as fallback...");try{a.vesting_schedule_id?(await We(x.id,a.vesting_schedule_id,a.use_even_distribution),p=!0):d.vesting_schedule_template_id?(await We(x.id,d.vesting_schedule_template_id,a.use_even_distribution),p=!0):p=await k()}catch(R){console.error("âŒ Fallback generation also failed:",R),p||(p=await k())}}}const G=[];if(!p){const j=(n==null?void 0:n.message)||"Unknown error";console.warn("âš ï¸ Grant created but vesting events were not generated:",j),G.push(`Vesting events could not be generated: ${j}`)}const U=await Ct(x,i.company_id);if(!(U!=null&&U.success)){const j=(U==null?void 0:U.reason)||"Unknown error";console.warn("âš ï¸ Grant created but contract could not be generated:",j),G.push(`Contract could not be generated: ${j}`)}if(ee(!1),Ne(),Y(),G.length===0)alert("Grant issued successfully with contract generated!");else{const j=G.join(`

`);alert(`Grant issued successfully!

However, there were some issues:

${j}

Please check the console for more details.`)}}}catch(l){console.error("âŒ Error creating grant:",l);let i="Failed to create grant";l instanceof Error&&(i+=": "+l.message),alert(i)}},Ct=async(t,s)=>{var r,l,i,d;try{const c=(r=t.incentive_plans)==null?void 0:r.plan_type;console.log("ðŸ“„ Generating contract for grant:",t.grant_number,"Plan type:",c);let f="";if(c==="ESOP")f="ESOP Grant Agreement";else if(c==="LTIP_RSU")f="LTIP RSU Grant Agreement";else return console.warn("âš ï¸ Contract generation skipped: Plan type",c,"is not supported for automatic contract generation"),{success:!1,reason:`Plan type '${c}' is not supported for automatic contract generation`};const{data:_,error:o}=await u.from("document_templates").select("*").eq("company_id",s).eq("template_name",f).maybeSingle();if(o)return console.error("âŒ Error fetching template:",o),{success:!1,reason:`Failed to fetch template: ${o.message}`};if(!_)return console.warn("âš ï¸ No template found for plan type:",c,"Template name:",f),{success:!1,reason:`No document template found for '${f}'. Please create a template in the Document Templates section.`};const{data:x,error:y}=await u.from("employees").select("*").eq("id",t.employee_id).single();if(y)return console.error("âŒ Error fetching employee:",y),{success:!1,reason:`Failed to fetch employee data: ${y.message}`};if(!x)return console.error("âŒ Employee not found for ID:",t.employee_id),{success:!1,reason:"Employee not found"};const{data:g,error:v}=await u.from("incentive_plans").select("*").eq("id",t.plan_id).single();if(v)return console.error("âŒ Error fetching plan:",v),{success:!1,reason:`Failed to fetch plan data: ${v.message}`};if(!g)return console.error("âŒ Plan not found for ID:",t.plan_id),{success:!1,reason:"Plan not found"};const{data:h,error:p}=await u.from("companies").select("*").eq("id",s).single();if(p)return console.error("âŒ Error fetching company:",p),{success:!1,reason:`Failed to fetch company data: ${p.message}`};if(!h)return console.error("âŒ Company not found for ID:",s),{success:!1,reason:"Company not found"};let n=_.template_content;n=n.replace(/{{company_name_en}}/g,h.company_name_en||""),n=n.replace(/{{company_name_ar}}/g,h.company_name_ar||""),n=n.replace(/{{employee_first_name}}/g,x.first_name_en||""),n=n.replace(/{{employee_last_name}}/g,x.last_name_en||""),n=n.replace(/{{employee_number}}/g,x.employee_number||""),n=n.replace(/{{employee_email}}/g,x.email||""),n=n.replace(/{{employee_department}}/g,x.department||"N/A"),n=n.replace(/{{employee_job_title}}/g,x.job_title||"N/A"),n=n.replace(/{{plan_name}}/g,g.plan_name_en||""),n=n.replace(/{{total_shares}}/g,((l=t.total_shares)==null?void 0:l.toString())||""),n=n.replace(/{{exercise_price}}/g,((i=g.exercise_price)==null?void 0:i.toString())||"N/A"),n=n.replace(/{{grant_number}}/g,t.grant_number||""),n=n.replace(/{{grant_date}}/g,t.grant_date||""),n=n.replace(/{{plan_description}}/g,g.description_en||""),n=n.replace(/{{vesting_start_date}}/g,t.vesting_start_date||""),n=n.replace(/{{vesting_end_date}}/g,t.vesting_end_date||"");const k=((d=g.vesting_config)==null?void 0:d.years)||4;n=n.replace(/{{vesting_period}}/g,k.toString());const{error:G}=await u.from("generated_documents").insert({company_id:s,employee_id:t.employee_id,grant_id:t.id,template_id:_.id,document_type:"grant_agreement",document_name:`${_.template_name} - ${x.first_name_en} ${x.last_name_en} (${t.grant_number})`,document_content:n,status:"draft"});return G?(console.error("âŒ Error inserting contract document:",G),{success:!1,reason:`Failed to create contract document: ${G.message}`}):(console.log("âœ… Contract generated successfully for grant:",t.grant_number),{success:!0})}catch(c){return console.error("âŒ Error generating contract:",c),{success:!1,reason:c instanceof Error?c.message:"Unknown error occurred"}}},K=I.filter(t=>{var d,c,f;const s=((d=t.employees)==null?void 0:d.first_name_en.toLowerCase().includes(L.toLowerCase()))||((c=t.employees)==null?void 0:c.last_name_en.toLowerCase().includes(L.toLowerCase()))||t.grant_number.toLowerCase().includes(L.toLowerCase())||((f=t.incentive_plans)==null?void 0:f.plan_name_en.toLowerCase().includes(L.toLowerCase())),r=ae==="all"||t.status===ae,l=!B||t.plan_id===B,i=S.length===0||S.includes(t.employee_id);return s&&r&&l&&i}),Et=t=>{W(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},kt=()=>{const t=K.map(r=>r.id),s=t.length>0&&t.every(r=>E.includes(r));W(s?r=>r.filter(l=>!t.includes(l)):r=>{const l=[...r];return t.forEach(i=>{l.includes(i)||l.push(i)}),l})},we={pending_signature:{icon:Xe,color:"text-yellow-600",bg:"bg-yellow-100",label:"Pending Signature"},active:{icon:oe,color:"text-green-600",bg:"bg-green-100",label:"Active"},completed:{icon:oe,color:"text-blue-600",bg:"bg-blue-100",label:"Completed"},forfeited:{icon:Ee,color:"text-red-600",bg:"bg-red-100",label:"Forfeited"},cancelled:{icon:Ee,color:"text-gray-600",bg:"bg-gray-100",label:"Cancelled"},lapsed:{icon:Ee,color:"text-orange-600",bg:"bg-orange-100",label:"Lapsed"}};return nt?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:`text-3xl font-bold text-gray-900 flex items-center gap-3 ${M?"flex-row-reverse":""}`,children:[N("grants.title"),e.jsx("span",{className:"inline-flex items-center justify-center w-10 h-10 rounded-full bg-blue-600 text-white text-lg font-semibold",children:I.length})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:N("grants.description")})]}),e.jsxs("button",{onClick:()=>{Ne(),ee(!0)},className:`flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition ${M?"space-x-reverse":""}`,children:[e.jsx(Ye,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:N("grants.createGrant")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Se,{className:"w-8 h-8 text-blue-600"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:I.length})]}),e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:N("grants.totalGrants")})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(oe,{className:"w-8 h-8 text-green-600"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:I.filter(t=>t.status==="active").length})]}),e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:N("grants.activeGrants")})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Xe,{className:"w-8 h-8 text-yellow-600"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:I.filter(t=>t.status==="pending_signature").length})]}),e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:N("grants.pendingSignature")})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Q,{className:"w-8 h-8 text-purple-600"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:I.reduce((t,s)=>t+s.total_shares,0).toLocaleString()})]}),e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:N("grants.totalSharesGranted")})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4 flex-1",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ke,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search grants by employee, grant number, or plan...",value:L,onChange:t=>dt(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Lt,{className:"w-5 h-5 text-gray-400"}),e.jsxs("select",{value:ae,onChange:t=>mt(t.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending_signature",children:"Pending Signature"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"forfeited",children:"Forfeited"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"lapsed",children:"Lapsed"})]}),e.jsxs("button",{onClick:()=>re(!0),className:`flex items-center space-x-2 px-4 py-2 border rounded-lg transition ${S.length>0?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:S.length>0?`Employees (${S.length})`:"Filter by Employee"})]})]})]}),E.length>0&&e.jsxs("div",{className:"ml-4 flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-600 font-medium",children:[E.length," selected"]}),e.jsxs("button",{onClick:wt,className:"flex items-center space-x-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",children:[e.jsx(Qe,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Delete Selected"})]})]})]}),(B&&_e||S.length>0)&&e.jsxs("div",{className:"mt-4 flex items-center gap-2 flex-wrap",children:[B&&_e&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-blue-100 text-blue-800 rounded-lg text-sm font-medium",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsxs("span",{children:["Plan: ",_e]}),e.jsx("button",{onClick:gt,className:"ml-1 hover:bg-blue-200 rounded-full p-0.5 transition",children:e.jsx(de,{className:"w-3.5 h-3.5"})})]}),S.length>0&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-green-100 text-green-800 rounded-lg text-sm font-medium",children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsxs("span",{children:["Employees: ",S.length===1?((Le=J.find(t=>t.id===S[0]))==null?void 0:Le.first_name_en)+" "+((Ve=J.find(t=>t.id===S[0]))==null?void 0:Ve.last_name_en):`${S.length} selected`]}),e.jsx("button",{onClick:ht,className:"ml-1 hover:bg-green-200 rounded-full p-0.5 transition",children:e.jsx(de,{className:"w-3.5 h-3.5"})})]})]})]}),K.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(Se,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:N("grants.noGrantsFound")}),e.jsx("p",{className:"text-gray-600 mb-6",children:N(L?"common.tryAdjustingSearch":"grants.issueFirstGrant")}),!L&&e.jsxs("button",{onClick:()=>ee(!0),className:`inline-flex items-center space-x-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition ${M?"space-x-reverse":""}`,children:[e.jsx(Ye,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:N("grants.issueFirstGrant")})]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12",children:e.jsx("input",{type:"checkbox",checked:K.length>0&&K.every(t=>E.includes(t.id)),onChange:kt,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"})}),e.jsx("th",{className:`px-6 py-3 ${M?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:N("grants.grantNumber")}),e.jsx("th",{className:`px-6 py-3 ${M?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:N("grants.employee")}),e.jsx("th",{className:`px-6 py-3 ${M?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:N("grants.plan")}),e.jsx("th",{className:`px-6 py-3 ${M?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:N("grants.planType")}),e.jsx("th",{className:`px-6 py-3 ${M?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:N("grants.totalShares")}),e.jsx("th",{className:`px-6 py-3 ${M?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:N("grants.vested")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unvested"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Vesting Progress"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Grant Date"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:K.map(t=>{var d,c,f,_,o,x;const s=we[t.status]||we.active,r=s.icon,l=t.vested_shares/t.total_shares*100,i=t.total_shares-t.vested_shares;return e.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"checkbox",checked:E.includes(t.id),onChange:()=>Et(t.id),onClick:y=>y.stopPropagation(),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>X(t),className:"text-sm font-medium text-blue-600 hover:text-blue-800 hover:underline transition",children:t.grant_number})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Se,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[(d=t.employees)==null?void 0:d.first_name_en," ",(c=t.employees)==null?void 0:c.last_name_en]}),e.jsx("div",{className:"text-xs text-gray-500",children:((f=t.employees)==null?void 0:f.department)||"No Department"})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:(_=t.incentive_plans)==null?void 0:_.plan_name_en}),e.jsx("div",{className:"text-xs text-gray-500",children:(o=t.incentive_plans)==null?void 0:o.plan_code})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:(x=t.incentive_plans)==null?void 0:x.plan_type})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-bold text-gray-900",children:t.total_shares.toLocaleString()})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-bold text-green-600",children:Math.floor(t.vested_shares).toLocaleString()})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-bold text-blue-600",children:Math.floor(i).toLocaleString()})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"w-32",children:[e.jsx("div",{className:"flex items-center justify-between mb-1",children:e.jsxs("span",{className:"text-xs text-gray-600 font-medium",children:[l.toFixed(0),"%"]})}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${l}%`}})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.bg} ${s.color}`,children:[e.jsx(r,{className:"w-3.5 h-3.5 mr-1"}),s.label]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:P(t.grant_date)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[P(t.vesting_start_date)," - ",P(t.vesting_end_date)]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"relative inline-block text-left",children:[e.jsx("button",{onClick:y=>{y.stopPropagation();const g=y.currentTarget.getBoundingClientRect(),v=180,h=224;let p=g.bottom+8,n=g.right-h;p+v>window.innerHeight&&(p=g.top-v-8),n<0&&(n=g.left),p<0&&(p=8),O({top:p,left:n}),$(Me===t.id?null:t.id)},className:"p-1 hover:bg-gray-100 rounded-lg transition",children:e.jsx(Vt,{className:"w-5 h-5 text-gray-500"})}),Me===t.id&&pe&&Mt.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>{$(null),O(null)}}),e.jsx("div",{className:"fixed w-56 bg-white rounded-lg shadow-lg border border-gray-200 z-20",style:{top:`${pe.top}px`,left:`${pe.left}px`},children:e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:()=>{X(t),$(null),O(null)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center space-x-3",children:[e.jsx(At,{className:"w-4 h-4"}),e.jsx("span",{children:"View Grant Details"})]}),e.jsxs("button",{onClick:()=>{vt(t),$(null),O(null)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center space-x-3",children:[e.jsx(Ut,{className:"w-4 h-4"}),e.jsx("span",{children:"Edit Grant"})]}),e.jsxs("button",{onClick:()=>{X(t),$(null),O(null)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center space-x-3",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{children:"View Contract"})]}),e.jsxs("button",{onClick:()=>{X(t),$(null),O(null)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center space-x-3",children:[e.jsx(Ce,{className:"w-4 h-4"}),e.jsx("span",{children:"View History"})]}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),e.jsxs("button",{onClick:()=>{Nt(t),$(null),O(null)},className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center space-x-3",children:[e.jsx(Qe,{className:"w-4 h-4"}),e.jsx("span",{children:"Delete Grant"})]})]})})]}),document.body)]})})]},t.id)})})]})})]}),it&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Issue New Grant"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Allocate shares to an employee from an active plan"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Employee*"}),e.jsxs("select",{value:a.employee_id,onChange:t=>V({...a,employee_id:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Choose an employee..."}),J.map(t=>e.jsxs("option",{value:t.id,children:[t.first_name_en," ",t.last_name_en," - ",t.employee_number," (",t.department||"No Dept",")"]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Plan*"}),e.jsxs("select",{value:a.plan_id,onChange:t=>V({...a,plan_id:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Choose a plan..."}),q.length===0?e.jsx("option",{value:"",disabled:!0,children:"No plans available"}):q.map(t=>e.jsxs("option",{value:t.id,children:[t.plan_name_en," (",t.plan_code,") - ",(t.actual_shares_available||t.shares_available).toLocaleString()," shares available"]},t.id))]}),q.length===0&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:"No active plans found. Please create a plan first or check if plans are active."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Select Vesting Schedule",e.jsx("span",{className:"text-gray-500 text-xs ml-1",children:"(optional - will use plan's default if not selected)"})]}),e.jsxs("select",{value:a.vesting_schedule_id,onChange:t=>V({...a,vesting_schedule_id:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Choose a vesting schedule..."}),T.length===0?e.jsx("option",{value:"",disabled:!0,children:"No vesting schedules available"}):T.map(t=>e.jsxs("option",{value:t.id,children:[t.name," - ",t.total_duration_months," months, ",t.cliff_months," month cliff, ",t.vesting_frequency]},t.id))]}),T.length===0&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:"No vesting schedules found. Please create a vesting schedule first."})]}),e.jsx("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.use_even_distribution,onChange:t=>V({...a,use_even_distribution:t.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Use Even Distribution"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"When enabled, shares are divided evenly across all periods (e.g., 5+5+5). When disabled, uses percentage-based calculation with floor rounding (e.g., 3+5+5, remainder to last)."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Shares*"}),e.jsx("input",{type:"number",value:a.total_shares,onChange:t=>V({...a,total_shares:parseInt(t.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"1000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vesting Start Date*"}),e.jsx("input",{type:"date",value:a.vesting_start_date,onChange:t=>V({...a,vesting_start_date:t.target.value}),min:(()=>{const t=q.find(s=>s.id===a.plan_id);return(t==null?void 0:t.start_date)||""})(),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(()=>{const t=q.find(s=>s.id===a.plan_id);return t!=null&&t.start_date&&a.vesting_start_date<t.start_date?e.jsxs("p",{className:"text-sm text-red-600 mt-1",children:["Vesting start date must be on or after the plan start date (",P(t.start_date),")"]}):null})()]})]}),a.plan_id&&(()=>{var d,c,f;const t=q.find(_=>_.id===a.plan_id),s=a.vesting_schedule_id?T.find(_=>_.id===a.vesting_schedule_id):null,r=(d=t==null?void 0:t.vesting_schedules)==null?void 0:d[0],l=s?Math.floor(s.total_duration_months/12):r?Math.floor(r.total_duration_months/12):((c=t==null?void 0:t.vesting_config)==null?void 0:c.years)||4,i=s?s.cliff_months:r?r.cliff_months:((f=t==null?void 0:t.vesting_config)==null?void 0:f.cliff_months)||12;return e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-blue-900 font-medium mb-2",children:"Grant Summary"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("li",{children:["â€¢ Shares to be granted: ",a.total_shares.toLocaleString()]}),e.jsxs("li",{children:["â€¢ Available in plan:"," ",((t==null?void 0:t.actual_shares_available)||(t==null?void 0:t.shares_available)||0).toLocaleString()]}),e.jsxs("li",{children:["â€¢ Vesting period: ",l," years"]}),e.jsxs("li",{children:["â€¢ Cliff period: ",i," months"]}),e.jsxs("li",{className:"pt-1 text-blue-700",children:["â€¢ Distribution method: ",a.use_even_distribution?"Even distribution (shares divided equally, remainder to last period)":"Percentage-based with floor rounding (remainder to last period)"]})]}),a.total_shares>0&&Te.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-900 font-medium mb-2",children:"Expected Vesting Events:"}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-blue-900 font-semibold border-b border-blue-300",children:[e.jsx("th",{className:"text-left py-1 px-2",children:"Event"}),e.jsx("th",{className:"text-left py-1 px-2",children:"Date"}),e.jsx("th",{className:"text-right py-1 px-2",children:"Shares"}),e.jsx("th",{className:"text-right py-1 px-2",children:"Cumulative"})]})}),e.jsx("tbody",{children:Te.map((_,o)=>e.jsxs("tr",{className:"text-blue-800 border-b border-blue-100",children:[e.jsx("td",{className:"py-1 px-2",children:_.type}),e.jsx("td",{className:"py-1 px-2",children:P(_.date)}),e.jsx("td",{className:"py-1 px-2 text-right",children:_.shares.toLocaleString()}),e.jsx("td",{className:"py-1 px-2 text-right font-medium",children:_.cumulative.toLocaleString()})]},o))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"text-blue-900 font-semibold border-t-2 border-blue-300",children:[e.jsx("td",{colSpan:2,className:"py-1 px-2",children:"Total"}),e.jsx("td",{className:"py-1 px-2 text-right",children:a.total_shares.toLocaleString()}),e.jsx("td",{className:"py-1 px-2 text-right",children:a.total_shares.toLocaleString()})]})})]})})]})]})})(),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Link Performance Metrics"}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Selected metrics will require confirmation before vesting performance events for this grant."}),e.jsx("div",{className:"max-h-48 overflow-y-auto border border-gray-200 rounded-lg divide-y divide-gray-100",children:Z.length>0?Z.map(t=>{const s=a.performance_metric_ids.includes(t.id);return e.jsxs("label",{className:"flex items-start justify-between px-4 py-3 cursor-pointer hover:bg-gray-50 transition",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:t.name}),e.jsxs("div",{className:"text-xs text-gray-500 flex flex-wrap gap-2 mt-1",children:[e.jsx("span",{className:"uppercase",children:t.metric_type}),t.unit_of_measure&&e.jsx("span",{children:t.unit_of_measure})]}),t.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-2 max-w-md break-words",children:t.description})]}),e.jsx("input",{type:"checkbox",className:"mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500",checked:s,onChange:()=>ft(t.id)})]},t.id)}):e.jsx("div",{className:"px-4 py-6 text-sm text-gray-500",children:"No performance metrics defined yet. Create metrics on the Performance Metrics page to link them here."})})]})]}),e.jsxs("div",{className:"flex-shrink-0 p-6 border-t border-gray-200 bg-white flex items-center justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{ee(!1),Ne()},className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition",children:"Cancel"}),e.jsx("button",{onClick:St,disabled:!a.employee_id||!a.plan_id||!a.total_shares||!a.vesting_start_date,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:"Issue Grant"})]})]})}),ot&&m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-5xl w-full max-h-[90vh] flex flex-col",children:[e.jsx("div",{className:"flex-shrink-0 p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Grant Details"}),e.jsx("p",{className:"text-gray-600 mt-1",children:m.grant_number})]}),e.jsx("button",{onClick:()=>{xe(!1),z(null),te(null),se([])},className:"text-gray-400 hover:text-gray-600",children:e.jsx(de,{className:"w-6 h-6"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Grant Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Employee"}),e.jsxs("p",{className:"text-base font-semibold text-gray-900",children:[(Ae=m.employees)==null?void 0:Ae.first_name_en," ",(Ue=m.employees)==null?void 0:Ue.last_name_en]}),e.jsx("p",{className:"text-sm text-gray-500",children:(Re=m.employees)==null?void 0:Re.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Department"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:((Ie=m.employees)==null?void 0:Ie.department)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Plan"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:(Oe=m.incentive_plans)==null?void 0:Oe.plan_name_en}),e.jsx("p",{className:"text-sm text-gray-500",children:(ze=m.incentive_plans)==null?void 0:ze.plan_code})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Plan Type"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:(He=m.incentive_plans)==null?void 0:He.plan_type})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Performance Metrics"}),m.grant_performance_metrics&&m.grant_performance_metrics.length>0?e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:m.grant_performance_metrics.map(t=>{var s;return e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-blue-50 text-blue-700 text-xs font-medium",children:((s=t.performance_metrics)==null?void 0:s.name)||"Metric"},t.performance_metric_id)})}):e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"No performance metrics linked"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Grant Date"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:P(m.grant_date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Status"}),e.jsx("div",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium mt-1",children:(()=>{const t=we[m.status],s=t.icon;return e.jsxs("div",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t.bg} ${t.color}`,children:[e.jsx(s,{className:"w-3.5 h-3.5 mr-1"}),t.label]})})()})]})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Vesting Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Shares"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.total_shares.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Vested Shares"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:Math.floor(F!==null?F:m.vested_shares).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Unvested Shares"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:Math.floor(m.total_shares-(F!==null?F:m.vested_shares)).toLocaleString()})]})]}),(ge>0||he>0)&&e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[ge>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Transferred"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:ge.toLocaleString()})]}),he>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Exercised"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:he.toLocaleString()})]})]}),e.jsxs("div",{className:"mt-3 text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium",children:"Rounding policy"}),e.jsx("p",{children:"Vesting events are calculated in whole shares (floor). Fractions are not issued."})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Vesting Progress"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[((F!==null?F:m.vested_shares)/m.total_shares*100).toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-blue-600 h-3 rounded-full transition-all",style:{width:`${(F!==null?F:m.vested_shares)/m.total_shares*100}%`}})})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Vesting Start"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:P(m.vesting_start_date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Vesting End"}),e.jsx("p",{className:"text-base font-semibold text-gray-900",children:P(m.vesting_end_date)})]}),D&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Cliff Period"}),e.jsxs("p",{className:"text-base font-semibold text-gray-900",children:[D.cliffMonths," months"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Cliff Date: ",P(D.cliffDate)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Vesting Frequency"}),e.jsx("p",{className:"text-base font-semibold text-gray-900 capitalize",children:D.vestingFrequency})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Vesting Type"}),e.jsx("p",{className:"text-base font-semibold text-gray-900 capitalize",children:D.vestingType.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Vesting Period"}),e.jsxs("p",{className:"text-base font-semibold text-gray-900",children:[D.vestingYears," years"]})]})]})]})]}),D&&e.jsx("div",{className:"border border-gray-200 rounded-lg",children:e.jsx(Tt,{grantDate:m.vesting_start_date,totalShares:m.total_shares,vestedShares:F!==null?F:m.vested_shares,vestingSchedule:{cliff_months:D.cliffMonths,total_duration_months:D.vestingYears*12,vesting_frequency:D.vestingFrequency},individualVestingRecords:D.individualVestingRecords})}),e.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(Q,{className:"w-5 h-5 mr-2"}),"Linked Contract"]})}),e.jsx("div",{className:"p-6",children:w?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:w.document_name}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Generated: ",P(w.generated_at)]}),w.approved_at&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Approved on: ",Be(w.approved_at)]})]}),e.jsxs("div",{children:[w.status==="draft"&&e.jsx("span",{className:"px-3 py-1 bg-gray-100 text-gray-800 text-sm font-medium rounded-full",children:"Draft"}),w.status==="pending_signature"&&e.jsx("span",{className:"px-3 py-1 bg-yellow-100 text-yellow-800 text-sm font-medium rounded-full",children:"Pending Signature"}),w.status==="signed"&&e.jsxs("span",{className:"px-3 py-1 bg-green-100 text-green-800 text-sm font-medium rounded-full flex items-center",children:[e.jsx(oe,{className:"w-4 h-4 mr-1"}),"Signed"]})]})]}),w.status==="draft"&&bt&&e.jsx("div",{className:"border-t border-gray-200 pt-4",children:e.jsx("button",{onClick:yt,disabled:je,className:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition disabled:opacity-60 disabled:cursor-not-allowed",children:je?"Approvingâ€¦":"Approve for Signature"})}),w.e_signatures&&w.e_signatures.length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Signature Status"}),w.e_signatures.map(t=>e.jsxs("div",{className:"flex items-center justify-between text-sm py-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-900",children:t.signer_name}),e.jsx("p",{className:"text-gray-500 text-xs",children:t.signer_role})]}),e.jsxs("div",{children:[t.signature_timestamp&&e.jsxs("p",{className:"text-green-600 text-xs",children:["Signed: ",P(t.signature_timestamp)]}),!t.signature_timestamp&&e.jsx("span",{className:"text-yellow-600 text-xs",children:"Pending"})]})]},t.id))]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No contract generated for this grant"})]})})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(Ce,{className:"w-5 h-5 mr-2"}),"Historical Actions"]})}),e.jsx("div",{className:"p-6",children:Ge.length>0?e.jsx("div",{className:"space-y-4",children:Ge.map(t=>e.jsx("div",{className:"flex items-start space-x-3 border-l-2 border-blue-500 pl-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t.modification_type}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.reason||"No reason provided"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:Be(t.created_at)})]})},t.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ce,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No historical actions recorded"})]})})]})]})}),e.jsx("div",{className:"flex-shrink-0 p-6 border-t border-gray-200 bg-white flex justify-end",children:e.jsx("button",{onClick:()=>{xe(!1),z(null),te(null),se([])},className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:"Close"})})]})}),ct&&m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Edit Grant"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Grant #",m.grant_number]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Employee"}),e.jsxs("p",{className:"text-gray-900 bg-gray-50 px-4 py-2 rounded-lg",children:[m.employees.first_name_en," ",m.employees.last_name_en]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Plan"}),e.jsx("p",{className:"text-gray-900 bg-gray-50 px-4 py-2 rounded-lg",children:m.incentive_plans.plan_name_en})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Total Shares"}),e.jsx("input",{type:"number",value:C.total_shares,onChange:t=>H({...C,total_shares:parseInt(t.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:C.status,onChange:t=>H({...C,status:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"pending_signature",children:"Pending Signature"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"forfeited",children:"Forfeited"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Grant Date"}),e.jsx("input",{type:"date",value:C.grant_date,onChange:t=>H({...C,grant_date:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vesting Start Date"}),e.jsx("input",{type:"date",value:C.vesting_start_date,onChange:t=>H({...C,vesting_start_date:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vesting End Date"}),e.jsx("input",{type:"date",value:C.vesting_end_date,onChange:t=>H({...C,vesting_end_date:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Linked Performance Metrics"}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Adjust which performance metrics apply to this grant."}),e.jsx("div",{className:"max-h-48 overflow-y-auto border border-gray-200 rounded-lg divide-y divide-gray-100",children:Z.length>0?Z.map(t=>{const s=ve.includes(t.id);return e.jsxs("label",{className:"flex items-start justify-between px-4 py-3 cursor-pointer hover:bg-gray-50 transition",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:t.name}),e.jsxs("div",{className:"text-xs text-gray-500 flex flex-wrap gap-2 mt-1",children:[e.jsx("span",{className:"uppercase",children:t.metric_type}),t.unit_of_measure&&e.jsx("span",{children:t.unit_of_measure})]}),t.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-2 max-w-md break-words",children:t.description})]}),e.jsx("input",{type:"checkbox",className:"mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500",checked:s,onChange:()=>_t(t.id)})]},t.id)}):e.jsx("div",{className:"px-4 py-6 text-sm text-gray-500",children:"No performance metrics defined yet. Create metrics on the Performance Metrics page to link them here."})})]})]}),e.jsxs("div",{className:"flex-shrink-0 p-6 border-t border-gray-200 bg-white flex items-center justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{ue(!1),z(null),le([])},className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{onClick:jt,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Save Changes"})]})]})}),xt&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full max-h-[80vh] flex flex-col",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Filter by Employee"}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Select one or more employees to filter grants"})]}),e.jsx("button",{onClick:()=>re(!1),className:"text-gray-400 hover:text-gray-600 transition",children:e.jsx(de,{className:"w-6 h-6"})})]})}),e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ke,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search employees...",value:ne,onChange:t=>ut(t.target.value),className:"w-full pl-9 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"space-y-2",children:ie.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ce,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"No employees found"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[ie.length," employee",ie.length!==1?"s":""," available"]}),S.length>0&&e.jsx("button",{onClick:()=>ye([]),className:"text-sm text-red-600 hover:text-red-800 transition",children:"Clear all"})]}),ie.map(t=>{const s=S.includes(t.id);return e.jsxs("label",{className:`flex items-center p-3 rounded-lg border cursor-pointer transition ${s?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-50"}`,children:[e.jsx("input",{type:"checkbox",checked:s,onChange:()=>pt(t.id),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("div",{className:"ml-3 flex-1",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(ce,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[t.first_name_en," ",t.last_name_en]}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center space-x-2",children:[e.jsx("span",{children:t.employee_number}),t.department&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:t.department})]})]})]})]})})]},t.id)})]})})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 bg-gray-50 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[S.length," employee",S.length!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>re(!1),className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition text-sm",children:"Cancel"}),e.jsx("button",{onClick:()=>re(!1),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm font-medium",children:"Apply Filter"})]})]})]})})]})}export{Xt as default};
