import{s as n,j as e}from"./index-DDk1oefv.js";import{r as i}from"./react-vendor-xiFAdxLt.js";import{f as o}from"./dateUtils-DoPl8O0G.js";import{P as G}from"./PortfolioValuation-i0FtqGxd.js";import{q as R,r as T,a as j,D as V,B as F,c as U,A as B,C as H}from"./ui-vendor-B0ZOy8uN.js";import"./supabase-vendor-B-LuImWU.js";function K(){const[a,N]=i.useState(null),[c,b]=i.useState([]),[h,w]=i.useState([]),[_,x]=i.useState(!0),[m,v]=i.useState(null),[g,S]=i.useState(30),[y,k]=i.useState("");i.useEffect(()=>{P()},[]);const P=async()=>{try{x(!0);const{data:{user:t}}=await n.auth.getUser();if(!t){window.location.href="/employee/login";return}const{data:s,error:l}=await n.from("employees").select("id, company_id, first_name_en, last_name_en").eq("user_id",t.id).maybeSingle();if(l||!s){console.error("Error loading employee:",l),x(!1);return}const[r,p,f]=await Promise.all([n.from("companies").select("company_name_en, tadawul_symbol, current_fmv, fmv_source").eq("id",s.company_id).maybeSingle(),n.from("portfolios").select("*").eq("company_id",s.company_id).eq("employee_id",s.id).eq("portfolio_type","employee_vested").maybeSingle(),n.from("grants").select(`
            id,
            grant_number,
            total_shares,
            vested_shares,
            remaining_unvested_shares,
            grant_date,
            status,
            incentive_plans:plan_id (
              plan_name_en,
              plan_code,
              plan_type,
              exercise_price
            )
          `).eq("employee_id",s.id).eq("status","active").order("grant_date",{ascending:!1})]);if(r.data){v(r.data),k(r.data.tadawul_symbol||"");const d=r.data.current_fmv;S(d?Number(d):30)}if(p.data){N(p.data);const{data:d,error:E}=await n.from("transfers").select(`
            id,
            transfer_number,
            shares_transferred,
            transfer_date,
            status,
            transfer_type,
            grants:grant_id (
              grant_number,
              incentive_plans:plan_id (
                plan_name_en,
                plan_code
              )
            )
          `).eq("to_portfolio_id",p.data.id).order("transfer_date",{ascending:!1}).limit(10);!E&&d&&w(d)}f.data&&b(f.data)}catch(t){console.error("Error loading portfolio data:",t)}finally{x(!1)}},u=(a==null?void 0:a.total_shares)||0,L=(a==null?void 0:a.available_shares)||0,D=(a==null?void 0:a.locked_shares)||0,q=c.reduce((t,s)=>t+Number(s.vested_shares||0),0),A=c.reduce((t,s)=>t+Number(s.remaining_unvested_shares||0),0),C=u*g;return _?e.jsx("div",{className:"flex items-center justify-center",style:{minHeight:"calc(100vh - 200px)"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-4",children:"Loading your portfolio..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"My Portfolio"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"View your equity portfolio and transaction history"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Shares"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:u.toLocaleString()})]}),e.jsx(R,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Available Shares"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 mt-1",children:L.toLocaleString()})]}),e.jsx(T,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Locked Shares"}),e.jsx("p",{className:"text-2xl font-bold text-amber-600 mt-1",children:D.toLocaleString()})]}),e.jsx(j,{className:"w-8 h-8 text-amber-600"})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Portfolio Value"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600 mt-1",children:["SAR ",C.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["@ SAR ",g.toFixed(2)," per share"]})]}),e.jsx(V,{className:"w-8 h-8 text-purple-600"})]})})]}),a?e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(F,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Portfolio Details"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Portfolio Number"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-1",children:a.portfolio_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Company"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-1",children:(m==null?void 0:m.company_name_en)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Created Date"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-1",children:o(a.created_at)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Last Updated"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-1",children:o(a.updated_at)})]})]})]}):e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(j,{className:"w-6 h-6 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-yellow-900",children:"No Portfolio Found"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"Your portfolio will be created automatically when shares are transferred to you."})]})]})}),a&&y&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Portfolio Valuation"}),e.jsx(G,{tadawulSymbol:y,vestedShares:q,unvestedShares:A})]}),c.length>0&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(U,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Grants Breakdown"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Grant Number"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Plan"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Shares"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Vested"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unvested"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Grant Date"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(t=>{var s,l,r;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.grant_number}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:((s=t.incentive_plans)==null?void 0:s.plan_name_en)||"N/A"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[((l=t.incentive_plans)==null?void 0:l.plan_code)||""," (",((r=t.incentive_plans)==null?void 0:r.plan_type)||"",")"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:Number(t.total_shares||0).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-green-600 font-medium",children:Number(t.vested_shares||0).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:Number(t.remaining_unvested_shares||0).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:o(t.grant_date)})]},t.id)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(B,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Transaction History"})]}),h.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Transfer Number"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Grant"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Shares"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.map(t=>{var s,l,r;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.transfer_number}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[((s=t.grants)==null?void 0:s.grant_number)||"N/A",((r=(l=t.grants)==null?void 0:l.incentive_plans)==null?void 0:r.plan_name_en)&&e.jsx("div",{className:"text-xs text-gray-500",children:t.grants.incentive_plans.plan_name_en})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:Number(t.shares_transferred||0).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:o(t.transfer_date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t.status==="completed"?"bg-green-100 text-green-800":t.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:t.status})})]},t.id)})})]})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(H,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{children:"No transactions yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Your transfer history will appear here once shares are transferred to your portfolio."})]})]})]})}export{K as default};
