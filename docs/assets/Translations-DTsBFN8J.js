import{a as z,u as B,s as h,j as e,r as b}from"./index-CHcuUdej.js";import{r as n}from"./react-vendor-xiFAdxLt.js";import{q as k,x as A,G as H,s as I,X as J,y as Q,W as Y}from"./ui-vendor-a8g5-7pO.js";import"./supabase-vendor-B-LuImWU.js";function re(){const{t:r,i18n:L}=z(),{isSuperAdmin:y}=B(),[K,F]=n.useState([]),[P,S]=n.useState(!0),[c,V]=n.useState(""),[j,q]=n.useState("all"),[v,D]=n.useState("all"),[O,N]=n.useState(null),[d,x]=n.useState({en:"",ar:""}),[$,m]=n.useState(!1),[f,l]=n.useState(null),[w,C]=n.useState(!1),[u,T]=n.useState(""),[i,p]=n.useState({en:"",ar:""}),t=L.language==="ar";n.useEffect(()=>{y()&&_()},[y]);const _=async()=>{try{S(!0);const{data:s,error:a}=await h.from("translations").select("*").order("translation_key",{ascending:!0});if(a)throw a;F(s||[])}catch(s){console.error("Error loading translations:",s),l({type:"error",text:r("translations.error")})}finally{S(!1)}},o=K.reduce((s,a)=>(s[a.translation_key]||(s[a.translation_key]={en:"",ar:""}),s[a.translation_key][a.language_code]=a.translation_value,s),{}),G=n.useMemo(()=>{const s=new Set;return Object.keys(o).forEach(a=>{const g=a.split(".");g.length>0&&s.add(g[0])}),Array.from(s).sort()},[o]),M=Object.keys(o).filter(s=>{if(v!=="all"&&!s.startsWith(`${v}.`))return!1;const a=s.toLowerCase().includes(c.toLowerCase())||o[s].en.toLowerCase().includes(c.toLowerCase())||o[s].ar.includes(c);return j==="all"?a:j==="en"?a&&o[s].en.toLowerCase().includes(c.toLowerCase()):a&&o[s].ar.includes(c)}),R=s=>{N(s),x({en:o[s].en||"",ar:o[s].ar||""})},U=()=>{N(null),x({en:"",ar:""})},W=async s=>{try{m(!0),l(null);const{error:a}=await h.from("translations").upsert({translation_key:s,language_code:"en",translation_value:d.en,namespace:"translation"},{onConflict:"translation_key,language_code,namespace"});if(a)throw a;const{error:g}=await h.from("translations").upsert({translation_key:s,language_code:"ar",translation_value:d.ar,namespace:"translation"},{onConflict:"translation_key,language_code,namespace"});if(g)throw g;await b("en"),await b("ar"),await _(),N(null),x({en:"",ar:""}),l({type:"success",text:r("translations.saved")}),setTimeout(()=>l(null),3e3)}catch(a){console.error("Error saving translation:",a),l({type:"error",text:r("translations.error")})}finally{m(!1)}},X=async()=>{if(!u.trim()){l({type:"error",text:"Translation key is required"});return}if(!i.en.trim()&&!i.ar.trim()){l({type:"error",text:"At least one translation value (English or Arabic) is required"});return}try{if(m(!0),l(null),Object.keys(o).includes(u)){l({type:"error",text:"Translation key already exists. Please use edit instead."}),m(!1);return}if(i.en.trim()){const{error:a}=await h.from("translations").insert({translation_key:u.trim(),language_code:"en",translation_value:i.en.trim(),namespace:"translation"});if(a)throw a}if(i.ar.trim()){const{error:a}=await h.from("translations").insert({translation_key:u.trim(),language_code:"ar",translation_value:i.ar.trim(),namespace:"translation"});if(a)throw a}await b("en"),await b("ar"),await _(),T(""),p({en:"",ar:""}),C(!1),l({type:"success",text:"Translation added successfully"}),setTimeout(()=>l(null),3e3)}catch(s){console.error("Error adding translation:",s),l({type:"error",text:s.message||"Error adding translation. The key might already exist."})}finally{m(!1)}},E=()=>{C(!1),T(""),p({en:"",ar:""})};return y()?P?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:`flex items-center justify-between ${t?"flex-row-reverse":""}`,children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:r("translations.title")}),e.jsx("p",{className:"text-gray-600 mt-1",children:r("translations.description")})]}),e.jsxs("div",{className:`flex items-center gap-3 ${t?"flex-row-reverse":""}`,children:[e.jsxs("button",{onClick:()=>C(!w),className:`flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition ${t?"space-x-reverse":""}`,children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{children:w?"Cancel":"Add New Translation"})]}),e.jsx(H,{className:"w-8 h-8 text-blue-600"})]})]}),f&&e.jsxs("div",{className:`p-4 rounded-lg border flex items-center space-x-2 ${t?"space-x-reverse":""} ${f.type==="success"?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:[f.type==="success"?e.jsx(I,{className:"w-5 h-5"}):e.jsx(k,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:f.text})]}),w&&e.jsxs("div",{className:"bg-white rounded-xl border-2 border-blue-200 border-dashed p-6",children:[e.jsxs("div",{className:`flex items-center justify-between mb-4 ${t?"flex-row-reverse":""}`,children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Add New Translation"}),e.jsx("button",{onClick:E,className:"text-gray-500 hover:text-gray-700",children:e.jsx(J,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Translation Key ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:u,onChange:s=>T(s.target.value),placeholder:"e.g., dashboard.newFeature",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-left"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Use dot notation (e.g., dashboard.title, common.save)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r("translations.english")}),e.jsx("input",{type:"text",value:i.en,onChange:s=>p({...i,en:s.target.value}),placeholder:"English translation",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-left"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r("translations.arabic")}),e.jsx("input",{type:"text",value:i.ar,onChange:s=>p({...i,ar:s.target.value}),placeholder:"الترجمة العربية",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-right",dir:"rtl"})]})]}),e.jsxs("div",{className:`flex gap-2 ${t?"flex-row-reverse":""}`,children:[e.jsxs("button",{onClick:X,disabled:$||!u.trim(),className:`flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed ${t?"space-x-reverse":""}`,children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{children:"Add Translation"})]}),e.jsx("button",{onClick:E,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:r("common.cancel")})]})]})]}),e.jsxs("div",{className:`bg-white rounded-xl border border-gray-200 p-6 ${t?"text-right":"text-left"}`,children:[e.jsxs("div",{className:`flex flex-wrap gap-4 mb-6 ${t?"flex-row-reverse":""}`,children:[e.jsxs("div",{className:"flex-1 relative min-w-[200px]",children:[e.jsx(Q,{className:`absolute top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400 ${t?"right-3":"left-3"}`}),e.jsx("input",{type:"text",placeholder:r("translations.search"),value:c,onChange:s=>V(s.target.value),className:`w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${t?"text-right pr-10 pl-4":"text-left"}`})]}),e.jsxs("select",{value:v,onChange:s=>D(s.target.value),className:`px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${t?"text-right":"text-left"}`,children:[e.jsx("option",{value:"all",children:r("translations.allPages")}),G.map(s=>e.jsx("option",{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))]}),e.jsxs("select",{value:j,onChange:s=>q(s.target.value),className:`px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${t?"text-right":"text-left"}`,children:[e.jsx("option",{value:"all",children:r("translations.all")}),e.jsx("option",{value:"en",children:r("translations.english")}),e.jsx("option",{value:"ar",children:r("translations.arabic")})]})]}),e.jsx("div",{className:"space-y-4 max-h-[600px] overflow-y-auto",children:M.map(s=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:O===s?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r("translations.english")}),e.jsx("input",{type:"text",value:d.en,onChange:a=>x({...d,en:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-left"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r("translations.arabic")}),e.jsx("input",{type:"text",value:d.ar,onChange:a=>x({...d,ar:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-right",dir:"rtl"})]})]}),e.jsxs("div",{className:`flex gap-2 ${t?"flex-row-reverse":""}`,children:[e.jsxs("button",{onClick:()=>W(s),disabled:$,className:`flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed ${t?"space-x-reverse":""}`,children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{children:r("common.save")})]}),e.jsx("button",{onClick:U,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:r("common.cancel")})]})]}):e.jsxs("div",{className:`flex items-center justify-between ${t?"flex-row-reverse":""}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900 mb-2",children:s}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-gray-500",children:[r("translations.english"),":"]}),e.jsx("div",{className:"text-gray-900 mt-1",children:o[s].en||"-"})]}),e.jsxs("div",{className:t?"text-right":"text-left",children:[e.jsxs("span",{className:"text-gray-500",children:[r("translations.arabic"),":"]}),e.jsx("div",{className:"text-gray-900 mt-1",dir:"rtl",children:o[s].ar||"-"})]})]})]}),e.jsx("button",{onClick:()=>R(s),className:`px-3 py-1 text-sm text-blue-600 hover:bg-blue-50 rounded-lg ${t?"mr-4":"ml-4"}`,children:r("common.edit")})]})},s))})]})]}):e.jsxs("div",{className:"bg-white rounded-xl p-12 border border-gray-200 text-center",children:[e.jsx(k,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:r("common.accessDenied")}),e.jsx("p",{className:"text-gray-600",children:r("common.accessDeniedDescription")})]})}export{re as default};
