import{a as A,u as C,s as E,j as e}from"./index-DDk1oefv.js";import{r as o}from"./react-vendor-xiFAdxLt.js";import{B as b,g as N,c as T,l as B,a8 as F}from"./ui-vendor-B0ZOy8uN.js";import"./supabase-vendor-B-LuImWU.js";function O(){const{t:q,i18n:v}=A();v.language;const[r,w]=o.useState([]),[_,h]=o.useState(!0),[f,y]=o.useState(null),[d,S]=o.useState("all"),{userRole:i,isSuperAdmin:j}=C(),g=o.useMemo(()=>j()||(i==null?void 0:i.user_type)==="super_admin"||(i==null?void 0:i.role)==="super_admin",[i,j]);o.useEffect(()=>{if(!g){y("Access denied. Super admin only."),h(!1);return}P()},[g]);const P=async()=>{try{h(!0),y(null);const{data:s,error:a}=await E.from("portfolios").select(`
          *,
          companies:company_id (
            company_name_en,
            company_name_ar,
            tadawul_symbol
          ),
          employees:employee_id (
            first_name_en,
            last_name_en,
            employee_number
          )
        `).order("created_at",{ascending:!1});if(a)throw a;w(s||[])}catch(s){console.error("Error loading portfolios:",s),y("Failed to load portfolios.")}finally{h(!1)}},u=o.useMemo(()=>d==="all"?r:r.filter(s=>s.portfolio_type===d),[r,d]),l=o.useMemo(()=>{const s=r.filter(t=>t.portfolio_type==="company_reserved"),a=r.filter(t=>t.portfolio_type==="employee_vested"),c=s.reduce((t,n)=>t+(n.total_shares||0),0),x=a.reduce((t,n)=>t+(n.total_shares||0),0),m=r.reduce((t,n)=>t+(n.available_shares||0),0),p=r.reduce((t,n)=>t+(n.locked_shares||0),0),k=new Set(r.map(t=>t.company_id)).size,L=new Set(a.map(t=>t.employee_id).filter(Boolean)).size;return{totalPortfolios:r.length,companyPortfolios:s.length,employeePortfolios:a.length,totalCompanyShares:c,totalEmployeeShares:x,totalAvailableShares:m,totalLockedShares:p,uniqueCompanies:k,uniqueEmployees:L}},[r]);return g?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"All Portfolios"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"View all portfolios across all companies with statistics"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("select",{value:d,onChange:s=>S(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"company_reserved",children:"Company Reserved"}),e.jsx("option",{value:"employee_vested",children:"Employee Vested"})]})})]}),f&&e.jsx("div",{className:"p-4 rounded-lg border border-red-200 bg-red-50 text-red-700",children:f}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Portfolios"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:l.totalPortfolios}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[l.companyPortfolios," company, ",l.employeePortfolios," employee"]})]}),e.jsx(b,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Companies"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 mt-1",children:l.uniqueCompanies})]}),e.jsx(N,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Shares"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 mt-1",children:(l.totalCompanyShares+l.totalEmployeeShares).toLocaleString()}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[l.totalCompanyShares.toLocaleString()," company, ",l.totalEmployeeShares.toLocaleString()," employee"]})]}),e.jsx(T,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Available Shares"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 mt-1",children:l.totalAvailableShares.toLocaleString()}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[l.totalLockedShares.toLocaleString()," locked"]})]}),e.jsx(B,{className:"w-8 h-8 text-blue-600"})]})})]}),_?e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading portfolios..."})]}):e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(b,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"All Portfolios"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Showing ",u.length," of ",r.length," portfolios"]})]})]})}),u.length===0?e.jsx("div",{className:"p-10 text-center text-gray-500",children:"No portfolios found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Portfolio #"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Company"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Owner"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Shares"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Available"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Locked"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map(s=>{var x,m,p;const a=s.companies,c=s.employees;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.portfolio_number})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold ${s.portfolio_type==="company_reserved"?"bg-blue-50 text-blue-700":"bg-green-50 text-green-700"}`,children:s.portfolio_type==="company_reserved"?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-3 h-3 mr-1"}),"Company"]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-3 h-3 mr-1"}),"Employee"]})})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:(a==null?void 0:a.company_name_en)||"N/A"}),(a==null?void 0:a.tadawul_symbol)&&e.jsx("div",{className:"text-xs text-gray-500",children:a.tadawul_symbol})]}),e.jsx("td",{className:"px-6 py-4",children:s.portfolio_type==="employee_vested"&&c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[c.first_name_en," ",c.last_name_en]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["#",c.employee_number]})]}):e.jsx("span",{className:"text-sm text-gray-400",children:"Company Reserved"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:((x=s.total_shares)==null?void 0:x.toLocaleString())||0}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-green-600",children:((m=s.available_shares)==null?void 0:m.toLocaleString())||0}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:((p=s.locked_shares)==null?void 0:p.toLocaleString())||0}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(s.created_at).toLocaleDateString("en-GB")})]},s.id)})})]})})]})]}):e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-700",children:"Access denied. Super admin only."})})})}export{O as default};
