import{a as F,s as n,j as e}from"./index-CHcuUdej.js";import{r as i}from"./react-vendor-xiFAdxLt.js";import{f as m}from"./dateUtils-DoPl8O0G.js";import{P as T}from"./PortfolioValuation-DO40RP8Y.js";import{r as V,s as U,a as N,D as B,B as G,c as H,A as M,C as $}from"./ui-vendor-a8g5-7pO.js";import"./supabase-vendor-B-LuImWU.js";function W(){const{t}=F(),[r,b]=i.useState(null),[c,w]=i.useState([]),[y,_]=i.useState([]),[v,x]=i.useState(!0),[p,P]=i.useState(null),[g,S]=i.useState(30),[f,k]=i.useState("");i.useEffect(()=>{D()},[]);const D=async()=>{try{x(!0);const{data:{user:s}}=await n.auth.getUser();if(!s){window.location.href="/employee/login";return}const{data:a,error:o}=await n.from("employees").select("id, company_id, first_name_en, last_name_en").eq("user_id",s.id).maybeSingle();if(o||!a){console.error("Error loading employee:",o),x(!1);return}const[l,h,j]=await Promise.all([n.from("companies").select("company_name_en, tadawul_symbol, current_fmv, fmv_source").eq("id",a.company_id).maybeSingle(),n.from("portfolios").select("*").eq("company_id",a.company_id).eq("employee_id",a.id).eq("portfolio_type","employee_vested").maybeSingle(),n.from("grants").select(`
            id,
            grant_number,
            total_shares,
            vested_shares,
            remaining_unvested_shares,
            grant_date,
            status,
            incentive_plans:plan_id (
              plan_name_en,
              plan_code,
              plan_type,
              exercise_price
            )
          `).eq("employee_id",a.id).eq("status","active").order("grant_date",{ascending:!1})]);if(l.data){P(l.data),k(l.data.tadawul_symbol||"");const d=l.data.current_fmv;S(d?Number(d):30)}if(h.data){b(h.data);const{data:d,error:C}=await n.from("transfers").select(`
            id,
            transfer_number,
            shares_transferred,
            transfer_date,
            status,
            transfer_type,
            grants:grant_id (
              grant_number,
              incentive_plans:plan_id (
                plan_name_en,
                plan_code
              )
            )
          `).eq("to_portfolio_id",h.data.id).order("transfer_date",{ascending:!1}).limit(10);!C&&d&&_(d)}j.data&&w(j.data)}catch(s){console.error("Error loading portfolio data:",s)}finally{x(!1)}},u=(r==null?void 0:r.total_shares)||0,L=(r==null?void 0:r.available_shares)||0,q=(r==null?void 0:r.locked_shares)||0,E=c.reduce((s,a)=>s+Number(a.vested_shares||0),0),A=c.reduce((s,a)=>s+Number(a.remaining_unvested_shares||0),0),R=u*g;return v?e.jsx("div",{className:"flex items-center justify-center",style:{minHeight:"calc(100vh - 200px)"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-4",children:t("employeePortfolio.loading")})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:t("employeePortfolio.title")}),e.jsx("p",{className:"text-gray-600 mt-1",children:t("employeePortfolio.description")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:t("employeePortfolio.totalShares")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:u.toLocaleString()})]}),e.jsx(V,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:t("employeePortfolio.availableShares")}),e.jsx("p",{className:"text-2xl font-bold text-green-600 mt-1",children:L.toLocaleString()})]}),e.jsx(U,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:t("employeePortfolio.lockedShares")}),e.jsx("p",{className:"text-2xl font-bold text-amber-600 mt-1",children:q.toLocaleString()})]}),e.jsx(N,{className:"w-8 h-8 text-amber-600"})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:t("employeePortfolio.portfolioValue")}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600 mt-1",children:["SAR ",R.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["@ SAR ",g.toFixed(2)," ",t("employeePortfolio.perShare")]})]}),e.jsx(B,{className:"w-8 h-8 text-purple-600"})]})})]}),r?e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(G,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:t("employeePortfolio.portfolioDetails")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:t("employeePortfolio.portfolioNumber")}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-1",children:r.portfolio_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:t("employeePortfolio.company")}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-1",children:(p==null?void 0:p.company_name_en)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:t("employeePortfolio.createdDate")}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-1",children:m(r.created_at)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:t("employeePortfolio.lastUpdated")}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-1",children:m(r.updated_at)})]})]})]}):e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(N,{className:"w-6 h-6 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-yellow-900",children:t("employeePortfolio.noPortfolioFound")}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:t("employeePortfolio.noPortfolioMessage")})]})]})}),r&&f&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:t("employeePortfolio.portfolioValuation")}),e.jsx(T,{tadawulSymbol:f,vestedShares:E,unvestedShares:A})]}),c.length>0&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(H,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:t("employeePortfolio.grantsBreakdown")})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("employeePortfolio.grantNumber")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("employeePortfolio.plan")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("employeePortfolio.totalShares")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("employeePortfolio.vested")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("employeePortfolio.unvested")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("employeePortfolio.grantDate")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(s=>{var a,o,l;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.grant_number}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:((a=s.incentive_plans)==null?void 0:a.plan_name_en)||"N/A"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[((o=s.incentive_plans)==null?void 0:o.plan_code)||""," (",((l=s.incentive_plans)==null?void 0:l.plan_type)||"",")"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:Number(s.total_shares||0).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-green-600 font-medium",children:Number(s.vested_shares||0).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:Number(s.remaining_unvested_shares||0).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:m(s.grant_date)})]},s.id)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(M,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:t("employeePortfolio.transactionHistory")})]}),y.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("employeePortfolio.transferNumber")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("employeePortfolio.grant")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("employeePortfolio.shares")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("employeePortfolio.date")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("employeePortfolio.status")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:y.map(s=>{var a,o,l;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.transfer_number}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[((a=s.grants)==null?void 0:a.grant_number)||"N/A",((l=(o=s.grants)==null?void 0:o.incentive_plans)==null?void 0:l.plan_name_en)&&e.jsx("div",{className:"text-xs text-gray-500",children:s.grants.incentive_plans.plan_name_en})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:Number(s.shares_transferred||0).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:m(s.transfer_date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.status==="completed"?"bg-green-100 text-green-800":s.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:s.status})})]},s.id)})})]})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx($,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{children:t("employeePortfolio.noTransactions")}),e.jsx("p",{className:"text-sm mt-1",children:t("employeePortfolio.noTransactionsMessage")})]})]})]})}export{W as default};
