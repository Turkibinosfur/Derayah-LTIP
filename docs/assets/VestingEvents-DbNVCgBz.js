import{s as f,j as e}from"./index-DDk1oefv.js";import{r as l}from"./react-vendor-xiFAdxLt.js";import{u as Js,b as et,g as st,c as tt,d as at,t as us,e as rt,p as nt}from"./vestingEventsService-q0CQjbrA.js";import{b as W,f as O,a as gs}from"./dateUtils-DoPl8O0G.js";import{f as R}from"./numberUtils-CWVJ76A6.js";import{c as fs,W as lt,o as be,n as ye,C as it,p as ae,a as ct,r as ps,b as K,s as ot,P as qe,y as dt,U as je,X as D,T as xt,_ as mt,D as ht,$ as bs,a0 as ys,x as js}from"./ui-vendor-B0ZOy8uN.js";import"./supabase-vendor-B-LuImWU.js";function Nt(){var as,rs,ns,ls,is,cs,os,ds,xs,ms,hs;const[k,vs]=l.useState([]),[d,Ns]=l.useState(null),[ws,_s]=l.useState(!0),[ve,P]=l.useState("all"),[Ne,Cs]=l.useState("all"),[we,Z]=l.useState(null),[U,Es]=l.useState([]),[M,re]=l.useState([]),[Ss,ne]=l.useState(!1),[Re,Ue]=l.useState(!1),[n,ks]=l.useState(null),[Ps,B]=l.useState(!1),[Ms,le]=l.useState(!1),[y,_e]=l.useState([]),[ie,Ts]=l.useState(""),[Ce,Is]=l.useState([]),[Fs,ce]=l.useState(!1),[j,Ee]=l.useState([]),[oe,Ds]=l.useState(""),[Be,Ls]=l.useState([]),[Q,ze]=l.useState(!0),[z,He]=l.useState(!0),[Se,T]=l.useState(null),[C,ke]=l.useState(null),[de,I]=l.useState(null),[F,Pe]=l.useState(null),[H,L]=l.useState(null),[X,$]=l.useState(null),V=l.useRef(null),G=l.useRef(null),[J,Xe]=l.useState(!0),[ee,$s]=l.useState(!0),[Vs,Ye]=l.useState(!1),[g,We]=l.useState(null),[xe,me]=l.useState({confirmed:!1,notes:"",actualValue:""}),[Y,Me]=l.useState(!1),[Te,Ie]=l.useState({}),[Gs,he]=l.useState(!1),[v,Oe]=l.useState(null),[c,Ke]=l.useState(null),[Ze,Qe]=l.useState(!1),[se,Fe]=l.useState(!1),As=s=>["performance","performance_based","hybrid"].includes(s),[ut,qs]=l.useState([]);l.useEffect(()=>{ue(),ge(),Rs(),Us()},[ve,Ne,y,j]);const ue=async()=>{try{const{data:{user:s}}=await f.auth.getUser();if(console.log("ðŸ‘¤ Current user:",s==null?void 0:s.id,s==null?void 0:s.email),!s)return;const{data:a}=await f.from("company_users").select("company_id").eq("user_id",s.id).single();if(console.log("ðŸ¢ Company user data:",a),!a){console.warn("âš ï¸ No company association found for user");return}console.log("ðŸ” Loading vesting events for company:",a.company_id),await Js();const t=j.length>0?j:void 0,r=t?100:1e3;let o=await et(a.company_id,ve,Ne,r,t);y.length>0&&(o=o.filter(x=>y.includes(x.employee_id))),console.log("ðŸ“Š Events for counting:",o.length),qs(o);let h=o;console.log("ðŸ“Š Loaded vesting events for table:",h.length),vs(h)}catch(s){console.error("âŒ Error loading vesting events:",s)}finally{_s(!1)}},ge=async()=>{try{const{data:{user:s}}=await f.auth.getUser();if(!s)return;const{data:a}=await f.from("company_users").select("company_id").eq("user_id",s.id).single();if(!a)return;const t=await st(a.company_id);t.success&&Ns(t.data)}catch(s){console.error("Error loading vesting stats:",s)}},Rs=async()=>{try{const{data:{user:s}}=await f.auth.getUser();if(!s)return;const{data:a}=await f.from("company_users").select("company_id").eq("user_id",s.id).single();if(!a)return;const{data:t,error:r}=await f.from("employees").select("id, employee_number, first_name_en, last_name_en, email, department").eq("company_id",a.company_id).eq("employment_status","active").order("first_name_en",{ascending:!0});if(r)throw r;t&&Is(t)}catch(s){console.error("Error loading employees:",s)}},Us=async()=>{try{const{data:{user:s}}=await f.auth.getUser();if(!s)return;const{data:a}=await f.from("company_users").select("company_id").eq("user_id",s.id).single();if(!a)return;const{data:t,error:r}=await f.from("grants").select(`
          id,
          grant_number,
          total_shares,
          status,
          vesting_start_date,
          employees!inner (
            first_name_en,
            last_name_en
          ),
          incentive_plans!inner (
            plan_name_en,
            plan_code
          )
        `).eq("company_id",a.company_id).in("status",["active","pending_signature"]).order("grant_number",{ascending:!0});if(r)throw r;if(!t)return;const o=t.map(u=>u.id),{data:h,error:x}=await f.from("vesting_events").select("grant_id").in("grant_id",o);x&&console.error("Error loading vesting event counts:",x);const i={};h&&h.forEach(u=>{i[u.grant_id]=(i[u.grant_id]||0)+1});const m=t.map(u=>({...u,vesting_event_count:i[u.id]||0}));Ls(m)}catch(s){console.error("Error loading grants:",s)}},Bs=()=>{_e([])},zs=s=>{_e(a=>a.includes(s)?a.filter(t=>t!==s):[...a,s])},fe=Ce.filter(s=>s.first_name_en.toLowerCase().includes(ie.toLowerCase())||s.last_name_en.toLowerCase().includes(ie.toLowerCase())||s.employee_number.toLowerCase().includes(ie.toLowerCase())),Hs=()=>{Ee([])},Xs=s=>{Ee(a=>a.includes(s)?a.filter(t=>t!==s):[...a,s])},pe=Be.filter(s=>{var a,t,r;return s.grant_number.toLowerCase().includes(oe.toLowerCase())||(((a=s.employees)==null?void 0:a.first_name_en)+" "+((t=s.employees)==null?void 0:t.last_name_en)).toLowerCase().includes(oe.toLowerCase())||((r=s.incentive_plans)==null?void 0:r.plan_name_en.toLowerCase().includes(oe.toLowerCase()))}),Je=async()=>{try{const{data:{user:s}}=await f.auth.getUser();if(!s)return;const{data:a}=await f.from("company_users").select("company_id").eq("user_id",s.id).single();if(!a)return;const t=await tt(a.company_id);t.success&&Es(t.data||[])}catch(s){console.error("Error loading grants without events:",s)}},Ys=s=>{re(a=>a.includes(s)?a.filter(t=>t!==s):[...a,s])},De=M.length>0&&M.length===U.length,Ws=()=>{re(De?[]:U.map(s=>s.id))},Os=async()=>{Ue(!0);try{const{data:{user:s}}=await f.auth.getUser();if(!s)return;const{data:a}=await f.from("company_users").select("company_id").eq("user_id",s.id).single();if(!a)return;const t=await at(a.company_id,M);if(t.success){const r=t.data;alert(`Vesting events generation completed!

Processed: ${r.processed} grants
Skipped: ${r.skipped} grants
Errors: ${r.errors} grants`),await ue(),await ge(),await Je(),re([]),ne(!1)}else alert(`Error: ${t.error}`)}catch(s){console.error("Error generating vesting events:",s),alert("Failed to generate vesting events")}finally{Ue(!1)}},es=s=>{ks(s),B(!0)},A=async(s,a,t)=>{var r,o,h;Z(s);try{if(a==="vest"){const i=k.find(m=>m.id===s);if(i&&!((r=i.grants)!=null&&r.employee_acceptance_at)){alert("Cannot process vesting: The employee contract has not been signed yet. The employee needs to sign the contract in order to proceed with vesting the shares and transferring them to the employee portfolio."),Z(null);return}if(i&&i.requiresPerformanceConfirmation&&!(t!=null&&t.skipPerformanceCheck)&&As(i.event_type)){We(i),me({confirmed:!1,notes:i.performance_notes||"",actualValue:((o=i.performanceMetric)==null?void 0:o.actual_value)!==void 0&&((h=i.performanceMetric)==null?void 0:h.actual_value)!==null?String(i.performanceMetric.actual_value):""});const m=i.grantPerformanceMetrics&&i.grantPerformanceMetrics.length>0?i.grantPerformanceMetrics:i.performanceMetric?[i.performanceMetric]:[],u={};m.forEach(w=>{w!=null&&w.id&&(u[w.id]=!1)}),Ie(u),Z(null),Ye(!0);return}}if(a==="transfer"){const i=k.find(m=>m.id===s);if(i){Oe(i),he(!0),Z(null),await Ks(s,i);return}}let x;switch(a){case"vest":x=await nt(s);break;case"exercise":x=await rt(s);break;case"transfer":x=await us(s);break}x.success?(await ue(),await ge(),alert(a==="transfer"?"Transfer request created successfully! The transfer request has been added to the Transfers page for processing.":`Successfully ${a}ed vesting event!`)):alert(`Error: ${x.error}`)}catch(x){console.error(`Error ${a}ing vesting event:`,x),alert(`Failed to ${a} vesting event`)}finally{Z(null)}},Le=()=>{Ye(!1),We(null),me({confirmed:!1,notes:"",actualValue:""}),Me(!1),Ie({})},Ks=async(s,a)=>{var t;Qe(!0);try{const r=a.company_id||((t=a.grants)==null?void 0:t.company_id),o=a.employee_id;if(!r||!o){alert("Missing company or employee information"),he(!1);return}const{data:h,error:x}=await f.from("portfolios").select("*").eq("company_id",r);if(x)throw x;const i=h==null?void 0:h.find(_=>_.portfolio_type==="company_reserved"&&_.company_id===r&&_.employee_id===null),m=h==null?void 0:h.find(_=>_.portfolio_type==="employee_vested"&&_.employee_id===o&&_.company_id===r),{data:u,error:w}=await f.from("employee_financial_info").select("*").eq("employee_id",o).maybeSingle();w&&w.code!=="PGRST116"&&console.error("Error fetching financial info:",w),Ke({employeePortfolio:m||null,financialInfo:u||null,fromPortfolio:i||null,toPortfolio:m||null,sharesToTransfer:Math.floor(a.shares_to_vest)})}catch(r){console.error("Error loading transfer confirmation data:",r),alert("Failed to load transfer confirmation data"),he(!1)}finally{Qe(!1)}},Zs=async()=>{if(v){if(c!=null&&c.financialInfo){if(!c.financialInfo.broker_custodian_name||!c.financialInfo.broker_account_number||!c.financialInfo.tadawul_investor_number||!c.financialInfo.investment_account_number){alert("Cannot transfer shares: The financial information and portfolio details are missing and need to be completed in order to proceed with the share transfer. Please ensure the employee has Investment Account Information (for Share Transfers) configured.");return}if(c.financialInfo.account_status!=="verified"){alert("Cannot transfer shares: Employee financial account must be verified by a finance admin before shares can be transferred. Please verify the account first.");return}}else{alert("Cannot transfer shares: Financial information is missing. Please add financial information before transferring shares.");return}Fe(!0);try{const s=await us(v.id);s.success?(await ue(),await ge(),alert("Transfer request created successfully! The transfer request has been added to the Transfers page for processing."),$e()):alert(`Error: ${s.error}`)}catch(s){console.error("Error transferring vesting event:",s),alert("Failed to transfer vesting event")}finally{Fe(!1)}}},$e=()=>{he(!1),Oe(null),Ke(null),Fe(!1)},Qs=async()=>{if(!g)return;const s=g.grantPerformanceMetrics&&g.grantPerformanceMetrics.length>0?g.grantPerformanceMetrics:g.performanceMetric?[g.performanceMetric]:[];if(!(s.length===0?!0:s.every(t=>t!=null&&t.id?!!Te[t.id]:!0))){alert("Please confirm all performance metrics before vesting this event.");return}Me(!0);try{const t=[f.from("vesting_events").update({performance_condition_met:!0,performance_notes:xe.notes||null,updated_at:new Date().toISOString()}).eq("id",g.id)];if(g.performanceMilestoneId){const r=xe.actualValue.trim(),o=r===""?null:Number(r);t.push(f.from("vesting_milestones").update({is_achieved:!0,achieved_at:new Date().toISOString(),actual_value:o===null||Number.isNaN(o)?null:o}).eq("id",g.performanceMilestoneId))}await Promise.all(t),Le(),await A(g.id,"vest",{skipPerformanceCheck:!0})}catch(t){console.error("Error confirming performance metric:",t),alert("Failed to confirm performance metric. Please try again.")}finally{Me(!1)}},ss=s=>({pending:"bg-yellow-100 text-yellow-800",due:"bg-red-100 text-red-800",vested:"bg-green-100 text-green-800",transferred:"bg-blue-100 text-blue-800",exercised:"bg-purple-100 text-purple-800",forfeited:"bg-gray-100 text-gray-800",cancelled:"bg-gray-100 text-gray-800"})[s]||"bg-gray-100 text-gray-800",ts=s=>({cliff:"bg-orange-100 text-orange-800",time_based:"bg-blue-100 text-blue-800",performance:"bg-green-100 text-green-800",acceleration:"bg-purple-100 text-purple-800"})[s]||"bg-gray-100 text-gray-800";return ws?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:["Vesting Events",e.jsx("span",{className:"inline-flex items-center justify-center w-10 h-10 rounded-full bg-blue-600 text-white text-lg font-semibold",children:k.length})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage and process vesting events for all grants"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>{Je(),ne(!0)},className:"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition",children:[e.jsx(fs,{className:"w-4 h-4"}),e.jsx("span",{children:"Generate Events"})]}),e.jsxs("button",{className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:[e.jsx(lt,{className:"w-4 h-4"}),e.jsx("span",{children:"Export"})]})]})]}),d&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200",children:[e.jsxs("div",{onClick:()=>Xe(!J),className:"px-4 py-3 border-b border-gray-200 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition",title:J?"Expand":"Collapse",role:"button",tabIndex:0,onKeyDown:s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),Xe(!J))},children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-900",children:"Summary"}),e.jsx("div",{className:"text-gray-500",children:J?e.jsx(be,{className:"w-5 h-5"}):e.jsx(ye,{className:"w-5 h-5"})})]}),!J&&e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-7 gap-3 p-4",children:[e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200 cursor-pointer hover:border-blue-300 hover:bg-blue-50 transition",onClick:()=>P("all"),role:"button",title:"Show all events",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Events"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:d.total_events}),e.jsxs("p",{className:"text-xs text-gray-500",children:[R(d.total_total_shares)," shares"]})]}),e.jsx(it,{className:"w-5 h-5 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200 cursor-pointer hover:border-red-300 hover:bg-red-50 transition",onClick:()=>P("due"),role:"button",title:"Filter: Due Now",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Due Now"}),e.jsx("p",{className:"text-xl font-bold text-red-600",children:d.due_events}),e.jsxs("p",{className:"text-xs text-gray-500",children:[R(d.total_due_shares)," shares"]})]}),e.jsx(ae,{className:"w-5 h-5 text-red-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200 cursor-pointer hover:border-yellow-300 hover:bg-yellow-50 transition",onClick:()=>P("pending"),role:"button",title:"Filter: Pending",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-xl font-bold text-yellow-600",children:d.pending_events}),e.jsxs("p",{className:"text-xs text-gray-500",children:[R(d.total_pending_shares)," shares"]})]}),e.jsx(ct,{className:"w-5 h-5 text-yellow-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200 cursor-pointer hover:border-green-300 hover:bg-green-50 transition",onClick:()=>P("transferred"),role:"button",title:"Filter: Transferred",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Transferred"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:d.transferred_events}),e.jsxs("p",{className:"text-xs text-gray-500",children:[R(d.total_transferred_shares)," shares"]})]}),e.jsx(ps,{className:"w-5 h-5 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200 cursor-pointer hover:border-purple-300 hover:bg-purple-50 transition",onClick:()=>P("exercised"),role:"button",title:"Filter: Exercised",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Exercised"}),e.jsx("p",{className:"text-xl font-bold text-purple-600",children:d.exercised_events}),e.jsxs("p",{className:"text-xs text-gray-500",children:[R(d.total_exercised_shares)," shares"]})]}),e.jsx(K,{className:"w-5 h-5 text-purple-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200 cursor-pointer hover:border-blue-300 hover:bg-blue-50 transition",onClick:()=>P("vested"),role:"button",title:"Filter: Vested",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Vested"}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:d.vested_events}),e.jsxs("p",{className:"text-xs text-gray-500",children:[R(d.total_vested_shares)," shares"]})]}),e.jsx(fs,{className:"w-5 h-5 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200 cursor-pointer hover:border-gray-300 hover:bg-gray-50 transition",onClick:()=>P("forfeited"),role:"button",title:"Filter: Forfeited / Cancelled",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Forfeited / Cancelled"}),e.jsx("p",{className:"text-xl font-bold text-gray-600",children:d.forfeited_events+d.cancelled_events}),e.jsxs("p",{className:"text-xs text-gray-500",children:[R(d.total_forfeited_shares+d.total_cancelled_shares)," shares"]})]}),e.jsx(ot,{className:"w-5 h-5 text-gray-600"})]})})]})]}),d&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{onClick:()=>ze(!Q),className:"p-4 border-b border-gray-200 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition",title:Q?"Collapse legend":"Expand legend",role:"button",tabIndex:0,onKeyDown:s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),ze(!Q))},children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(qe,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Events by Status"})]}),e.jsx("div",{className:"text-gray-500",children:Q?e.jsx(ye,{className:"w-5 h-5"}):e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4",children:(()=>{const s=[{label:"Due Now",value:d.due_events,color:"#ef4444"},{label:"Pending",value:d.pending_events,color:"#f59e0b"},{label:"Transferred",value:d.transferred_events,color:"#10b981"},{label:"Exercised",value:d.exercised_events,color:"#8b5cf6"},{label:"Vested",value:d.vested_events,color:"#06b6d4"},{label:"Forfeited/Cancelled",value:d.forfeited_events+d.cancelled_events,color:"#6b7280"}].filter(t=>t.value>0),a=s.reduce((t,r)=>t+r.value,0);return s.length===0||a===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No events available"}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{ref:V,className:"relative w-full h-40 flex items-center justify-center",onClick:t=>{(t.target===t.currentTarget||t.target.tagName==="svg")&&(ke(null),T(null),L(null))},children:[e.jsxs("svg",{viewBox:"0 0 120 120",className:"w-full max-w-40 h-40 cursor-pointer",onMouseLeave:()=>{L(null),C||T(null)},children:[s.map((t,r)=>{const o=s.slice(0,r).reduce((b,p)=>b+p.value/a*360,0),h=t.value/a*360,x=o+h,i=(o-90)*(Math.PI/180),m=(x-90)*(Math.PI/180),u=60+50*Math.cos(i),w=60+50*Math.sin(i),_=60+50*Math.cos(m),Ve=60+50*Math.sin(m),Ge=h>180?1:0,te=t.value/a*100,E=C===t.label,S=Se===t.label,Ae=C?!E:Se!==null&&!S;return e.jsx("path",{d:`M 60 60 L ${u} ${w} A 50 50 0 ${Ge} 1 ${_} ${Ve} Z`,fill:t.color,stroke:"white",strokeWidth:E||S?3:2,className:"cursor-pointer",style:{opacity:E?1:Ae?.3:S?1:.8,filter:E||S?"brightness(1.2)":C?"brightness(0.5)":"none",transition:"none"},onMouseEnter:b=>{if(V.current){const p=V.current.getBoundingClientRect(),N=b.clientX-p.left,q=b.clientY-p.top;C||T(t.label),L({label:t.label,value:t.value,percentage:te,x:N,y:q})}},onMouseLeave:()=>{L(null),C||T(null)},onClick:b=>{if(b.stopPropagation(),V.current){const p=V.current.getBoundingClientRect(),N=b.clientX-p.left,q=b.clientY-p.top;L({label:t.label,value:t.value,percentage:te,x:N,y:q})}ke(p=>{const N=p===t.label?null:t.label;return T(N),N})}},t.label)}),e.jsx("circle",{cx:"60",cy:"60",r:"30",fill:"white"}),(()=>{const t=a.toLocaleString(),r=t.length>12?"9":t.length>9?"10":t.length>6?"11":"12";return e.jsx("text",{x:"60",y:"56",textAnchor:"middle",className:"font-bold",fill:"#111827",fontSize:r,children:t})})(),e.jsx("text",{x:"60",y:"70",textAnchor:"middle",fill:"#6b7280",fontSize:"9",children:"Events"})]}),H&&e.jsxs("div",{className:"absolute z-10 bg-gray-900 text-white text-xs rounded-lg px-3 py-2 shadow-lg pointer-events-none whitespace-nowrap",style:{left:`${H.x}px`,top:`${H.y-30}px`,transform:"translateX(-50%)"},children:[e.jsx("div",{className:"font-semibold",children:H.label}),e.jsxs("div",{className:"text-gray-300",children:[H.value.toLocaleString()," events (",H.percentage.toFixed(1),"%)"]})]})]}),Q&&e.jsx("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:s.map(t=>{const r=t.value/a*100,o=C===t.label,h=Se===t.label;return e.jsxs("div",{className:`flex items-center gap-2 text-xs p-1 rounded cursor-pointer transition-colors ${o||h?"bg-blue-50":"hover:bg-gray-50"}`,onMouseEnter:()=>{if(V.current){const x=V.current.getBoundingClientRect();L({label:t.label,value:t.value,percentage:r,x:x.width/2,y:x.height/2}),C||T(t.label)}},onMouseLeave:()=>{L(null),C||T(null)},onClick:x=>{x.stopPropagation(),ke(i=>{const m=i===t.label?null:t.label;return T(m),m})},children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:t.color}}),e.jsxs("span",{className:"flex-1 truncate",children:[t.label,e.jsxs("span",{className:"ml-2 text-gray-700",children:["(",t.value.toLocaleString(),")"]})]}),e.jsxs("span",{className:"font-medium",children:[r.toFixed(1),"%"]})]},t.label)})})]})})()})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{onClick:()=>He(!z),className:"p-4 border-b border-gray-200 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition",title:z?"Collapse legend":"Expand legend",role:"button",tabIndex:0,onKeyDown:s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),He(!z))},children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(qe,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Shares by Status"})]}),e.jsx("div",{className:"text-gray-500",children:z?e.jsx(ye,{className:"w-5 h-5"}):e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4",children:(()=>{const s=[{label:"Due Now",value:d.total_due_shares,color:"#ef4444"},{label:"Pending",value:d.total_pending_shares,color:"#f59e0b"},{label:"Transferred",value:d.total_transferred_shares,color:"#10b981"},{label:"Exercised",value:d.total_exercised_shares,color:"#8b5cf6"},{label:"Vested",value:d.total_vested_shares,color:"#06b6d4"},{label:"Forfeited/Cancelled",value:d.total_forfeited_shares+d.total_cancelled_shares,color:"#6b7280"}].filter(t=>t.value>0),a=s.reduce((t,r)=>t+r.value,0);return s.length===0||a===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No shares available"}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{ref:G,className:"relative w-full h-40 flex items-center justify-center",onClick:t=>{(t.target===t.currentTarget||t.target.tagName==="svg")&&(Pe(null),I(null),$(null))},children:[e.jsxs("svg",{viewBox:"0 0 120 120",className:"w-full max-w-40 h-40 cursor-pointer",onMouseLeave:()=>{$(null),de&&!z&&I(null)},children:[s.map((t,r)=>{const o=s.slice(0,r).reduce((b,p)=>b+p.value/a*360,0),h=t.value/a*360,x=o+h,i=(o-90)*(Math.PI/180),m=(x-90)*(Math.PI/180),u=60+50*Math.cos(i),w=60+50*Math.sin(i),_=60+50*Math.cos(m),Ve=60+50*Math.sin(m),Ge=h>180?1:0,te=t.value/a*100,E=F===t.label,S=de===t.label,Ae=F?!E:de!==null&&!S;return e.jsx("path",{d:`M 60 60 L ${u} ${w} A 50 50 0 ${Ge} 1 ${_} ${Ve} Z`,fill:t.color,stroke:"white",strokeWidth:E||S?3:2,className:"cursor-pointer",style:{opacity:E?1:Ae?.3:S?1:.8,filter:E||S?"brightness(1.2)":F?"brightness(0.5)":"none",transition:"none"},onMouseEnter:b=>{if(G.current){const p=G.current.getBoundingClientRect(),N=b.clientX-p.left,q=b.clientY-p.top;F||I(t.label),$({label:t.label,value:t.value,percentage:te,x:N,y:q})}},onMouseLeave:()=>{$(null),F||I(null)},onClick:b=>{if(b.stopPropagation(),G.current){const p=G.current.getBoundingClientRect(),N=b.clientX-p.left,q=b.clientY-p.top;$({label:t.label,value:t.value,percentage:te,x:N,y:q})}Pe(p=>{const N=p===t.label?null:t.label;return I(N),N})}},t.label)}),e.jsx("circle",{cx:"60",cy:"60",r:"30",fill:"white"}),(()=>{const t=a.toLocaleString(),r=t.length>12?"9":t.length>9?"10":t.length>6?"11":"12";return e.jsx("text",{x:"60",y:"56",textAnchor:"middle",className:"font-bold",fill:"#111827",fontSize:r,children:t})})(),e.jsx("text",{x:"60",y:"70",textAnchor:"middle",fill:"#6b7280",fontSize:"9",children:"Shares"})]}),X&&e.jsxs("div",{className:"absolute z-10 bg-gray-900 text-white text-xs rounded-lg px-3 py-2 shadow-lg pointer-events-none whitespace-nowrap",style:{left:`${X.x}px`,top:`${X.y-30}px`,transform:"translateX(-50%)"},children:[e.jsx("div",{className:"font-semibold",children:X.label}),e.jsxs("div",{className:"text-gray-300",children:[X.value.toLocaleString()," shares (",X.percentage.toFixed(1),"%)"]})]})]}),z&&e.jsx("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:s.map(t=>{const r=t.value/a*100,o=F===t.label,h=de===t.label;return e.jsxs("div",{className:`flex items-center gap-2 text-xs p-1 rounded cursor-pointer transition-colors ${o||h?"bg-blue-50":"hover:bg-gray-50"}`,onMouseEnter:()=>{if(G.current){const x=G.current.getBoundingClientRect();$({label:t.label,value:t.value,percentage:r,x:x.width/2,y:x.height/2}),F||I(t.label)}},onMouseLeave:()=>{$(null),F||I(null)},onClick:x=>{x.stopPropagation(),Pe(i=>{const m=i===t.label?null:t.label;return I(m),m})},children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:t.color}}),e.jsxs("span",{className:"flex-1 truncate",children:[t.label,e.jsxs("span",{className:"ml-2 text-gray-700",children:["(",t.value.toLocaleString(),")"]})]}),e.jsxs("span",{className:"font-medium",children:[r.toFixed(1),"%"]})]},t.label)})})]})})()})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Due Events"}),(()=>{const s=k.filter(a=>a.status==="due").length;return e.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 rounded-full bg-red-600 text-white text-xs font-semibold",children:s})})()]}),k.filter(s=>s.status==="due").length>2&&e.jsx("button",{onClick:()=>$s(!ee),className:"text-gray-500 hover:text-gray-700 transition p-1 hover:bg-gray-100 rounded",title:ee?"Collapse":"Expand","aria-label":ee?"Collapse":"Expand",children:ee?e.jsx(ye,{className:"w-5 h-5"}):e.jsx(be,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4",children:(()=>{const s=k.filter(a=>a.status==="due");return s.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No due events"}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:(ee?s:s.slice(0,2)).map(a=>{var r;const t=W(a.id,a.sequence_number,a.vesting_date,((r=a.grants)==null?void 0:r.grant_number)??a.grant_id);return e.jsx("button",{onClick:()=>es(a),className:"w-full text-left p-3 border border-gray-200 rounded-lg hover:bg-gray-50 hover:border-blue-300 transition",title:`Open ${t.displayId}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:t.displayId}),e.jsx("div",{className:"text-xs text-gray-500",children:a.employee_name})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:Math.floor(a.shares_to_vest).toLocaleString()}),e.jsx("div",{className:"text-xs text-gray-500",children:O(a.vesting_date)})]})]})},a.id)})})})()})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsx(dt,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[e.jsxs("select",{value:ve,onChange:s=>P(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"due",children:"Due"}),e.jsx("option",{value:"vested",children:"Vested"}),e.jsx("option",{value:"transferred",children:"Transferred"}),e.jsx("option",{value:"exercised",children:"Exercised"})]}),e.jsxs("select",{value:Ne,onChange:s=>Cs(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"cliff",children:"Cliff Events"}),e.jsx("option",{value:"time_based",children:"Time-Based"}),e.jsx("option",{value:"performance",children:"Performance"})]}),e.jsxs("button",{onClick:()=>le(!0),className:`flex items-center space-x-2 px-4 py-2 border rounded-lg transition ${y.length>0?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:y.length>0?`Employees (${y.length})`:"Filter by Employee"})]}),e.jsxs("button",{onClick:()=>ce(!0),className:`flex items-center space-x-2 px-4 py-2 border rounded-lg transition ${j.length>0?"border-green-500 bg-green-50 text-green-700":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:j.length>0?`Grants (${j.length})`:"Filter by Grant ID"})]})]})]}),(y.length>0||j.length>0)&&e.jsxs("div",{className:"mt-4 flex items-center gap-2 flex-wrap",children:[y.length>0&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-blue-100 text-blue-800 rounded-lg text-sm font-medium",children:[e.jsx(je,{className:"w-4 h-4"}),e.jsxs("span",{children:["Employees: ",y.length===1?((as=Ce.find(s=>s.id===y[0]))==null?void 0:as.first_name_en)+" "+((rs=Ce.find(s=>s.id===y[0]))==null?void 0:rs.last_name_en):`${y.length} selected`]}),e.jsx("button",{onClick:Bs,className:"ml-1 hover:bg-blue-200 rounded-full p-0.5 transition",children:e.jsx(D,{className:"w-3.5 h-3.5"})})]}),j.length>0&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 bg-green-100 text-green-800 rounded-lg text-sm font-medium",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsxs("span",{children:["Grants: ",j.length===1?(ns=Be.find(s=>s.id===j[0]))==null?void 0:ns.grant_number:`${j.length} selected`]}),e.jsx("button",{onClick:Hs,className:"ml-1 hover:bg-green-200 rounded-full p-0.5 transition",children:e.jsx(D,{className:"w-3.5 h-3.5"})})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Vesting Events"})}),k.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Event ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Plan"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Event Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Vesting Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Shares"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:k.map(s=>{var a,t,r;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("button",{onClick:()=>es(s),className:"text-sm font-medium text-blue-600 hover:text-blue-800 hover:underline cursor-pointer",children:W(s.id,s.sequence_number,s.vesting_date,((a=s.grants)==null?void 0:a.grant_number)??s.grant_id).displayId}),e.jsx("div",{className:"text-sm text-gray-500 font-mono",children:W(s.id,s.sequence_number,s.vesting_date,((t=s.grants)==null?void 0:t.grant_number)??s.grant_id).dateInfo})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.employee_name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Grant ID: ",((r=s.grants)==null?void 0:r.grant_number)||"N/A"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.plan_name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.plan_code," â€¢ ",s.plan_type]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${ts(s.event_type)}`,children:s.event_type.replace("_"," ").toUpperCase()})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900",children:O(s.vesting_date)}),e.jsx("div",{className:"text-sm text-gray-500",children:gs(s.days_remaining)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:Math.floor(s.shares_to_vest).toLocaleString()}),s.exercise_price&&e.jsxs("div",{className:"text-sm text-gray-500",children:["$",s.exercise_price.toFixed(2),"/share"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${ss(s.status)}`,children:s.status.toUpperCase()})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex gap-2",children:[s.status==="due"&&e.jsx("button",{onClick:()=>A(s.id,"vest"),disabled:we===s.id,className:"text-green-600 hover:text-green-900 disabled:opacity-50",children:"Vest"}),s.status==="vested"&&s.requires_exercise&&e.jsx("button",{onClick:()=>A(s.id,"exercise"),disabled:we===s.id,className:"text-purple-600 hover:text-purple-900 disabled:opacity-50",children:"Exercise"}),s.status==="vested"&&!s.requires_exercise&&e.jsx("button",{onClick:()=>A(s.id,"transfer"),disabled:we===s.id,className:"text-blue-600 hover:text-blue-900 disabled:opacity-50",children:"Transfer"})]})})]},s.id)})})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(K,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No vesting events found"}),e.jsx("p",{className:"text-gray-500",children:"No vesting events match the current filters."})]})]}),Vs&&g&&(()=>{const s=g.grantPerformanceMetrics&&g.grantPerformanceMetrics.length>0?g.grantPerformanceMetrics:g.performanceMetric?[g.performanceMetric]:[],a=s.length===0?!0:s.every(t=>{const r=t==null?void 0:t.id;return r?!!Te[r]:!0});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Confirm Performance Metric"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Review the performance criteria before vesting this event."})]}),e.jsx("button",{onClick:()=>{Y||Le()},className:"text-gray-400 hover:text-gray-600 transition",disabled:Y,"aria-label":"Close performance confirmation",children:e.jsx(D,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"px-6 py-5 space-y-4",children:s.map(t=>{var x,i;const r=(t==null?void 0:t.id)||"",o=((x=g.performanceMetric)==null?void 0:x.id)===r,h=r?!!Te[r]:!0;return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xt,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:(t==null?void 0:t.name)||"Performance Metric"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[((i=g.grants)==null?void 0:i.grant_number)||g.grant_id,o?" â€¢ Milestone Metric":""]})]})]}),(t==null?void 0:t.description)&&e.jsx("p",{className:"text-sm text-gray-600",children:t.description}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"p-3 rounded-lg border border-gray-200 bg-white",children:[e.jsx("span",{className:"text-gray-500 block text-xs uppercase tracking-wide",children:"Target Value"}),e.jsxs("span",{className:"text-gray-900 font-semibold",children:[(t==null?void 0:t.target_value)!==void 0&&(t==null?void 0:t.target_value)!==null?t.target_value.toLocaleString():"â€”",t!=null&&t.unit_of_measure?` ${t.unit_of_measure}`:""]})]}),e.jsxs("div",{className:"p-3 rounded-lg border border-gray-200 bg-white",children:[e.jsx("span",{className:"text-gray-500 block text-xs uppercase tracking-wide",children:"Current Status"}),e.jsx("span",{className:"text-gray-900 font-semibold",children:t!=null&&t.is_achieved?"Achieved":"Pending"})]}),e.jsxs("div",{className:"p-3 rounded-lg border border-gray-200 bg-white",children:[e.jsx("span",{className:"text-gray-500 block text-xs uppercase tracking-wide",children:"Event Type"}),e.jsx("span",{className:"text-gray-900 font-semibold capitalize",children:g.event_type.replace("_"," ")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Actual Value (optional)"}),e.jsx("input",{type:"number",value:xe.actualValue,onChange:m=>me(u=>({...u,actualValue:m.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"Enter actual value achieved",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Notes (optional)"}),e.jsx("textarea",{value:xe.notes,onChange:m=>me(u=>({...u,notes:m.target.value})),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"Add supporting details or links"})]})]})]}),r&&e.jsxs("label",{className:"flex items-start gap-3 p-3 rounded-lg border border-gray-200 cursor-pointer bg-white hover:bg-gray-50 transition",children:[e.jsx("input",{type:"checkbox",className:"mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500",checked:h,onChange:m=>Ie(u=>({...u,[r]:m.target.checked})),disabled:Y}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold text-gray-900 block",children:"Confirm metric achieved"}),"Confirm that the required metric has been met and vesting can proceed."]})]})]},r||`metric-${Math.random()}`)})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 bg-gray-50",children:[e.jsx("button",{onClick:Le,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-100 transition",disabled:Y,children:"Cancel"}),e.jsx("button",{onClick:Qs,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",disabled:!a||Y,children:Y?"Processing...":"Confirm & Vest"})]})]})})})(),Gs&&v&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-3xl w-full shadow-lg overflow-hidden max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Confirm Share Transfer"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Review employee portfolio and financial information before confirming the transfer."})]}),e.jsx("button",{onClick:()=>{se||$e()},className:"text-gray-400 hover:text-gray-600 transition",disabled:se,"aria-label":"Close transfer confirmation",children:e.jsx(D,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-5",children:Ze?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading transfer details..."})]})}):c?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(mt,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"text-sm font-semibold text-blue-900",children:"Transfer Summary"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 block mb-1",children:"From Portfolio:"}),e.jsx("span",{className:"font-medium text-blue-900",children:((ls=c.fromPortfolio)==null?void 0:ls.portfolio_number)||"Company Reserved"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 block mb-1",children:"To Portfolio:"}),e.jsx("span",{className:"font-medium text-blue-900",children:((is=c.toPortfolio)==null?void 0:is.portfolio_number)||"Employee Vested Portfolio"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 block mb-1",children:"Employee:"}),e.jsx("span",{className:"font-medium text-blue-900",children:v.employee_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 block mb-1",children:"Shares to Transfer:"}),e.jsx("span",{className:"font-medium text-blue-900 text-lg",children:c.sharesToTransfer.toLocaleString()})]})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(qe,{className:"w-5 h-5 text-gray-600"}),"Employee Portfolio Details"]}),c.employeePortfolio?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Portfolio Number"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:c.employeePortfolio.portfolio_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Total Shares"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:Number(c.employeePortfolio.total_shares||0).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Available Shares"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:Number(c.employeePortfolio.available_shares||0).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"After Transfer"}),e.jsx("span",{className:"text-sm font-medium text-green-600",children:(Number(c.employeePortfolio.total_shares||0)+c.sharesToTransfer).toLocaleString()})]})]}):e.jsxs("div",{className:"text-sm text-amber-600 bg-amber-50 border border-amber-200 rounded p-3",children:[e.jsx(ae,{className:"w-4 h-4 inline mr-2"}),"Employee portfolio will be created automatically during transfer."]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ht,{className:"w-5 h-5 text-gray-600"}),"Employee Financial Information"]}),c.financialInfo?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Account Status"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${c.financialInfo.account_status==="verified"?"bg-green-100 text-green-800":c.financialInfo.account_status==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:((cs=c.financialInfo.account_status)==null?void 0:cs.toUpperCase())||"NOT SET"})]}),c.financialInfo.investment_account_number&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Investment Account Number"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 font-mono",children:c.financialInfo.investment_account_number})]}),c.financialInfo.broker_custodian_name&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Broker/Custodian"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:c.financialInfo.broker_custodian_name})]}),c.financialInfo.broker_account_number&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Broker Account Number"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 font-mono",children:c.financialInfo.broker_account_number})]}),c.financialInfo.tadawul_investor_number&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:"Tadawul Investor Number"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 font-mono",children:c.financialInfo.tadawul_investor_number})]})]}),c.financialInfo.account_status!=="verified"&&e.jsxs("div",{className:"mt-3 text-sm text-amber-600 bg-amber-50 border border-amber-200 rounded p-3",children:[e.jsx(ae,{className:"w-4 h-4 inline mr-2"}),"Financial account is not verified. Please verify the account before transferring shares."]})]}):e.jsxs("div",{className:"text-sm text-amber-600 bg-amber-50 border border-amber-200 rounded p-3",children:[e.jsx(ae,{className:"w-4 h-4 inline mr-2"}),"No financial information found for this employee. Please add financial information before transferring shares."]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Vesting Event Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block mb-1",children:"Event ID:"}),e.jsx("span",{className:"font-medium text-gray-900 font-mono text-xs",children:W(v.id,v.sequence_number,v.vesting_date,((os=v.grants)==null?void 0:os.grant_number)??v.grant_id).displayId})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block mb-1",children:"Grant Number:"}),e.jsx("span",{className:"font-medium text-gray-900",children:((ds=v.grants)==null?void 0:ds.grant_number)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block mb-1",children:"Plan:"}),e.jsx("span",{className:"font-medium text-gray-900",children:v.plan_name||v.plan_code||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 block mb-1",children:"Vesting Date:"}),e.jsx("span",{className:"font-medium text-gray-900",children:O(v.vesting_date)})]})]})]})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ae,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{children:"Failed to load transfer details. Please try again."})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 bg-gray-50",children:[e.jsx("button",{onClick:$e,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-100 transition",disabled:se,children:"Cancel"}),e.jsx("button",{onClick:Zs,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",disabled:!c||Ze||se||c.financialInfo&&c.financialInfo.account_status!=="verified",children:se?"Processing...":"Confirm & Transfer"})]})]})}),Ss&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Generate Vesting Events"}),e.jsx("button",{onClick:()=>ne(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(D,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"This will generate vesting events for all existing grants that don't already have vesting events."}),U.length>0?e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 mb-3",children:["Grants without vesting events (",U.length,"):"]}),e.jsx("div",{className:"max-h-60 overflow-y-auto border border-gray-200 rounded-lg",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 w-12",children:e.jsx("button",{onClick:Ws,className:"flex items-center justify-center w-full text-gray-600 hover:text-gray-900 transition","aria-label":De?"Deselect all grants":"Select all grants",children:De?e.jsx(bs,{className:"w-4 h-4"}):e.jsx(ys,{className:"w-4 h-4"})})}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Employee"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Grant ID"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Plan"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Shares"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Start Date"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:U.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[e.jsx("td",{className:"px-3 py-2 text-gray-900 font-medium",children:e.jsx("button",{onClick:()=>Ys(s.id),className:"flex items-center justify-center w-full text-gray-600 hover:text-gray-900 transition","aria-label":M.includes(s.id)?"Deselect grant":"Select grant",children:M.includes(s.id)?e.jsx(bs,{className:"w-4 h-4 text-blue-600"}):e.jsx(ys,{className:"w-4 h-4"})})}),e.jsx("td",{className:"px-3 py-2 text-gray-900",children:s.employee_name}),e.jsx("td",{className:"px-3 py-2 text-gray-600 font-mono text-xs",children:s.grant_number?s.grant_number:"N/A"}),e.jsx("td",{className:"px-3 py-2 text-gray-600",children:s.plan_code}),e.jsx("td",{className:"px-3 py-2 text-gray-900",children:s.total_shares.toLocaleString()}),e.jsx("td",{className:"px-3 py-2 text-gray-600",children:O(s.vesting_start_date)})]},s.id))})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ps,{className:"w-12 h-12 text-green-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"All grants already have vesting events!"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>ne(!1),className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),U.length>0&&e.jsx("button",{onClick:Os,disabled:Re||M.length===0,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition disabled:opacity-50",children:Re?"Generating...":`Generate Events for ${M.length||0} Grant${M.length===1?"":"s"}`})]})]})}),Ps&&n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Vesting Event Details"}),e.jsx("p",{className:"text-gray-600",children:W(n.id,n.sequence_number,n.vesting_date,((xs=n.grants)==null?void 0:xs.grant_number)??n.grant_id).displayId})]}),e.jsx("button",{onClick:()=>B(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(D,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-3",children:"Event Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Event ID:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:W(n.id,n.sequence_number,n.vesting_date,((ms=n.grants)==null?void 0:ms.grant_number)??n.grant_id).displayId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Event Type:"}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${ts(n.event_type)}`,children:n.event_type.replace("_"," ").toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sequence:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["#",n.sequence_number]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Status:"}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${ss(n.status)}`,children:n.status.toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Vesting Date:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:O(n.vesting_date)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Days Remaining:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:gs(n.days_remaining)})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-3",children:"Employee"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Name:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:n.employee_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Employee ID:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 font-mono",children:n.employee_id})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-3",children:"Shares & Financial"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Shares to Vest:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:Math.floor(n.shares_to_vest).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Cumulative Shares:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:Math.floor(n.cumulative_shares_vested).toLocaleString()})]}),n.exercise_price&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Exercise Price:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["$",n.exercise_price.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Exercise Cost:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["$",(n.shares_to_vest*n.exercise_price).toFixed(2)]})]})]}),n.fair_market_value&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Fair Market Value:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["$",n.fair_market_value.toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-3",children:"Plan Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Plan Name:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:n.plan_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Plan Code:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:n.plan_code})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Plan Type:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:n.plan_type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Requires Exercise:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:n.requires_exercise?"Yes":"No"})]})]})]})]})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-3",children:"Technical Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Grant ID:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 font-mono",children:((hs=n.grants)==null?void 0:hs.grant_number)??n.grant_id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Event UUID:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 font-mono",children:n.id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Company ID:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 font-mono",children:n.company_id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Created:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:O(n.created_at)})]})]})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>B(!1),className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Close"}),n.status==="due"&&e.jsxs("button",{onClick:async()=>{const s=n.grants;if(!(s!=null&&s.employee_acceptance_at)){alert("Cannot process vesting: The employee contract has not been signed yet. The employee needs to sign the contract in order to proceed with vesting the shares and transferring them to the employee portfolio.");return}A(n.id,"vest"),B(!1)},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition",children:["Process Vesting (",Math.floor(n.shares_to_vest).toLocaleString()," shares)"]}),n.status==="vested"&&n.requires_exercise&&e.jsx("button",{onClick:()=>{A(n.id,"exercise"),B(!1)},className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:"Exercise Options"}),n.status==="vested"&&!n.requires_exercise&&e.jsx("button",{onClick:async()=>{try{const{data:s,error:a}=await f.from("employee_financial_info").select("*").eq("employee_id",n.employee_id).maybeSingle();if(a){console.error("Error checking financial info:",a),alert("Error checking financial information. Please try again.");return}if(!s||!s.broker_custodian_name||!s.broker_account_number||!s.tadawul_investor_number||!s.investment_account_number){alert("Cannot transfer shares: The financial information and portfolio details are missing and need to be completed in order to proceed with the share transfer. Please ensure the employee has Investment Account Information (for Share Transfers) configured.");return}if(s.account_status!=="verified"){alert("Cannot transfer shares: Employee financial account must be verified by a finance admin before shares can be transferred. Please verify the account first.");return}A(n.id,"transfer"),B(!1)}catch(s){console.error("Error validating financial info:",s),alert("Error validating financial information. Please try again.")}},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Transfer Shares"})]})]})}),Ms&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full max-h-[80vh] flex flex-col",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Filter by Employee"}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Select one or more employees to filter vesting events"})]}),e.jsx("button",{onClick:()=>le(!1),className:"text-gray-400 hover:text-gray-600 transition",children:e.jsx(D,{className:"w-6 h-6"})})]})}),e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(js,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search employees...",value:ie,onChange:s=>Ts(s.target.value),className:"w-full pl-9 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"space-y-2",children:fe.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(je,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"No employees found"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[fe.length," employee",fe.length!==1?"s":""," available"]}),y.length>0&&e.jsx("button",{onClick:()=>_e([]),className:"text-sm text-red-600 hover:text-red-800 transition",children:"Clear all"})]}),fe.map(s=>{const a=y.includes(s.id);return e.jsxs("label",{className:`flex items-center p-3 rounded-lg border cursor-pointer transition ${a?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-50"}`,children:[e.jsx("input",{type:"checkbox",checked:a,onChange:()=>zs(s.id),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("div",{className:"ml-3 flex-1",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(je,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[s.first_name_en," ",s.last_name_en]}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center space-x-2",children:[e.jsx("span",{children:s.employee_number}),s.department&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:s.department})]})]})]})]})})]},s.id)})]})})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 bg-gray-50 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[y.length," employee",y.length!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>le(!1),className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition text-sm",children:"Cancel"}),e.jsx("button",{onClick:()=>le(!1),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm font-medium",children:"Apply Filter"})]})]})]})}),Fs&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full max-h-[80vh] flex flex-col",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Filter by Grant ID"}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Select one or more grants to filter vesting events"})]}),e.jsx("button",{onClick:()=>ce(!1),className:"text-gray-400 hover:text-gray-600 transition",children:e.jsx(D,{className:"w-6 h-6"})})]})}),e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(js,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search grants...",value:oe,onChange:s=>Ds(s.target.value),className:"w-full pl-9 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"space-y-2",children:pe.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(K,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"No grants found"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[pe.length," grant",pe.length!==1?"s":""," available"]}),j.length>0&&e.jsx("button",{onClick:()=>Ee([]),className:"text-sm text-red-600 hover:text-red-800 transition",children:"Clear all"})]}),pe.map(s=>{var t,r,o;const a=j.includes(s.id);return e.jsxs("label",{className:`flex items-center p-3 rounded-lg border cursor-pointer transition ${a?"border-green-500 bg-green-50":"border-gray-200 hover:bg-gray-50"}`,children:[e.jsx("input",{type:"checkbox",checked:a,onChange:()=>Xs(s.id),className:"w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"}),e.jsx("div",{className:"ml-3 flex-1",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(K,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900 flex items-center space-x-2",children:[e.jsx("span",{children:s.grant_number}),e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 bg-blue-100 text-blue-800 text-xs font-medium rounded-full",children:s.vesting_event_count||0})]}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center space-x-2",children:[e.jsxs("span",{children:[(t=s.employees)==null?void 0:t.first_name_en," ",(r=s.employees)==null?void 0:r.last_name_en]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:(o=s.incentive_plans)==null?void 0:o.plan_code}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[s.total_shares.toLocaleString()," shares"]})]})]})]})})]},s.id)})]})})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 bg-gray-50 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[j.length," grant",j.length!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>ce(!1),className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition text-sm",children:"Cancel"}),e.jsx("button",{onClick:()=>ce(!1),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition text-sm font-medium",children:"Apply Filter"})]})]})]})})]})}export{Nt as default};
