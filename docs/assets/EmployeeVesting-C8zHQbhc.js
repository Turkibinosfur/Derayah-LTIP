import{a as b,s as u,j as e}from"./index-CHcuUdej.js";import{r as m}from"./react-vendor-xiFAdxLt.js";import{c as _}from"./vestingUtils-Y6bbk_Ca.js";import{I as V}from"./InteractiveVestingTimeline-BGQYyTWM.js";import{o as w,p as S}from"./ui-vendor-a8g5-7pO.js";import"./supabase-vendor-B-LuImWU.js";import"./numberUtils-CWVJ76A6.js";import"./dateUtils-DoPl8O0G.js";function F(){const{t:n}=b(),[o,x]=m.useState([]),[p,h]=m.useState(!0),[g,y]=m.useState(new Set);m.useEffect(()=>{v()},[]);const v=async()=>{try{const{data:{user:s}}=await u.auth.getUser();if(!s)return;const{data:t}=await u.from("employees").select("id").eq("user_id",s.id).maybeSingle();if(!t)return;const{data:i,error:a}=await u.from("grants").select(`
          *,
          incentive_plans (
            plan_name_en,
            vesting_schedule_template_id,
            vesting_config
          ),
          vesting_events (
            *
          ),
          generated_documents (
            id,
            status,
            document_type,
            document_name,
            generated_at
          )
        `).eq("employee_id",t.id).in("status",["active","pending_signature"]).order("grant_date",{ascending:!0});if(a)throw a;if(!i||i.length===0){x([]);return}const r=i.map(d=>d.id),l=await _(r),c=i.map(d=>{const f=(d.vesting_events||[]).sort((j,N)=>(j.sequence_number||0)-(N.sequence_number||0));return{...d,individualVestingRecords:f,vestingDetails:l[d.id]||null}});x(c)}catch(s){console.error("Error loading vesting data:",s)}finally{h(!1)}};return p?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):!o||o.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-600",children:n("employeeVesting.noVestingData")})}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[n("employeeVesting.title"),e.jsx("span",{className:"inline-flex items-center justify-center w-10 h-10 rounded-full bg-blue-600 text-white text-lg font-semibold",children:o.length})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:n("employeeVesting.description")})]}),o.map(s=>e.jsxs("div",{className:"bg-white rounded-lg border-2 border-gray-300 shadow-sm p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:s.grant_number}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 flex-wrap gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:Number(s.total_shares).toLocaleString()})," ",n("employeeVesting.shares")]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${s.status==="active"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:s.status==="active"?n("employeeVesting.active"):n("employeeVesting.pendingSignature")}),s.incentive_plans&&e.jsxs("span",{className:"text-sm text-gray-600",children:[n("employeeVesting.plan"),": ",e.jsx("span",{className:"font-medium",children:s.incentive_plans.plan_name_en})]}),(()=>{if(s.employee_acceptance_at)return e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:n("employeeVesting.contractSigned")});const t=Array.isArray(s.generated_documents)?s.generated_documents:[],i=t.find(a=>a.document_type==="grant_agreement")||t[0];if(i){const a=i.status||"draft",r={signed:"bg-green-100 text-green-800",executed:"bg-green-100 text-green-800",pending_signature:"bg-yellow-100 text-yellow-800",draft:"bg-gray-100 text-gray-600"},l={signed:n("employeeVesting.contractSigned"),executed:n("employeeVesting.contractExecuted"),pending_signature:n("employeeVesting.pendingSignature"),draft:n("employeeVesting.draftContract")};return e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${r[a]||"bg-gray-100 text-gray-600"}`,children:l[a]||n("employeeVesting.contract")})}return null})()]}),s.vestingDetails&&e.jsxs("div",{className:"mt-3 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-gray-600",children:[n("employeeVesting.cliffPeriod"),":"]}),e.jsxs("span",{className:"ml-1 font-medium",children:[s.vestingDetails.cliffMonths," ",n("employeeVesting.months")]})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-gray-600",children:[n("employeeVesting.frequency"),":"]}),e.jsx("span",{className:"ml-1 font-medium capitalize",children:s.vestingDetails.vestingFrequency})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-gray-600",children:[n("employeeVesting.type"),":"]}),e.jsx("span",{className:"ml-1 font-medium capitalize",children:s.vestingDetails.vestingType.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-gray-600",children:[n("employeeVesting.duration"),":"]}),e.jsxs("span",{className:"ml-1 font-medium",children:[s.vestingDetails.vestingYears," ",n("employeeVesting.years")]})]})]})]}),s.individualVestingRecords&&s.individualVestingRecords.length>0?e.jsxs("div",{className:"mt-4",children:[e.jsxs("button",{onClick:()=>{const t=new Set(g);t.has(s.id)?t.delete(s.id):t.add(s.id),y(t)},className:"flex items-center justify-between w-full text-left p-4 border border-gray-200 hover:border-gray-300 hover:bg-gray-50 rounded-lg transition-all duration-200 cursor-pointer",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:n("employeeVesting.vestingSchedule")}),g.has(s.id)?e.jsx(w,{className:"w-5 h-5 text-gray-500"}):e.jsx(S,{className:"w-5 h-5 text-gray-500"})]}),g.has(s.id)&&e.jsx("div",{className:"space-y-2",children:s.individualVestingRecords.map((t,i)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:(()=>{const a=new Date(t.vesting_date),r=String(a.getDate()).padStart(2,"0"),l=String(a.getMonth()+1).padStart(2,"0"),c=a.getFullYear();return`${r}/${l}/${c}`})()}),e.jsxs("p",{className:"text-sm text-gray-600",children:[n("employeeVesting.vestingEvent")," #",t.sequence_number]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-gray-900",children:[Number(t.shares_to_vest).toLocaleString()," ",n("employeeVesting.shares")]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[(t.shares_to_vest/s.total_shares*100).toFixed(1),"%"]})]}),e.jsx("div",{className:"ml-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.status==="vested"?"bg-green-100 text-green-800":t.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:t.status})})]},t.id||i))})]}):e.jsx("div",{className:"mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-yellow-800 text-sm",children:n("employeeVesting.noIndividualRecords")})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:n("employeeVesting.vestingProgress")}),e.jsx("span",{className:"text-sm text-gray-600",children:(()=>{const t=Number(s.vested_shares||0),i=(s.individualVestingRecords||[]).reduce((r,l)=>l.status==="due"?r+Number(l.shares_to_vest||0):r,0);return`${(t+i).toLocaleString()} / ${Number(s.total_shares).toLocaleString()} ${n("employeeVesting.shares")}`})()})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:(()=>{const t=Number(s.total_shares||0),i=Number(s.vested_shares||0),a=(s.individualVestingRecords||[]).reduce((c,d)=>d.status==="due"?c+Number(d.shares_to_vest||0):c,0),r=i+a,l=t>0?r/t*100:0;return e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 h-full transition-all duration-300",style:{width:`${l}%`}})})()}),e.jsx("div",{className:"mt-1 text-xs text-gray-500 text-right",children:(()=>{const t=Number(s.total_shares||0),i=Number(s.vested_shares||0),a=(s.individualVestingRecords||[]).reduce((c,d)=>d.status==="due"?c+Number(d.shares_to_vest||0):c,0),r=i+a;return`${(t>0?r/t*100:0).toFixed(1)}% ${n("employeeVesting.vested")}`})()})]}),(!s.individualVestingRecords||s.individualVestingRecords.length===0)&&s.vestingDetails&&e.jsx("div",{className:"mt-4",children:e.jsx(V,{grantDate:s.grant_date,totalShares:s.total_shares,vestedShares:s.vested_shares,vestingSchedule:s.vestingDetails})})]},s.id))]})}export{F as default};
