import{a as He,b as Oe,s as P,j as e}from"./index-CHcuUdej.js";import{u as Ye,r as m,a as Ve}from"./react-vendor-xiFAdxLt.js";import{f as pe}from"./dateUtils-DoPl8O0G.js";import{x as fe,F as _e,c as Fe,U as be,P as ye,o as ve,p as je,C as ze,E as Xe,J as Ge,N as We}from"./ui-vendor-a8g5-7pO.js";import"./supabase-vendor-B-LuImWU.js";function st(){const{t:c,i18n:Ne}=He(),p=Ne.language==="ar",we=Ye(),{brandColor:_,getBgColor:Ke}=Oe(),[w,Pe]=m.useState([]),[A,Se]=m.useState([]),[te,Ce]=m.useState([]),[ke,Le]=m.useState(!0),[Te,Q]=m.useState(!1),[V,se]=m.useState(null),[oe,ie]=m.useState(null),[ae,ce]=m.useState(null),[de,le]=m.useState(null),[F,Me]=m.useState({total:0,allocated:0}),[I,$e]=m.useState({total:0,allocated:0,available:0}),[Z,B]=m.useState(""),[z,ue]=m.useState(!1),[H,O]=m.useState(null),[ne,D]=m.useState(null),[R,re]=m.useState(null),U=m.useRef(null),[X,xe]=m.useState(!1),[Y,q]=m.useState(null),[G,E]=m.useState(null),[C,J]=m.useState(null),T=m.useRef(null),[s,i]=m.useState({plan_name_en:"",plan_name_ar:"",plan_type:"LTIP_RSU",plan_code:"",description_en:"",description_ar:"",vesting_schedule_type:"time_based",vesting_schedule_template_id:"",ltip_pool_id:"",total_shares_allocated:0,start_date:"",end_date:"",status:"active",vesting_years:4,cliff_months:12,vesting_frequency:"monthly"});m.useEffect(()=>{ee()},[]),m.useEffect(()=>{if(s.vesting_schedule_template_id&&A.length>0){const t=A.find(l=>l.id===s.vesting_schedule_template_id);if(t){const l={vesting_years:Math.floor(t.total_duration_months/12),cliff_months:t.cliff_months,vesting_frequency:t.vesting_frequency};if(s.start_date){const n=new Date(s.start_date),a=new Date(n);a.setMonth(a.getMonth()+t.total_duration_months),l.end_date=a.toISOString().split("T")[0]}i(n=>({...n,...l}))}}},[s.vesting_schedule_template_id,s.start_date,A]),m.useEffect(()=>{if(s.start_date&&s.vesting_schedule_template_id&&A.length>0){const t=A.find(l=>l.id===s.vesting_schedule_template_id);if(t){const l=new Date(s.start_date),n=new Date(l);n.setMonth(n.getMonth()+t.total_duration_months),i(a=>({...a,end_date:n.toISOString().split("T")[0]}))}}},[s.start_date,s.vesting_schedule_template_id,A]);const ee=async()=>{try{const{data:{user:t}}=await P.auth.getUser();if(!t)return;const{data:l}=await P.from("company_users").select("company_id").eq("user_id",t.id).single();if(l){const[n,a,d,f,y]=await Promise.all([P.from("incentive_plans").select("*").eq("company_id",l.company_id).order("created_at",{ascending:!1}),P.from("shareholders").select("shares_owned").eq("company_id",l.company_id).eq("shareholder_type","employee").eq("is_active",!0),P.from("incentive_plans").select("total_shares_allocated").eq("company_id",l.company_id).eq("status","active"),P.from("vesting_schedules").select("*").eq("company_id",l.company_id).eq("is_template",!0).order("created_at",{ascending:!1}),P.from("ltip_pools").select("*").eq("company_id",l.company_id).eq("status","active").order("created_at",{ascending:!1})]);if(n.error)throw n.error;if(f.data&&Se(f.data),y.data){Ce(y.data);const x=y.data.reduce((h,k)=>({total:h.total+Number(k.total_shares_allocated||0),allocated:h.allocated+Number(k.shares_used||0),available:h.available+Number(k.shares_available||0)}),{total:0,allocated:0,available:0});$e(x)}const M=await Promise.all((n.data||[]).map(async x=>{const{data:h}=await P.from("grants").select("id, total_shares, status, grant_number, employee_id").eq("plan_id",x.id),k=(h==null?void 0:h.reduce((r,u)=>r+Number(u.total_shares||0),0))||0;let o=0;const v=(h||[]).map(r=>r.id).filter(Boolean);if(v.length>0){const{data:r}=await P.from("vesting_events").select("grant_id, shares_to_vest, status").in("grant_id",v),u=["vested","transferred","exercised"];o=(r==null?void 0:r.reduce((b,g)=>u.includes(g.status)?b+Number(g.shares_to_vest||0):b,0))||0}x.plan_name_en==="Derayah Employee Stock Plan 2025"&&(console.log("=== DEBUGGING DERAYAH EMPLOYEE STOCK PLAN 2025 ==="),console.log("Plan ID:",x.id),console.log("Plan Name:",x.plan_name_en),console.log("Plan Total Allocated:",x.total_shares_allocated),console.log("Grants Data:",h),console.log("Number of grants found:",(h==null?void 0:h.length)||0),console.log("Actual Granted (calculated):",k),console.log("Plan Shares Granted (stored):",x.shares_granted),console.log("Plan Shares Available (stored):",x.shares_available),h&&h.length>0?h.forEach((r,u)=>{console.log(`Grant ${u+1}:`,{grant_number:r.grant_number,total_shares:r.total_shares,status:r.status,employee_id:r.employee_id})}):(console.log("No grants found for this plan!"),console.log("This could mean:"),console.log("1. No grants exist for this plan"),console.log("2. Grants exist but have different plan_id"),console.log("3. Database connection issue")));const L=x.total_shares_allocated-k;return{...x,actual_shares_granted:k,actual_shares_available:Math.max(0,L),actual_shares_vested:o}}));Pe(M);const j=(a.data||[]).reduce((x,h)=>x+Number(h.shares_owned),0),N=(d.data||[]).reduce((x,h)=>x+Number(h.total_shares_allocated),0);Me({total:j,allocated:N})}}catch(t){console.error("Error loading plans:",t)}finally{Le(!1)}},W=()=>{ie(null),ce(null)},he=(t,l,n)=>{if(l){const a=te.find(f=>f.id===l);if(!a)return B("Selected LTIP Pool not found"),!1;let d=a.shares_available;if(n){const f=w.find(y=>y.id===n);f&&f.ltip_pool_id===l&&(d+=f.total_shares_allocated)}if(t>d)return B(`Cannot allocate ${t.toLocaleString()} shares. Only ${d.toLocaleString()} shares available in LTIP pool "${a.pool_name_en}" (Pool Total: ${a.total_shares_allocated.toLocaleString()}, Used: ${a.shares_used.toLocaleString()})`),!1}else{F.total-F.allocated;let a=F.allocated;if(n){const f=w.find(y=>y.id===n);f&&(a-=f.total_shares_allocated)}const d=F.total-a;if(t>d)return B(`Cannot allocate ${t.toLocaleString()} shares. Only ${d.toLocaleString()} shares available from Employee shares in Cap Table (Total: ${F.total.toLocaleString()}, Already Allocated: ${a.toLocaleString()})`),!1}return B(""),!0},Ie=async()=>{if(!s.plan_name_en.trim()){alert("Plan name (English) is required");return}if(!s.plan_code.trim()){alert("Plan code is required");return}if(!s.start_date){alert("Start date is required");return}if(!s.ltip_pool_id){alert("LTIP pool is required. Please select an LTIP pool for this plan.");return}if(s.total_shares_allocated<=0){alert("Total shares allocated must be greater than 0");return}if(he(s.total_shares_allocated,s.ltip_pool_id))try{const{data:{user:t}}=await P.auth.getUser();if(!t)return;const{data:l}=await P.from("company_users").select("company_id, id").eq("user_id",t.id).single();if(!l)return;const n={years:s.vesting_years,cliff_months:s.cliff_months,frequency:s.vesting_frequency},a={company_id:l.company_id,plan_name_en:s.plan_name_en,plan_name_ar:s.plan_name_ar||s.plan_name_en,plan_type:s.plan_type,plan_code:s.plan_code,description_en:s.description_en,description_ar:s.description_ar,vesting_schedule_type:s.vesting_schedule_type,vesting_config:n,total_shares_allocated:s.total_shares_allocated,shares_available:s.total_shares_allocated,status:s.status,start_date:s.start_date,end_date:s.end_date||null,created_by:l.id};s.vesting_schedule_template_id&&(a.vesting_schedule_template_id=s.vesting_schedule_template_id),a.ltip_pool_id=s.ltip_pool_id;const{error:d}=await P.from("incentive_plans").insert(a);if(d)throw console.error("Plan creation error:",d),d;Q(!1),B(""),i({plan_name_en:"",plan_name_ar:"",plan_type:"LTIP_RSU",plan_code:"",description_en:"",description_ar:"",vesting_schedule_type:"time_based",vesting_schedule_template_id:"",ltip_pool_id:"",total_shares_allocated:0,start_date:"",end_date:"",status:"draft",vesting_years:4,cliff_months:12,vesting_frequency:"monthly"}),ee()}catch(t){console.error("Error creating plan:",t),t&&typeof t=="object"&&"message"in t?alert(`Failed to create plan: ${t.message}`):alert("Failed to create plan. Please check the console for details.")}},Ee=async t=>{try{const{error:l}=await P.from("incentive_plans").delete().eq("id",t);if(l)throw l;le(null),ee()}catch(l){console.error("Error deleting plan:",l),alert("Failed to delete plan")}},Ae=t=>{var l,n,a,d;se(t),i({plan_name_en:t.plan_name_en,plan_name_ar:"",plan_type:t.plan_type,plan_code:t.plan_code,description_en:"",description_ar:"",vesting_schedule_type:((l=t.vesting_config)==null?void 0:l.type)||"time_based",vesting_schedule_template_id:t.vesting_schedule_template_id||"",ltip_pool_id:t.ltip_pool_id||"",vesting_years:((n=t.vesting_config)==null?void 0:n.vesting_years)||4,cliff_months:((a=t.vesting_config)==null?void 0:a.cliff_months)||12,vesting_frequency:((d=t.vesting_config)==null?void 0:d.frequency)||"monthly",total_shares_allocated:t.total_shares_allocated,start_date:t.start_date,end_date:t.end_date||"",status:t.status}),W()},Re=async()=>{if(V){if(!s.ltip_pool_id){alert("LTIP pool is required. Please select an LTIP pool for this plan.");return}if(he(s.total_shares_allocated,s.ltip_pool_id,V.id))try{const t={type:s.vesting_schedule_type,vesting_years:s.vesting_years,cliff_months:s.cliff_months,frequency:s.vesting_frequency},l={plan_name_en:s.plan_name_en,plan_type:s.plan_type,plan_code:s.plan_code,vesting_config:t,total_shares_allocated:s.total_shares_allocated,start_date:s.start_date,end_date:s.end_date||null,status:s.status};s.vesting_schedule_template_id&&(l.vesting_schedule_template_id=s.vesting_schedule_template_id),s.ltip_pool_id&&(l.ltip_pool_id=s.ltip_pool_id);const{error:n}=await P.from("incentive_plans").update(l).eq("id",V.id);if(n)throw console.error("Plan update error:",n),n;se(null),B(""),i({plan_name_en:"",plan_name_ar:"",plan_type:"LTIP_RSU",plan_code:"",description_en:"",description_ar:"",vesting_schedule_type:"time_based",vesting_schedule_template_id:"",ltip_pool_id:"",total_shares_allocated:0,start_date:"",end_date:"",status:"draft",vesting_years:4,cliff_months:12,vesting_frequency:"monthly"}),ee()}catch(t){console.error("Error updating plan:",t),alert("Failed to update plan")}}},ge=t=>{W(),we(`/dashboard/grants?plan_id=${t.id}&plan_name=${encodeURIComponent(t.plan_name_en)}`)},qe={LTIP_RSU:"bg-blue-100 text-blue-800",LTIP_RSA:"bg-purple-100 text-purple-800",LTIP_ESOP:"bg-green-100 text-green-800"},De={draft:"bg-gray-100 text-gray-800",active:"bg-green-100 text-green-800",closed:"bg-red-100 text-red-800",suspended:"bg-yellow-100 text-yellow-800"},me=w.reduce((t,l)=>t+Number(l.total_shares_allocated||0),0),Ue=w.reduce((t,l)=>t+Number((l.actual_shares_granted??l.shares_granted)||0),0),Be=w.reduce((t,l)=>t+Number((l.actual_shares_available??l.shares_available??l.total_shares_allocated-(l.actual_shares_granted??0))||0),0);return ke?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:`space-y-6 ${p?"text-right":"text-left"}`,dir:p?"rtl":"ltr",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:p?"text-right":"",children:[e.jsxs("h1",{className:`text-3xl font-bold text-gray-900 flex items-center gap-3 ${p?"flex-row-reverse justify-end":""}`,children:[c("plans.title"),e.jsx("span",{className:"inline-flex items-center justify-center w-10 h-10 rounded-full text-white text-lg font-semibold",style:{backgroundColor:_},children:w.length})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:c("plans.description")})]}),e.jsxs("button",{onClick:()=>Q(!0),className:`flex items-center space-x-2 px-4 py-2 text-white rounded-lg transition ${p?"space-x-reverse":""}`,style:{backgroundColor:_},onMouseEnter:t=>{const l=parseInt(_.slice(1,3),16)*.9,n=parseInt(_.slice(3,5),16)*.9,a=parseInt(_.slice(5,7),16)*.9;t.currentTarget.style.backgroundColor=`rgb(${Math.round(l)}, ${Math.round(n)}, ${Math.round(a)})`},onMouseLeave:t=>{t.currentTarget.style.backgroundColor=_},children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:c("plans.createNewPlan")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(_e,{className:"w-6 h-6",style:{color:_}})}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(Fe,{className:"w-6 h-6 text-green-600"})})]}),e.jsxs("div",{className:p?"text-left":"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500",children:c("plans.totalPlans")}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:w.length})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:c("plans.active")}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[w.filter(t=>t.status==="active").length," / ",w.length]})]}),(()=>{const t=w.filter(a=>a.status==="active").length,l=w.length||1,n=Math.round(t/l*100);return e.jsxs("div",{children:[e.jsx("div",{className:"w-full h-2 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-2 bg-green-500 rounded-full",style:{width:`${n}%`,transition:"width 200ms linear"}})}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:[n,"% ",c("plans.activePercent")]})]})})()]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-slate-100 rounded-lg",children:e.jsx(be,{className:"w-6 h-6 text-slate-600"})}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:I.total.toLocaleString()})]}),e.jsx("p",{className:"text-gray-600 font-medium mb-2",children:c("plans.ltipPool")}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[c("plans.totalAllocated"),":"]}),e.jsx("span",{className:"text-sm font-bold text-gray-900",children:I.total.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[c("plans.plannedShares"),":"]}),e.jsx("span",{className:"text-sm font-bold text-gray-900",children:me.toLocaleString()})]}),e.jsxs("div",{className:p?"pr-4":"pl-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-[11px] text-gray-500",children:[c("plans.granted"),":"]}),e.jsx("span",{className:"text-xs font-medium text-gray-900",children:Ue.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-[11px] text-gray-500",children:[c("plans.ungranted"),":"]}),e.jsx("span",{className:"text-xs font-medium text-gray-900",children:Be.toLocaleString()})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[c("plans.availableToPlan"),":"]}),e.jsx("span",{className:"text-sm font-bold text-green-600",children:I.available.toLocaleString()})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx("div",{children:e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{onClick:()=>xe(!X),className:"flex items-center justify-between mb-4 cursor-pointer hover:bg-gray-50 transition p-2 -m-2 rounded",title:X?"Collapse legend":"Expand legend",role:"button",tabIndex:0,onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),xe(!X))},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-3 bg-cyan-100 rounded-lg",children:e.jsx(ye,{className:"w-6 h-6 text-cyan-600"})}),e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"LTIP Pool vs Planned"})]}),e.jsx("div",{className:"text-gray-500",children:X?e.jsx(ve,{className:"w-5 h-5"}):e.jsx(je,{className:"w-5 h-5"})})]}),(()=>{const t=I.total||0,l=me||0,n=Math.max(0,t-l),a=t||1;if(t===0)return e.jsx("div",{className:"flex items-center justify-center h-40 text-gray-400 text-sm",children:"No LTIP pool data"});const d=l/a*100,f=n/a*100,y=l/a*360,M=n/a*360,j=-90,N=j+y,x=N,h=x+M,k=(o,v,L)=>{const r=o*(Math.PI/180),u=v*(Math.PI/180),b=60+50*Math.cos(r),g=60+50*Math.sin(r),S=60+50*Math.cos(u),$=60+50*Math.sin(u),K=L>180?1:0;return`M 60 60 L ${b} ${g} A 50 50 0 ${K} 1 ${S} ${$} Z`};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{ref:T,className:"relative w-full h-40 flex items-center justify-center",onClick:o=>{(o.target===o.currentTarget||o.target.tagName==="svg")&&(J(null),E(null),q(null))},children:[e.jsxs("svg",{viewBox:"0 0 120 120",className:"w-full max-w-40 h-40 cursor-pointer",onMouseLeave:()=>{q(null),C||E(null)},children:[l>0&&(()=>{const o=C==="Planned Shares",v=G==="Planned Shares",L=C?!o:G!==null&&!v;return e.jsx("path",{d:k(j,N,y),fill:"#3b82f6",stroke:"white",strokeWidth:o||v?3:2,className:"cursor-pointer",style:{opacity:o?1:L?.3:v?1:.85,filter:o||v?"brightness(1.2)":C?"brightness(0.5)":"none",transition:"none"},onMouseEnter:r=>{if(T.current){const u=T.current.getBoundingClientRect(),b=r.clientX-u.left,g=r.clientY-u.top;q({label:"Planned Shares",value:l,percentage:d,x:b,y:g}),C||E("Planned Shares")}},onClick:r=>{if(r.stopPropagation(),T.current){const u=T.current.getBoundingClientRect(),b=r.clientX-u.left,g=r.clientY-u.top;q({label:"Planned Shares",value:l,percentage:d,x:b,y:g})}J(u=>{const b=u==="Planned Shares"?null:"Planned Shares";return E(b),b})}})})(),n>0&&(()=>{const o=C==="Unplanned Shares",v=G==="Unplanned Shares",L=C?!o:G!==null&&!v;return e.jsx("path",{d:k(x,h,M),fill:"#94a3b8",stroke:"white",strokeWidth:o||v?3:2,className:"cursor-pointer",style:{opacity:o?1:L?.3:v?1:.85,filter:o||v?"brightness(1.2)":C?"brightness(0.5)":"none",transition:"none"},onMouseEnter:r=>{if(T.current){const u=T.current.getBoundingClientRect(),b=r.clientX-u.left,g=r.clientY-u.top;q({label:"Unplanned Shares",value:n,percentage:f,x:b,y:g}),C||E("Unplanned Shares")}},onClick:r=>{if(r.stopPropagation(),T.current){const u=T.current.getBoundingClientRect(),b=r.clientX-u.left,g=r.clientY-u.top;q({label:"Unplanned Shares",value:n,percentage:f,x:b,y:g})}J(u=>{const b=u==="Unplanned Shares"?null:"Unplanned Shares";return E(b),b})}})})(),e.jsx("circle",{cx:"60",cy:"60",r:"30",fill:"white"}),(()=>{const o=t.toLocaleString(),v=o.length>12?"9":o.length>9?"10":o.length>6?"11":"12";return e.jsx("text",{x:"60",y:"56",textAnchor:"middle",className:"font-bold",fill:"#111827",fontSize:v,children:o})})(),e.jsx("text",{x:"60",y:"70",textAnchor:"middle",fill:"#6b7280",fontSize:"9",children:"Total Pool"})]}),Y&&e.jsxs("div",{className:"absolute z-10 bg-gray-900 text-white text-xs rounded-lg px-3 py-2 shadow-lg pointer-events-none whitespace-nowrap",style:{left:`${Y.x+10}px`,top:`${Y.y-10}px`,transform:"translate(-50%, -100%)"},children:[e.jsx("div",{className:"font-semibold",children:Y.label}),e.jsxs("div",{className:"text-gray-300",children:[Y.percentage.toFixed(2),"%"]}),e.jsxs("div",{className:"text-gray-400 text-[10px] mt-1",children:[Y.value.toLocaleString()," shares"]})]})]}),X&&e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto border-t pt-2",children:["Planned Shares","Unplanned Shares"].map(o=>{const v=C===o,L=G===o,r=o==="Planned Shares"?l:n,u=o==="Planned Shares"?d:f,b=o==="Planned Shares"?"bg-blue-500":"bg-slate-400";return r<=0?null:e.jsxs("div",{className:`flex items-center gap-2 text-xs p-1 rounded cursor-pointer transition-colors ${v||L?"bg-blue-50":"hover:bg-gray-50"}`,onMouseEnter:()=>{if(T.current){const g=T.current.getBoundingClientRect();q({label:o,value:r,percentage:u,x:g.width/2,y:g.height/2}),C||E(o)}},onMouseLeave:()=>{q(null),C||E(null)},onClick:g=>{g.stopPropagation(),J(S=>{const $=S===o?null:o;return E($),$})},children:[e.jsx("div",{className:`w-3 h-3 rounded-full flex-shrink-0 ${b}`}),e.jsx("span",{className:"text-gray-600 flex-1",children:o}),e.jsxs("span",{className:"text-gray-900 font-medium",children:[r.toLocaleString()," (",u.toFixed(1),"%)"]})]},o)})})]})})()]})})}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx("div",{children:e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{onClick:()=>ue(!z),className:"flex items-center justify-between mb-4 cursor-pointer hover:bg-gray-50 transition p-2 -m-2 rounded",title:z?"Collapse legend":"Expand legend",role:"button",tabIndex:0,onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),ue(!z))},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(ye,{className:"w-6 h-6 text-purple-600"})}),e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Planned Shares by Plan"})]}),e.jsx("div",{className:"text-gray-500",children:z?e.jsx(ve,{className:"w-5 h-5"}):e.jsx(je,{className:"w-5 h-5"})})]}),(()=>{const t=w.filter(a=>a.total_shares_allocated>0),l=t.reduce((a,d)=>a+d.total_shares_allocated,0),n=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4","#84cc16"];return t.length===0?e.jsx("div",{className:"flex items-center justify-center h-40 text-gray-400 text-sm",children:"No shares allocated"}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{ref:U,className:"relative w-full h-40 flex items-center justify-center",onClick:a=>{(a.target===a.currentTarget||a.target.tagName==="svg")&&(re(null),D(null),O(null))},children:[e.jsxs("svg",{viewBox:"0 0 120 120",className:"w-full max-w-40 h-40 cursor-pointer",onMouseLeave:()=>{O(null),R||D(null)},children:[t.map((a,d)=>{const f=t.slice(0,d).reduce((g,S)=>g+S.total_shares_allocated/l*360,0),y=a.total_shares_allocated/l*360,M=f+y,j=(f-90)*(Math.PI/180),N=(M-90)*(Math.PI/180),x=60+50*Math.cos(j),h=60+50*Math.sin(j),k=60+50*Math.cos(N),o=60+50*Math.sin(N),v=y>180?1:0,L=a.total_shares_allocated/l*100,r=R===a.id,u=ne===a.id,b=R?!r:ne!==null&&!u;return e.jsx("path",{d:`M 60 60 L ${x} ${h} A 50 50 0 ${v} 1 ${k} ${o} Z`,fill:n[d%n.length],stroke:"white",strokeWidth:r||u?"3":"2",className:"cursor-pointer",style:{opacity:r?1:b?.3:u?1:.8,filter:r||u?"brightness(1.2)":R?"brightness(0.5)":"none",transition:"none"},onMouseEnter:g=>{if(U.current){const S=U.current.getBoundingClientRect(),$=g.clientX-S.left,K=g.clientY-S.top;R||D(a.id),O({plan:a,percentage:L,x:$,y:K})}},onClick:g=>{if(g.stopPropagation(),U.current){const S=U.current.getBoundingClientRect(),$=g.clientX-S.left,K=g.clientY-S.top;O({plan:a,percentage:L,x:$,y:K})}re(S=>{const $=S===a.id?null:a.id;return D($),$})}},a.id)}),e.jsx("circle",{cx:"60",cy:"60",r:"30",fill:"white"}),(()=>{const a=l.toLocaleString(),d=a.length>12?"9":a.length>9?"10":a.length>6?"11":"12";return e.jsx("text",{x:"60",y:"56",textAnchor:"middle",className:"font-bold",fill:"#111827",fontSize:d,children:a})})(),e.jsx("text",{x:"60",y:"70",textAnchor:"middle",fill:"#6b7280",fontSize:"9",children:"Shares"})]}),H&&e.jsxs("div",{className:"absolute z-10 bg-gray-900 text-white text-xs rounded-lg px-3 py-2 shadow-lg pointer-events-none whitespace-nowrap",style:{left:`${H.x+10}px`,top:`${H.y-10}px`,transform:"translate(-50%, -100%)"},children:[e.jsx("div",{className:"font-semibold",children:H.plan.plan_name_en}),e.jsxs("div",{className:"text-gray-300",children:[H.percentage.toFixed(2),"%"]}),e.jsxs("div",{className:"text-gray-400 text-[10px] mt-1",children:[H.plan.total_shares_allocated.toLocaleString()," shares"]})]})]}),z&&e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto border-t pt-2",children:t.sort((a,d)=>d.total_shares_allocated-a.total_shares_allocated).map((a,d)=>{const f=a.total_shares_allocated/l*100,y=R===a.id,M=ne===a.id;return e.jsxs("div",{className:`flex items-center gap-2 text-xs p-1 rounded cursor-pointer transition-colors ${y||M?"bg-blue-50":"hover:bg-gray-50"}`,onMouseEnter:()=>{if(U.current){const j=U.current.getBoundingClientRect();O({plan:a,percentage:f,x:j.width/2,y:j.height/2}),R||D(a.id)}},onMouseLeave:()=>{O(null),R||D(null)},onClick:j=>{j.stopPropagation(),re(N=>{const x=N===a.id?null:a.id;return D(x),x})},children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:n[d%n.length]}}),e.jsx("span",{className:"text-gray-600 truncate flex-1",title:a.plan_name_en,children:a.plan_name_en}),e.jsxs("span",{className:"text-gray-900 font-medium",children:[a.total_shares_allocated.toLocaleString()," (",f.toFixed(1),"%)"]})]},a.id)})})]})})()]})})})]}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200",children:w.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(_e,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"No Plans Created Yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Create your first incentive plan to start allocating shares to employees"}),e.jsxs("button",{onClick:()=>Q(!0),className:"inline-flex items-center space-x-2 px-6 py-3 text-white rounded-lg transition",style:{backgroundColor:_},onMouseEnter:t=>{const l=parseInt(_.slice(1,3),16)*.9,n=parseInt(_.slice(3,5),16)*.9,a=parseInt(_.slice(5,7),16)*.9;t.currentTarget.style.backgroundColor=`rgb(${Math.round(l)}, ${Math.round(n)}, ${Math.round(a)})`},onMouseLeave:t=>{t.currentTarget.style.backgroundColor=_},children:[e.jsx(fe,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Create First Plan"})]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:`px-6 py-3 ${p?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:c("plans.planName")}),e.jsx("th",{className:`px-6 py-3 ${p?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:c("plans.planType")}),e.jsx("th",{className:`px-6 py-3 ${p?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:c("plans.planCode")}),e.jsx("th",{className:`px-6 py-3 ${p?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:c("plans.totalShares")}),e.jsx("th",{className:`px-6 py-3 ${p?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:c("plans.granted")}),e.jsx("th",{className:`px-6 py-3 ${p?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:c("employees.vested")}),e.jsx("th",{className:`px-6 py-3 ${p?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:c("plans.ungranted")}),e.jsx("th",{className:`px-6 py-3 ${p?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:c("plans.vestingScheduleType")}),e.jsx("th",{className:`px-6 py-3 ${p?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:"Period"}),e.jsx("th",{className:`px-6 py-3 ${p?"text-right":"text-left"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:c("plans.status")}),e.jsx("th",{className:`px-6 py-3 ${p?"text-left":"text-right"} text-xs font-medium text-gray-500 uppercase tracking-wider`,children:c("plans.actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:w.map(t=>{var l,n,a,d;return e.jsxs("tr",{className:"hover:bg-gray-50 transition relative",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("button",{onClick:()=>ge(t),className:"text-left",children:[e.jsx("div",{className:"text-sm font-medium text-blue-600 hover:text-blue-800 hover:underline transition",children:t.plan_name_en}),e.jsx("div",{className:"text-xs text-gray-500",children:t.plan_name_ar})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium ${qe[t.plan_type]}`,children:t.plan_type})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:t.plan_code})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-bold text-gray-900",children:t.total_shares_allocated.toLocaleString()})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-bold text-blue-600",children:((l=t.actual_shares_granted)==null?void 0:l.toLocaleString())||t.shares_granted.toLocaleString()})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-bold text-green-600",children:((n=t.actual_shares_vested)==null?void 0:n.toLocaleString())||0})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-bold text-gray-900",children:((a=t.actual_shares_available)==null?void 0:a.toLocaleString())||t.shares_available.toLocaleString()})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900 capitalize",children:(d=t.vesting_config)!=null&&d.type?t.vesting_config.type.replace("_"," "):"Time Based"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-900",children:[e.jsx(ze,{className:"w-3.5 h-3.5 mr-1"}),e.jsx("span",{children:pe(t.start_date)})]}),t.end_date&&e.jsxs("div",{className:"text-xs text-gray-500",children:["to ",pe(t.end_date)]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium ${De[t.status]}`,children:t.status})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap relative",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{onClick:f=>{if(f.stopPropagation(),oe===t.id){W();return}const y=f.currentTarget.getBoundingClientRect(),M=144,j=176;let N=y.bottom+8,x=y.right-j;N+M>window.innerHeight&&(N=y.top-M-8),x<16&&(x=Math.max(16,y.left));const h=window.innerWidth-j-16;x>h&&(x=Math.max(16,h)),N<16&&(N=16),ce({top:N,left:x}),ie(t.id)},className:"p-1.5 text-gray-500 hover:bg-gray-100 rounded transition",title:"Actions",children:e.jsx(Xe,{className:"w-4 h-4"})})}),oe===t.id&&ae&&Ve.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:W}),e.jsxs("div",{className:"fixed z-50 w-44 bg-white border border-gray-200 rounded-xl shadow-2xl overflow-hidden",style:{top:`${ae.top}px`,left:`${ae.left}px`},children:[e.jsxs("button",{onClick:()=>{ge(t)},className:"w-full flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[e.jsx(be,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{children:"View grants"})]}),e.jsxs("button",{onClick:()=>{Ae(t)},className:"w-full flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[e.jsx(Ge,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:"Edit plan"})]}),e.jsxs("button",{onClick:()=>{le(t.id),W()},className:"w-full flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50",children:[e.jsx(We,{className:"w-4 h-4"}),e.jsx("span",{children:"Delete plan"})]})]})]}),document.body)]})]},t.id)})})]})})}),Te&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Create New Incentive Plan"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Define plan parameters and vesting schedule"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"LTIP Pool Details"}),e.jsxs("p",{className:"text-xs text-blue-700 mt-1",children:["Total: ",I.total.toLocaleString()," | Already Allocated: ",I.allocated.toLocaleString()," | Available: ",I.available.toLocaleString()]})]})})}),Z&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm font-medium text-red-800",children:Z})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[c("plans.planNameEnglish"),"*"]}),e.jsx("input",{type:"text",value:s.plan_name_en,onChange:t=>i({...s,plan_name_en:t.target.value}),className:`w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${p?"text-right":"text-left"}`,placeholder:"e.g., Executive LTIP 2025"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[c("plans.planNameArabic"),"*"]}),e.jsx("input",{type:"text",value:s.plan_name_ar,onChange:t=>i({...s,plan_name_ar:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-right",dir:"rtl",placeholder:"خطة الحوافز التنفيذية 2025"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[c("plans.planCode"),"*"]}),e.jsx("input",{type:"text",value:s.plan_code,onChange:t=>i({...s,plan_code:t.target.value}),className:`w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${p?"text-right":"text-left"}`,placeholder:"LTIP-2025-001"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[c("plans.planType"),"*"]}),e.jsxs("select",{value:s.plan_type,onChange:t=>i({...s,plan_type:t.target.value}),className:`w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${p?"text-right":"text-left"}`,children:[e.jsx("option",{value:"LTIP_RSU",children:"LTIP - Restricted Stock Units"}),e.jsx("option",{value:"LTIP_RSA",children:"LTIP - Restricted Stock Awards"}),e.jsx("option",{value:"LTIP_ESOP",children:"Employee Stock Option Plan"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[c("plans.vestingScheduleType"),"*"]}),e.jsxs("select",{value:s.vesting_schedule_type,onChange:t=>i({...s,vesting_schedule_type:t.target.value}),className:`w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${p?"text-right":"text-left"}`,children:[e.jsx("option",{value:"time_based",children:"Time-Based Vesting"}),e.jsx("option",{value:"performance_based",children:"Performance-Based Vesting"}),e.jsx("option",{value:"hybrid",children:"Hybrid (Time + Performance)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c("plans.vestingScheduleTemplate")}),e.jsxs("select",{value:s.vesting_schedule_template_id,onChange:t=>i({...s,vesting_schedule_template_id:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select a template (optional)"}),A.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.cliff_months,"mo cliff, ",t.vesting_frequency,")"]},t.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select a template to automatically configure vesting rules for all grants under this plan"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"LTIP Pool*"}),e.jsxs("select",{value:s.ltip_pool_id,onChange:t=>i({...s,ltip_pool_id:t.target.value}),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select LTIP Pool"}),te.map(t=>e.jsxs("option",{value:t.id,children:[t.pool_name_en," (",t.shares_available.toLocaleString()," available)"]},t.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select an LTIP pool to allocate shares from."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Total Shares Allocated*"}),e.jsx("input",{type:"number",value:s.total_shares_allocated,onChange:t=>i({...s,total_shares_allocated:parseInt(t.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"10000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:s.status,onChange:t=>i({...s,status:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"suspended",children:"Suspended"}),e.jsx("option",{value:"closed",children:"Closed"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[c("plans.startDate"),"*"]}),e.jsx("input",{type:"date",value:s.start_date,onChange:t=>i({...s,start_date:t.target.value}),className:`w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${p?"text-right":"text-left"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c("plans.endDate")}),e.jsx("input",{type:"date",value:s.end_date,onChange:t=>i({...s,end_date:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:!!s.vesting_schedule_template_id}),s.vesting_schedule_template_id&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Auto-generated from selected template duration"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vesting Period (Years)*"}),e.jsx("input",{type:"number",value:s.vesting_years,onChange:t=>i({...s,vesting_years:parseInt(t.target.value)||4}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"4",disabled:!!s.vesting_schedule_template_id}),s.vesting_schedule_template_id&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Auto-generated from selected template"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cliff Period (Months)"}),e.jsx("input",{type:"number",value:s.cliff_months,onChange:t=>i({...s,cliff_months:parseInt(t.target.value)||12}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"12",disabled:!!s.vesting_schedule_template_id}),s.vesting_schedule_template_id&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Auto-generated from selected template"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vesting Frequency"}),e.jsx("input",{type:"text",value:s.vesting_frequency==="monthly"?"Monthly":s.vesting_frequency==="quarterly"?"Quarterly":s.vesting_frequency==="annually"?"Annually":"Monthly",onChange:t=>i({...s,vesting_frequency:t.target.value.toLowerCase()}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:!!s.vesting_schedule_template_id,placeholder:"Monthly"}),s.vesting_schedule_template_id&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Auto-generated from selected template"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c("plans.descriptionEnglish")}),e.jsx("textarea",{value:s.description_en,onChange:t=>i({...s,description_en:t.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Describe the plan objectives and eligibility criteria..."})]})]}),e.jsxs("div",{className:`flex-shrink-0 p-6 border-t border-gray-200 bg-white flex items-center ${p?"justify-start flex-row-reverse":"justify-end"} space-x-3 ${p?"space-x-reverse":""}`,children:[e.jsx("button",{onClick:()=>Q(!1),className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition",children:c("common.cancel")}),e.jsx("button",{onClick:Ie,className:"px-6 py-2 text-white rounded-lg transition",style:{backgroundColor:_},onMouseEnter:t=>{const l=parseInt(_.slice(1,3),16)*.9,n=parseInt(_.slice(3,5),16)*.9,a=parseInt(_.slice(5,7),16)*.9;t.currentTarget.style.backgroundColor=`rgb(${Math.round(l)}, ${Math.round(n)}, ${Math.round(a)})`},onMouseLeave:t=>{t.currentTarget.style.backgroundColor=_},children:c("plans.createPlan")})]})]})}),de&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Delete Plan"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to delete this plan? This action cannot be undone and all associated grants will be affected."}),e.jsxs("div",{className:"flex items-center justify-end space-x-3",children:[e.jsx("button",{onClick:()=>le(null),className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition",children:"Cancel"}),e.jsx("button",{onClick:()=>Ee(de),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",children:"Delete Plan"})]})]})}),V&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Edit Plan"}),e.jsx("p",{className:"text-gray-600 mt-1",children:V.plan_name_en})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:"LTIP Pool Details"}),e.jsxs("p",{className:"text-xs text-blue-700 mt-1",children:["Total: ",I.total.toLocaleString()," | Already Allocated: ",I.allocated.toLocaleString()," | Available: ",I.available.toLocaleString()]})]})}),Z&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm font-medium text-red-800",children:Z})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Plan Name (English)"}),e.jsx("input",{type:"text",value:s.plan_name_en,onChange:t=>i({...s,plan_name_en:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., 2024 Executive LTIP"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Plan Type"}),e.jsxs("select",{value:s.plan_type,onChange:t=>i({...s,plan_type:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"LTIP_RSU",children:"LTIP - RSU (Restricted Stock Units)"}),e.jsx("option",{value:"LTIP_RSA",children:"LTIP - RSA (Restricted Stock Awards)"}),e.jsx("option",{value:"LTIP_ESOP",children:"ESOP (Employee Stock Ownership Plan)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Plan Code"}),e.jsx("input",{type:"text",value:s.plan_code,onChange:t=>i({...s,plan_code:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., LTIP-2024-001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vesting Schedule Type"}),e.jsxs("select",{value:s.vesting_schedule_type,onChange:t=>i({...s,vesting_schedule_type:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"time_based",children:"Time-Based Vesting"}),e.jsx("option",{value:"performance_based",children:"Performance-Based Vesting"}),e.jsx("option",{value:"hybrid",children:"Hybrid (Time + Performance)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vesting Schedule Template"}),e.jsxs("select",{value:s.vesting_schedule_template_id,onChange:t=>i({...s,vesting_schedule_template_id:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select a template (optional)"}),A.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.cliff_months,"mo cliff, ",t.vesting_frequency,")"]},t.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select a template to automatically configure vesting rules for all grants under this plan"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"LTIP Pool*"}),e.jsxs("select",{value:s.ltip_pool_id,onChange:t=>i({...s,ltip_pool_id:t.target.value}),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[!s.ltip_pool_id&&e.jsx("option",{value:"",children:"Select LTIP Pool"}),te.map(t=>e.jsxs("option",{value:t.id,children:[t.pool_name_en," (",t.shares_available.toLocaleString()," available)"]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Total Shares Allocated"}),e.jsx("input",{type:"number",value:s.total_shares_allocated,onChange:t=>i({...s,total_shares_allocated:Number(t.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"100000"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:s.start_date,onChange:t=>i({...s,start_date:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date (Optional)"}),e.jsx("input",{type:"date",value:s.end_date,onChange:t=>i({...s,end_date:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:!!s.vesting_schedule_template_id}),s.vesting_schedule_template_id&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Auto-generated from selected template duration"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vesting Period (Years)"}),e.jsx("input",{type:"number",value:s.vesting_years,onChange:t=>i({...s,vesting_years:parseInt(t.target.value)||4}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"4",disabled:!!s.vesting_schedule_template_id}),s.vesting_schedule_template_id&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Auto-generated from selected template"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cliff Period (Months)"}),e.jsx("input",{type:"number",value:s.cliff_months,onChange:t=>i({...s,cliff_months:parseInt(t.target.value)||12}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"12",disabled:!!s.vesting_schedule_template_id}),s.vesting_schedule_template_id&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Auto-generated from selected template"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vesting Frequency"}),e.jsx("input",{type:"text",value:s.vesting_frequency==="monthly"?"Monthly":s.vesting_frequency==="quarterly"?"Quarterly":s.vesting_frequency==="annually"?"Annually":"Monthly",onChange:t=>i({...s,vesting_frequency:t.target.value.toLowerCase()}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:!!s.vesting_schedule_template_id,placeholder:"Monthly"}),s.vesting_schedule_template_id&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Auto-generated from selected template"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:s.status,onChange:t=>i({...s,status:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"suspended",children:"Suspended"}),e.jsx("option",{value:"closed",children:"Closed"})]})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-200 flex items-center justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{se(null),i({plan_name_en:"",plan_name_ar:"",plan_type:"LTIP_RSU",plan_code:"",description_en:"",description_ar:"",vesting_schedule_type:"time_based",total_shares_allocated:0,start_date:"",end_date:"",status:"draft",vesting_years:4,cliff_months:12,vesting_frequency:"monthly"})},className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{onClick:Re,className:"px-6 py-2 text-white rounded-lg transition",style:{backgroundColor:_},onMouseEnter:t=>{const l=parseInt(_.slice(1,3),16)*.9,n=parseInt(_.slice(3,5),16)*.9,a=parseInt(_.slice(5,7),16)*.9;t.currentTarget.style.backgroundColor=`rgb(${Math.round(l)}, ${Math.round(n)}, ${Math.round(a)})`},onMouseLeave:t=>{t.currentTarget.style.backgroundColor=_},children:"Update Plan"})]})]})})]})}export{st as default};
