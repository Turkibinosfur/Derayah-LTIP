import{a as Le,j as e,s as f,u as Ts}from"./index-DDk1oefv.js";import{r as l}from"./react-vendor-xiFAdxLt.js";import{u as bs,g as ks,a as $s}from"./vestingEventsService-q0CQjbrA.js";import{f as Ee,a as Ue,b as Fe}from"./dateUtils-DoPl8O0G.js";import{m as Ms,c as ye,D as es,U as Pe,P as ts,n as Ie,o as Ge,F as He,C as Vs,p as Be,a as ss,b as Oe,q as pe,r as hs,s as As,t as Rs,u as qs,I as he,X as Ds}from"./ui-vendor-B0ZOy8uN.js";import{V as Us}from"./VestingEventsCalendar-DSWlnWnV.js";import"./supabase-vendor-B-LuImWU.js";const us=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4","#84cc16"];function Fs(){const{t:s,i18n:q}=Le();q.language;const[g,w]=l.useState(!0),[d,T]=l.useState([]),[r,H]=l.useState({}),[O,S]=l.useState({}),[u,U]=l.useState({}),[b,p]=l.useState(!0),[B,P]=l.useState(!0),[n,c]=l.useState(!0),[D,I]=l.useState(null),[o,G]=l.useState(null),[x,ne]=l.useState(null),Y=l.useRef(null),[ae,Q]=l.useState(null),[re,z]=l.useState(null),[L,F]=l.useState(null),M=l.useRef(null),[N,K]=l.useState(null),[X,R]=l.useState(null),[ee,xe]=l.useState(null),oe=l.useRef(null);l.useEffect(()=>{(async()=>{try{const{data:{user:i}}=await f.auth.getUser();if(!i)return;const{data:C}=await f.from("company_users").select("company_id").eq("user_id",i.id).maybeSingle();if(!C)return;const W=C.company_id,[{data:se},{data:ie}]=await Promise.all([f.from("ltip_pools").select("id, pool_name_en, total_shares_allocated, shares_used, shares_available").eq("company_id",W).order("created_at",{ascending:!1}),f.from("grants").select("id, total_shares, incentive_plans(id, ltip_pool_id)").eq("company_id",W)]);T(se||[]);const le={},de={};if((ie||[]).forEach(Z=>{var me;const J=(me=Z==null?void 0:Z.incentive_plans)==null?void 0:me.ltip_pool_id;if(!J)return;const ce=Number(Z.total_shares||0);le[J]=(le[J]||0)+ce,de[Z.id]=J}),H(le),Object.keys(de).length){const{data:Z}=await f.from("vesting_events").select("grant_id, shares_to_vest, status").in("grant_id",Object.keys(de)),J={},ce={},me=["vested","transferred","exercised","due"];(Z||[]).forEach(je=>{const ue=de[je.grant_id];if(!ue)return;const Ce=Math.floor(Number(je.shares_to_vest||0));me.includes(je.status)?J[ue]=(J[ue]||0)+Ce:ce[ue]=(ce[ue]||0)+Ce}),S(J),U(ce)}else S({}),U({})}finally{w(!1)}})()},[]);const a=l.useMemo(()=>d.reduce((v,i)=>v+i.total_shares_allocated,0),[d]),m=l.useMemo(()=>d.reduce((v,i)=>v+i.shares_used,0),[d]),k=l.useMemo(()=>d.reduce((v,i)=>v+i.shares_available,0),[d]),$=l.useMemo(()=>Object.values(r).reduce((v,i)=>v+i,0),[r]),y=l.useMemo(()=>Object.values(O).reduce((v,i)=>v+i,0),[O]),j=l.useMemo(()=>Object.values(u).reduce((v,i)=>v+i,0),[u]),_=l.useMemo(()=>d.reduce((i,C)=>i+C.total_shares_allocated,0)?d.filter(i=>i.total_shares_allocated>0).map((i,C)=>({label:i.pool_name_en,value:i.total_shares_allocated,color:us[C%us.length]})):[],[d]),V=l.useMemo(()=>{const v=[];return m>0&&v.push({label:s("dashboard.usedLabel"),value:m,color:"#10b981"}),k>0&&v.push({label:s("dashboard.available"),value:k,color:"#f59e0b"}),v},[m,k,s]),A=l.useMemo(()=>{const v=Math.max(m-$,0),i=Math.max($-(y+j),0),C=[];return y>0&&C.push({label:s("dashboard.vested"),value:y,color:"#22c55e"}),j>0&&C.push({label:s("dashboard.unvested"),value:j,color:"#ec4899"}),i>0&&C.push({label:s("dashboard.grantedNoVestingEvents"),value:i,color:"#f97316"}),v>0&&C.push({label:s("dashboard.allocatedNotGranted"),value:v,color:"#6366f1"}),C},[m,$,y,j,s]);return g?e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})})}):e.jsxs("section",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:s("dashboard.ltipPoolsSnapshot")}),e.jsx("p",{className:"text-gray-600 text-sm",children:s("dashboard.ltipPoolsSnapshotDesc")})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(qe,{icon:e.jsx(Ms,{className:"w-6 h-6 text-blue-600"}),title:s("dashboard.totalPools"),value:d.length.toString(),iconBg:"bg-blue-100"}),e.jsx(qe,{icon:e.jsx(ye,{className:"w-6 h-6 text-green-600"}),title:s("dashboard.totalAllocated"),value:a.toLocaleString(),iconBg:"bg-green-100"}),e.jsx(qe,{icon:e.jsx(es,{className:"w-6 h-6 text-yellow-600"}),title:s("dashboard.sharesUsedLabel"),value:m.toLocaleString(),iconBg:"bg-yellow-100"}),e.jsx(qe,{icon:e.jsx(Pe,{className:"w-6 h-6 text-purple-600"}),title:s("dashboard.available"),value:k.toLocaleString(),iconBg:"bg-purple-100"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(Je,{title:s("dashboard.sharesByPool"),iconColor:"text-blue-600",expanded:b,onToggle:()=>p(v=>!v),slices:_,totalLabel:s("dashboard.shares"),totalValue:a.toLocaleString(),highlightKey:D,lockedKey:o,hoveredSlice:x,onHoverSlice:ne,onHighlightChange:I,onLockChange:G,chartRef:Y}),e.jsx(Je,{title:s("dashboard.sharesByStatus"),iconColor:"text-green-600",expanded:B,onToggle:()=>P(v=>!v),slices:V,totalLabel:s("dashboard.shares"),totalValue:(m+k).toLocaleString(),highlightKey:ae,lockedKey:re,hoveredSlice:L,onHoverSlice:F,onHighlightChange:Q,onLockChange:z,chartRef:M}),e.jsx(Je,{title:s("dashboard.usedSharesBreakdown"),iconColor:"text-indigo-600",expanded:n,onToggle:()=>c(v=>!v),slices:A,totalLabel:`${s("dashboard.shares")} (${s("dashboard.usedLabel")})`,totalValue:m.toLocaleString(),highlightKey:N,lockedKey:X,hoveredSlice:ee,onHoverSlice:xe,onHighlightChange:K,onLockChange:R,chartRef:oe})]})]})}function qe({icon:s,iconBg:q,title:g,value:w}){return e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${q}`,children:s}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:w})]}),e.jsx("p",{className:"text-gray-600 font-medium text-sm",children:g})]})}function Je(s){const{t:q}=Le(),{title:g,iconColor:w,slices:d,totalLabel:T,totalValue:r,expanded:H,onToggle:O,highlightKey:S,lockedKey:u,hoveredSlice:U,onHoverSlice:b,onHighlightChange:p,onLockChange:B,chartRef:P}=s,n=d.reduce((c,D)=>c+D.value,0);return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("button",{onClick:O,className:"w-full p-4 border-b border-gray-200 flex items-center justify-between hover:bg-gray-50 transition",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ts,{className:`w-5 h-5 ${w}`}),e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:g})]}),H?e.jsx(Ie,{className:"w-5 h-5 text-gray-500"}):e.jsx(Ge,{className:"w-5 h-5 text-gray-500"})]}),e.jsx("div",{className:"p-4",children:n===0?e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:q("common.noData")}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{ref:P,className:"relative w-full h-40 flex items-center justify-center",onClick:c=>{(c.target===c.currentTarget||c.target.tagName==="svg")&&(B(null),p(null),b(null))},children:[e.jsxs("svg",{viewBox:"0 0 120 120",className:"w-full max-w-40 h-40 cursor-pointer",onMouseLeave:()=>{b(null),u||p(null)},children:[d.map(c=>{const D=d.slice(0,d.indexOf(c)).reduce((N,K)=>N+K.value/n*360,0),I=c.value/n*360,o=D+I,G=(D-90)*(Math.PI/180),x=(o-90)*(Math.PI/180),ne=60+50*Math.cos(G),Y=60+50*Math.sin(G),ae=60+50*Math.cos(x),Q=60+50*Math.sin(x),re=I>180?1:0,z=u===c.label,L=S===c.label,F=u?!z:S!==null&&!L,M=c.value/n*100;return e.jsx("path",{d:`M 60 60 L ${ne} ${Y} A 50 50 0 ${re} 1 ${ae} ${Q} Z`,fill:c.color,stroke:"white",strokeWidth:z||L?3:2,style:{opacity:z?1:F?.3:L?1:.85,filter:z||L?"brightness(1.2)":u?"brightness(0.5)":"none",transition:"none"},onMouseEnter:N=>{if(P.current){const K=P.current.getBoundingClientRect(),X=N.clientX-K.left,R=N.clientY-K.top;u||p(c.label),b({label:c.label,value:c.value,percentage:M,x:X,y:R})}},onMouseLeave:()=>{b(null),u||p(null)},onClick:N=>{if(N.stopPropagation(),P.current){const X=P.current.getBoundingClientRect();b({label:c.label,value:c.value,percentage:M,x:X.width/2,y:X.height/2})}const K=u===c.label?null:c.label;B(K),p(K)}},c.label)}),e.jsx("circle",{cx:"60",cy:"60",r:"30",fill:"white"}),e.jsx("text",{x:"60",y:"56",textAnchor:"middle",className:"font-bold",fill:"#111827",fontSize:"12",children:r}),e.jsx("text",{x:"60",y:"70",textAnchor:"middle",fill:"#6b7280",fontSize:"9",children:T})]}),U&&e.jsxs("div",{className:"absolute z-10 bg-gray-900 text-white text-xs rounded-lg px-3 py-2 shadow-lg pointer-events-none whitespace-nowrap",style:{left:`${U.x}px`,top:`${U.y-30}px`,transform:"translateX(-50%)"},children:[e.jsx("div",{className:"font-semibold",children:U.label}),e.jsxs("div",{className:"text-gray-300",children:[U.value.toLocaleString()," (",U.percentage.toFixed(1),"%)"]})]})]}),H&&e.jsx("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:d.map(c=>{const D=n>0?c.value/n*100:0,I=u===c.label,o=S===c.label;return e.jsxs("div",{className:`flex items-center gap-2 text-xs p-1 rounded cursor-pointer transition-colors ${I||o?"bg-blue-50":"hover:bg-gray-50"}`,onMouseEnter:()=>{if(P.current){const G=P.current.getBoundingClientRect();b({label:c.label,value:c.value,percentage:D,x:G.width/2,y:G.height/2}),u||p(c.label)}},onMouseLeave:()=>{b(null),u||p(null)},onClick:()=>{const G=u===c.label?null:c.label;B(G),p(G)},children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:c.color}}),e.jsx("span",{className:"flex-1 truncate",children:c.label}),e.jsxs("span",{className:"font-medium",children:[c.value.toLocaleString()," (",D.toFixed(1),"%)"]})]},c.label)})})]})})]})}const gs=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4","#84cc16"];function Hs(){const{t:s,i18n:q}=Le(),g=q.language==="ar",[w,d]=l.useState(!0),[T,r]=l.useState([]),[H,O]=l.useState({total:0,allocated:0,available:0}),[S,u]=l.useState({}),[U,b]=l.useState(!0),[p,B]=l.useState(!0),[P,n]=l.useState(null),[c,D]=l.useState(null),[I,o]=l.useState(null),G=l.useRef(null),[x,ne]=l.useState(null),[Y,ae]=l.useState(null),[Q,re]=l.useState(null),z=l.useRef(null);l.useEffect(()=>{(async()=>{try{const{data:{user:ee}}=await f.auth.getUser();if(!ee)return;const{data:xe}=await f.from("company_users").select("company_id").eq("user_id",ee.id).maybeSingle();if(!xe)return;const oe=xe.company_id,[{data:a},{data:m},{data:k}]=await Promise.all([f.from("incentive_plans").select("id, plan_name_en, status, total_shares_allocated").eq("company_id",oe),f.from("ltip_pools").select("total_shares_allocated, shares_used, shares_available").eq("company_id",oe),f.from("grants").select("plan_id, total_shares").eq("company_id",oe)]);r(a||[]);const $=(m||[]).reduce((j,_)=>(j.total+=Number(_.total_shares_allocated||0),j.allocated+=Number(_.shares_used||0),j.available+=Number(_.shares_available||0),j),{total:0,allocated:0,available:0});O($);const y={};(k||[]).forEach(j=>{const _=j.plan_id;_&&(y[_]=(y[_]||0)+Number(j.total_shares||0))}),u(y)}finally{d(!1)}})()},[]);const L=l.useMemo(()=>T.reduce((R,ee)=>R+Number(ee.total_shares_allocated||0),0),[T]),F=l.useMemo(()=>Object.values(S).reduce((R,ee)=>R+ee,0),[S]),M=Math.max(L-F,0),N=l.useMemo(()=>H.total?[{label:s("incentivePlans.plannedShares"),value:L,color:"#3b82f6"},{label:s("incentivePlans.unplannedShares"),value:Math.max(H.total-L,0),color:"#94a3b8"}].filter(R=>R.value>0):[],[H.total,L,s]),K=l.useMemo(()=>L?T.filter(R=>R.total_shares_allocated>0).map((R,ee)=>({label:R.plan_name_en,value:R.total_shares_allocated,color:gs[ee%gs.length]})):[],[T,L]);if(w)return e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})})});const X=T.filter(R=>R.status==="active").length;return e.jsxs("section",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:s("incentivePlans.title")}),e.jsx("p",{className:"text-gray-600 text-sm",children:s("incentivePlans.description")})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(He,{className:"w-6 h-6 text-blue-600"})}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(ye,{className:"w-6 h-6 text-green-600"})})]}),e.jsxs("div",{className:g?"text-left":"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500",children:s("incentivePlans.totalPlans")}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:T.length})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:s("incentivePlans.active")}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[X," / ",T.length]})]}),e.jsx(Os,{percentage:T.length?X/T.length*100:0,t:s})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-slate-100 rounded-lg",children:e.jsx(Pe,{className:"w-6 h-6 text-slate-600"})}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:H.total.toLocaleString()})]}),e.jsx("p",{className:"text-gray-600 font-medium mb-2",children:s("incentivePlans.ltipPool")}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx(De,{label:s("incentivePlans.plannedShares"),value:L}),e.jsx(De,{label:s("incentivePlans.granted"),value:F,indent:!0}),e.jsx(De,{label:s("incentivePlans.ungranted"),value:M,indent:!0}),e.jsx(De,{label:s("incentivePlans.availableToPlan"),value:H.available,highlight:!0})]})]}),e.jsx(ps,{title:s("incentivePlans.ltipPoolVsPlanned"),iconColor:"text-cyan-600",totalLabel:s("incentivePlans.totalPool"),totalValue:H.total.toLocaleString(),slices:N,expanded:U,onToggle:()=>b(R=>!R),chartRef:G,hoveredSlice:I,onHoverSlice:o,highlightKey:P,onHighlightChange:n,lockedKey:c,onLockChange:D}),e.jsx(ps,{title:s("incentivePlans.plannedSharesByPlan"),iconColor:"text-purple-600",totalLabel:s("dashboard.shares"),totalValue:L.toLocaleString(),slices:K,expanded:p,onToggle:()=>B(R=>!R),chartRef:z,hoveredSlice:Q,onHoverSlice:re,highlightKey:x,onHighlightChange:ne,lockedKey:Y,onLockChange:ae})]})]})}function De({label:s,value:q,indent:g=!1,highlight:w=!1}){return e.jsxs("div",{className:`flex justify-between ${g?"pl-4":""}`,children:[e.jsxs("span",{className:`text-xs ${w?"text-green-600 font-semibold":"text-gray-500"}`,children:[s,":"]}),e.jsx("span",{className:`text-xs ${w?"text-green-600 font-semibold":"text-gray-900 font-medium"}`,children:q.toLocaleString()})]})}function Os({percentage:s,t:q}){const g=Math.round(s);return e.jsxs("div",{children:[e.jsx("div",{className:"w-full h-2 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-2 bg-green-500 rounded-full transition-all",style:{width:`${Math.min(Math.max(g,0),100)}%`}})}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:[g,"% ",q("incentivePlans.activePercent")]})]})}function ps(s){const{title:q,iconColor:g,totalLabel:w,totalValue:d,slices:T,expanded:r,onToggle:H,chartRef:O,hoveredSlice:S,onHoverSlice:u,highlightKey:U,onHighlightChange:b,lockedKey:p,onLockChange:B}=s,P=T.reduce((n,c)=>n+c.value,0);return e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("button",{className:"w-full flex items-center justify-between mb-4",onClick:H,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:`w-5 h-5 ${g}`}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:q})]}),r?e.jsx(Ie,{className:"w-5 h-5 text-gray-500"}):e.jsx(Ge,{className:"w-5 h-5 text-gray-500"})]}),P===0?e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:t("common.noData")}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:O,className:"relative w-full h-40 flex items-center justify-center",onClick:n=>{(n.target===n.currentTarget||n.target.tagName==="svg")&&(B(null),b(null),u(null))},children:[e.jsxs("svg",{viewBox:"0 0 120 120",className:"w-full max-w-40 h-40 cursor-pointer",onMouseLeave:()=>{u(null),p||b(null)},children:[T.map(n=>{const c=T.slice(0,T.indexOf(n)).reduce((M,N)=>M+N.value/P*360,0),D=n.value/P*360,I=c+D,o=(c-90)*(Math.PI/180),G=(I-90)*(Math.PI/180),x=60+50*Math.cos(o),ne=60+50*Math.sin(o),Y=60+50*Math.cos(G),ae=60+50*Math.sin(G),Q=D>180?1:0,re=n.value/P*100,z=p===n.label,L=U===n.label,F=p?!z:U!==null&&!L;return e.jsx("path",{d:`M 60 60 L ${x} ${ne} A 50 50 0 ${Q} 1 ${Y} ${ae} Z`,fill:n.color,stroke:"white",strokeWidth:z||L?3:2,style:{opacity:z?1:F?.3:L?1:.85,filter:z||L?"brightness(1.2)":p?"brightness(0.5)":"none",transition:"none"},onMouseEnter:M=>{if(O.current){const N=O.current.getBoundingClientRect(),K=M.clientX-N.left,X=M.clientY-N.top;p||b(n.label),u({label:n.label,value:n.value,percentage:re,x:K,y:X})}},onMouseLeave:()=>{u(null),p||b(null)},onClick:M=>{M.stopPropagation();const N=p===n.label?null:n.label;B(N),b(N)}},n.label)}),e.jsx("circle",{cx:"60",cy:"60",r:"30",fill:"white"}),e.jsx("text",{x:"60",y:"56",textAnchor:"middle",className:"font-bold",fill:"#111827",fontSize:"12",children:d}),e.jsx("text",{x:"60",y:"70",textAnchor:"middle",fill:"#6b7280",fontSize:"9",children:w})]}),S&&e.jsxs("div",{className:"absolute z-10 bg-gray-900 text-white text-xs rounded-lg px-3 py-2 shadow-lg pointer-events-none whitespace-nowrap",style:{left:`${S.x}px`,top:`${S.y-30}px`,transform:"translateX(-50%)"},children:[e.jsx("div",{className:"font-semibold",children:S.label}),e.jsxs("div",{className:"text-gray-300",children:[S.value.toLocaleString()," (",S.percentage.toFixed(1),"%)"]})]})]}),r&&e.jsx("div",{className:"space-y-1 max-h-40 overflow-y-auto mt-3",children:T.map(n=>{const c=P>0?n.value/P*100:0,D=p===n.label,I=U===n.label;return e.jsxs("div",{className:`flex items-center gap-2 text-xs p-1 rounded cursor-pointer transition-colors ${D||I?"bg-blue-50":"hover:bg-gray-50"}`,onMouseEnter:()=>{if(O.current){const o=O.current.getBoundingClientRect();u({label:n.label,value:n.value,percentage:c,x:o.width/2,y:o.height/2}),p||b(n.label)}},onMouseLeave:()=>{u(null),p||b(null)},onClick:()=>{const o=p===n.label?null:n.label;B(o),b(o)},children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:n.color}}),e.jsx("span",{className:"flex-1 truncate",title:n.label,children:n.label}),e.jsxs("span",{className:"font-medium",children:[n.value.toLocaleString()," (",c.toFixed(1),"%)"]})]},n.label)})})]})]})}const ve={"Due Now":"#ef4444",Pending:"#f59e0b",Transferred:"#10b981",Exercised:"#8b5cf6",Vested:"#06b6d4","Forfeited/Cancelled":"#6b7280"},be={"Due Now":"#ef4444",Pending:"#f59e0b",Transferred:"#10b981",Exercised:"#8b5cf6",Vested:"#06b6d4","Forfeited/Cancelled":"#6b7280"};function Bs(){const{t:s,i18n:q}=Le();q.language;const[g,w]=l.useState(!0),[d,T]=l.useState(null),[r,H]=l.useState([]),[O,S]=l.useState(!0),[u,U]=l.useState(!0),[b,p]=l.useState(!0),[B,P]=l.useState(null),[n,c]=l.useState(null),[D,I]=l.useState(null),o=l.useRef(null),[G,x]=l.useState(null),[ne,Y]=l.useState(null),[ae,Q]=l.useState(null),re=l.useRef(null);l.useEffect(()=>{(async()=>{try{const{data:{user:M}}=await f.auth.getUser();if(!M)return;const{data:N}=await f.from("company_users").select("company_id").eq("user_id",M.id).maybeSingle();if(!N)return;const K=N.company_id;await bs();const X=await ks(K);X.success&&X.data&&T(X.data);const R=new Date().toISOString().split("T")[0],{data:ee}=await f.from("vesting_events").select(`
            *,
            employees(first_name_en, last_name_en),
            grants(plan_id, grant_number, incentive_plans(plan_name_en, plan_code, plan_type))
          `).eq("company_id",K).eq("status","due").lte("vesting_date",R).order("vesting_date",{ascending:!0}).limit(5),xe=(ee||[]).map(oe=>{var j;const a=(j=oe.grants)==null?void 0:j.incentive_plans,m=oe.employees,k=new Date(oe.vesting_date),$=new Date,y=Math.ceil((k.getTime()-$.getTime())/(1e3*60*60*24));return{...oe,employee_name:`${(m==null?void 0:m.first_name_en)||""} ${(m==null?void 0:m.last_name_en)||""}`.trim()||"Employee",plan_name:(a==null?void 0:a.plan_name_en)||"Unknown Plan",plan_code:(a==null?void 0:a.plan_code)||"N/A",plan_type:(a==null?void 0:a.plan_type)||"LTIP_RSU",days_remaining:y,requires_exercise:(a==null?void 0:a.plan_type)==="ESOP"}});H(xe)}finally{w(!1)}})()},[]);const z=l.useMemo(()=>d?[{label:s("vestingEvents.dueNow"),value:d.due_events,color:ve["Due Now"]},{label:s("vestingEvents.pending"),value:d.pending_events,color:ve.Pending},{label:s("vestingEvents.transferred"),value:d.transferred_events,color:ve.Transferred},{label:s("vestingEvents.exercised"),value:d.exercised_events,color:ve.Exercised},{label:s("vestingEvents.vested"),value:d.vested_events,color:ve.Vested},{label:s("vestingEvents.forfeitedCancelled"),value:d.forfeited_events+d.cancelled_events,color:ve["Forfeited/Cancelled"]}].filter(F=>F.value>0):[],[d,s]),L=l.useMemo(()=>d?[{label:s("vestingEvents.dueNow"),value:d.total_due_shares,color:be["Due Now"]},{label:s("vestingEvents.pending"),value:d.total_pending_shares,color:be.Pending},{label:s("vestingEvents.transferred"),value:d.total_transferred_shares,color:be.Transferred},{label:s("vestingEvents.exercised"),value:d.total_exercised_shares,color:be.Exercised},{label:s("vestingEvents.vested"),value:d.total_vested_shares,color:be.Vested},{label:s("vestingEvents.forfeitedCancelled"),value:d.total_forfeited_shares+d.total_cancelled_shares,color:be["Forfeited/Cancelled"]}].filter(F=>F.value>0):[],[d,s]);return g||!d?e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})})}):e.jsxs("section",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:s("vestingEvents.title")}),e.jsx("p",{className:"text-gray-600 text-sm",children:s("vestingEvents.description")})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(fe,{icon:e.jsx(Vs,{className:"w-5 h-5 text-blue-600"}),title:s("vestingEvents.totalEvents"),primary:`${d.total_events}`,secondary:`${d.total_total_shares.toLocaleString()} ${s("dashboard.shares")}`}),e.jsx(fe,{icon:e.jsx(Be,{className:"w-5 h-5 text-red-600"}),title:s("vestingEvents.dueNow"),primary:d.due_events.toString(),secondary:`${d.total_due_shares.toLocaleString()} ${s("dashboard.shares")}`,highlight:!0}),e.jsx(fe,{icon:e.jsx(ss,{className:"w-5 h-5 text-amber-600"}),title:s("vestingEvents.pending"),primary:d.pending_events.toString(),secondary:`${d.total_pending_shares.toLocaleString()} ${s("dashboard.shares")}`}),e.jsx(fe,{icon:e.jsx(ye,{className:"w-5 h-5 text-indigo-600"}),title:s("vestingEvents.vested"),primary:d.vested_events.toString(),secondary:`${d.total_vested_shares.toLocaleString()} ${s("dashboard.shares")}`}),e.jsx(fe,{icon:e.jsx(Oe,{className:"w-5 h-5 text-purple-600"}),title:s("vestingEvents.exercised"),primary:d.exercised_events.toString(),secondary:`${d.total_exercised_shares.toLocaleString()} ${s("dashboard.shares")}`}),e.jsx(fe,{icon:e.jsx(ye,{className:"w-5 h-5 text-green-600"}),title:s("vestingEvents.transferred"),primary:d.transferred_events.toString(),secondary:`${d.total_transferred_shares.toLocaleString()} ${s("dashboard.shares")}`})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(vs,{title:s("vestingEvents.eventsByStatus"),iconColor:"text-blue-600",slices:z,totalValue:`${d.total_events.toLocaleString()}`,totalLabel:s("vestingEvents.events"),expanded:O,onToggle:()=>S(F=>!F),chartRef:o,hoveredSlice:D,onHoverSlice:I,highlightKey:B,onHighlightChange:P,lockedKey:n,onLockChange:c}),e.jsx(vs,{title:s("vestingEvents.sharesByStatus"),iconColor:"text-green-600",slices:L,totalValue:`${d.total_total_shares.toLocaleString()}`,totalLabel:s("dashboard.shares"),expanded:u,onToggle:()=>U(F=>!F),chartRef:re,hoveredSlice:ae,onHoverSlice:Q,highlightKey:G,onHighlightChange:x,lockedKey:ne,onLockChange:Y}),e.jsx(Is,{events:r,expanded:b,onToggle:()=>p(F=>!F),t:s})]})]})}function fe({icon:s,title:q,primary:g,secondary:w,highlight:d}){return e.jsxs("div",{className:`bg-white rounded-xl p-5 border ${d?"border-red-300 shadow-sm":"border-gray-200"} hover:shadow-lg transition`,children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("div",{className:`p-2 rounded-lg ${d?"bg-red-100":"bg-blue-100"}`,children:s})}),e.jsx("p",{className:"text-sm text-gray-600 font-medium mb-1",children:q}),e.jsx("div",{className:`text-3xl font-bold ${d?"text-red-600":"text-gray-900"}`,children:g}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:w})]})}function vs(s){const{title:q,iconColor:g,slices:w,totalValue:d,totalLabel:T,expanded:r,onToggle:H,chartRef:O,hoveredSlice:S,onHoverSlice:u,highlightKey:U,onHighlightChange:b,lockedKey:p,onLockChange:B}=s,P=w.reduce((n,c)=>n+c.value,0);return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("button",{className:"w-full p-4 border-b border-gray-200 flex items-center justify-between hover:bg-gray-50 transition",onClick:H,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:`w-5 h-5 ${g}`}),e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:q})]}),r?e.jsx(Ie,{className:"w-5 h-5 text-gray-500"}):e.jsx(Ge,{className:"w-5 h-5 text-gray-500"})]}),e.jsx("div",{className:"p-4",children:P===0?e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:t("vestingEvents.noEventsAvailable")}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{ref:O,className:"relative w-full h-40 flex items-center justify-center",onClick:n=>{(n.target===n.currentTarget||n.target.tagName==="svg")&&(B(null),b(null),u(null))},children:[e.jsxs("svg",{viewBox:"0 0 120 120",className:"w-full max-w-40 h-40 cursor-pointer",onMouseLeave:()=>{u(null),p||b(null)},children:[w.map(n=>{const c=w.slice(0,w.indexOf(n)).reduce((M,N)=>M+N.value/P*360,0),D=n.value/P*360,I=c+D,o=(c-90)*(Math.PI/180),G=(I-90)*(Math.PI/180),x=60+50*Math.cos(o),ne=60+50*Math.sin(o),Y=60+50*Math.cos(G),ae=60+50*Math.sin(G),Q=D>180?1:0,re=n.value/P*100,z=p===n.label,L=U===n.label,F=p?!z:U!==null&&!L;return e.jsx("path",{d:`M 60 60 L ${x} ${ne} A 50 50 0 ${Q} 1 ${Y} ${ae} Z`,fill:n.color,stroke:"white",strokeWidth:z||L?3:2,style:{opacity:z?1:F?.3:L?1:.85,filter:z||L?"brightness(1.2)":p?"brightness(0.5)":"none",transition:"none"},onMouseEnter:M=>{if(O.current){const N=O.current.getBoundingClientRect(),K=M.clientX-N.left,X=M.clientY-N.top;p||b(n.label),u({label:n.label,value:n.value,percentage:re,x:K,y:X})}},onMouseLeave:()=>{u(null),p||b(null)},onClick:M=>{M.stopPropagation();const N=p===n.label?null:n.label;B(N),b(N)}},n.label)}),e.jsx("circle",{cx:"60",cy:"60",r:"30",fill:"white"}),e.jsx("text",{x:"60",y:"56",textAnchor:"middle",className:"font-bold",fill:"#111827",fontSize:"12",children:d}),e.jsx("text",{x:"60",y:"70",textAnchor:"middle",fill:"#6b7280",fontSize:"9",children:T})]}),S&&e.jsxs("div",{className:"absolute z-10 bg-gray-900 text-white text-xs rounded-lg px-3 py-2 shadow-lg pointer-events-none whitespace-nowrap",style:{left:`${S.x}px`,top:`${S.y-30}px`,transform:"translateX(-50%)"},children:[e.jsx("div",{className:"font-semibold",children:S.label}),e.jsxs("div",{className:"text-gray-300",children:[S.value.toLocaleString()," (",S.percentage.toFixed(1),"%)"]})]})]}),r&&e.jsx("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:w.map(n=>{const c=P>0?n.value/P*100:0,D=p===n.label,I=U===n.label;return e.jsxs("div",{className:`flex items-center gap-2 text-xs p-1 rounded cursor-pointer transition-colors ${D||I?"bg-blue-50":"hover:bg-gray-50"}`,onMouseEnter:()=>{if(O.current){const o=O.current.getBoundingClientRect();u({label:n.label,value:n.value,percentage:c,x:o.width/2,y:o.height/2}),p||b(n.label)}},onMouseLeave:()=>{u(null),p||b(null)},onClick:()=>{const o=p===n.label?null:n.label;B(o),b(o)},children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:n.color}}),e.jsx("span",{className:"flex-1 truncate",children:n.label}),e.jsxs("span",{className:"font-medium",children:[n.value.toLocaleString()," (",c.toFixed(1),"%)"]})]},n.label)})})]})})]})}function Is({events:s,expanded:q,onToggle:g,t:w}){var T;const d=((T=w.i18n)==null?void 0:T.language)==="ar";return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("button",{onClick:g,className:"w-full p-4 border-b border-gray-200 flex items-center justify-between hover:bg-gray-50 transition",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:w("vestingEvents.dueEvents")}),s.length>0&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800",children:s.length})]}),q?e.jsx(Ie,{className:"w-5 h-5 text-gray-500"}):e.jsx(Ge,{className:"w-5 h-5 text-gray-500"})]}),e.jsx("div",{className:"p-4",children:s.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:w("vestingEvents.noDueEvents")}):e.jsxs("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:[(q?s:s.slice(0,3)).map(r=>{var H;return e.jsx("div",{className:`p-3 border-l-4 border-red-500 bg-red-50 rounded-r-lg ${d?"border-r-4 border-l-0 rounded-l-lg rounded-r-none":""}`,children:e.jsxs("div",{className:`flex items-start justify-between ${d?"flex-row-reverse":""}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 mb-1",children:r.employee_name}),e.jsxs("div",{className:"text-xs text-gray-600",children:[Math.floor(r.shares_to_vest).toLocaleString()," ",w("dashboard.shares")," â€¢ ",r.plan_name]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[Ee(r.vesting_date)," â€¢ ",Ue(r.days_remaining)]})]}),e.jsx("div",{className:"text-xs font-mono bg-white border border-red-200 text-red-600 px-2 py-1 rounded",children:Fe(r.id,r.sequence_number,r.vesting_date,((H=r.grants)==null?void 0:H.grant_number)??r.grant_id).displayId})]})},r.id)}),!q&&s.length>3&&e.jsx("div",{className:"text-center",children:e.jsxs("button",{onClick:g,className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:[w("vestingEvents.showAllDueEvents")," â†’"]})})]})})]})}function Js(){var R,ee,xe,oe;const{t:s,i18n:q}=Le(),g=q.language==="ar",{getCurrentCompanyId:w,userRole:d,isSuperAdmin:T}=Ts(),[r,H]=l.useState({totalEmployees:0,activePlans:0,activeGrants:0,totalShares:0,currentFMV:0,optionPoolBalance:0,totalGrants:0,grantsAccepted:0,grantsPending:0,grantsRejected:0,activeESOPEmployees:0,inactiveESOPEmployees:0,equityPoolSize:0,esopTotalAllocated:0,esopTotalShares:0,ltipTotalAllocated:0,ltipTotalShares:0}),[O,S]=l.useState(!0),[u,U]=l.useState(null),[b,p]=l.useState([]),[B,P]=l.useState([]),[n,c]=l.useState([]),[D,I]=l.useState(!1),[o,G]=l.useState(null),[x,ne]=l.useState({granted:0,ungranted:0,vested:0,unvested:0}),[Y,ae]=l.useState([]),Q=w();l.useEffect(()=>{N()},[]),l.useEffect(()=>{Q&&(u==null?void 0:u.company_id)!==Q&&N()},[Q]),l.useEffect(()=>{if(u!=null&&u.company_id){const a=setTimeout(()=>{L(u.company_id)},300);return()=>clearTimeout(a)}},[u==null?void 0:u.company_id]);const re=async a=>{try{console.log("ðŸ” Loading vesting events for company:",a),await bs();const m=await $s(a,20);console.log("ðŸ“… Loaded vesting events:",m.length),console.log("ðŸŽ¯ Events data:",m),p(m),await z(a),await L(a)}catch(m){console.error("Error loading vesting events:",m),p([])}},z=async a=>{try{console.log("ðŸ” Loading due vesting events for company:",a);const{data:m,error:k}=await f.from("vesting_events").select(`
          *,
          employees (
            id,
            first_name_en,
            first_name_ar,
            last_name_en,
            last_name_ar
          ),
          grants (
            id,
            total_shares,
            vested_shares,
            plan_id,
            incentive_plans (
              plan_name_en,
              plan_code,
              plan_type
            )
          )
        `).eq("company_id",a).eq("status","due").order("vesting_date",{ascending:!0}).limit(10);if(k)throw k;console.log("ðŸ“Š Raw due events from database:",m);const $=new Date,y=(m||[]).filter(V=>new Date(V.vesting_date)>$);y.length>0&&console.warn("âš ï¸ Found events marked as due but with future vesting dates:",y);const _=(m||[]).filter(V=>new Date(V.vesting_date)<=$).map(V=>{var C,W,se,ie,le,de,Z,J,ce,me;const A=new Date(V.vesting_date),v=Math.ceil((A.getTime()-$.getTime())/(1e3*60*60*24)),i=((W=(C=V.grants)==null?void 0:C.incentive_plans)==null?void 0:W.plan_type)||"LTIP_RSU";return{...V,employee_name:`${((se=V.employees)==null?void 0:se.first_name_en)||((ie=V.employees)==null?void 0:ie.first_name_ar)||"Unknown"} ${((le=V.employees)==null?void 0:le.last_name_en)||((de=V.employees)==null?void 0:de.last_name_ar)||"Employee"}`,plan_name:((J=(Z=V.grants)==null?void 0:Z.incentive_plans)==null?void 0:J.plan_name_en)||"Unknown Plan",plan_code:((me=(ce=V.grants)==null?void 0:ce.incentive_plans)==null?void 0:me.plan_code)||"N/A",plan_type:i,days_remaining:v,can_exercise:i==="ESOP"&&V.status==="vested",requires_exercise:i==="ESOP"}});console.log("âœ… Filtered due events (only actually due):",_),P(_)}catch(m){console.error("Error loading due vesting events:",m),P([])}},L=async a=>{try{console.log("ðŸ“… Loading calendar vesting events for company:",a);const{data:m,error:k}=await f.from("vesting_events").select(`
          *,
          employees (
            id,
            first_name_en,
            first_name_ar,
            last_name_en,
            last_name_ar
          ),
          grants (
            id,
            total_shares,
            vested_shares,
            plan_id,
            incentive_plans (
              plan_name_en,
              plan_code,
              plan_type
            )
          )
        `).eq("company_id",a).gte("vesting_date",new Date().toISOString().split("T")[0]).order("vesting_date",{ascending:!0}).limit(100);if(k)throw k;const $=(m||[]).map(y=>{var v,i,C,W,se,ie,le,de,Z,J;const j=new Date(y.vesting_date),_=new Date,V=Math.ceil((j.getTime()-_.getTime())/(1e3*60*60*24)),A=((i=(v=y.grants)==null?void 0:v.incentive_plans)==null?void 0:i.plan_type)||"LTIP_RSU";return{...y,employee_name:`${((C=y.employees)==null?void 0:C.first_name_en)||((W=y.employees)==null?void 0:W.first_name_ar)||"Unknown"} ${((se=y.employees)==null?void 0:se.last_name_en)||((ie=y.employees)==null?void 0:ie.last_name_ar)||"Employee"}`,plan_name:((de=(le=y.grants)==null?void 0:le.incentive_plans)==null?void 0:de.plan_name_en)||"Unknown Plan",plan_code:((J=(Z=y.grants)==null?void 0:Z.incentive_plans)==null?void 0:J.plan_code)||"N/A",plan_type:A,days_remaining:V,can_exercise:A==="ESOP"&&y.status==="vested",requires_exercise:A==="ESOP"}});console.log("ðŸ“… Loaded calendar events:",$.length),c($)}catch(m){console.error("Error loading calendar vesting events:",m),c([])}},F=async a=>{try{const{data:m}=await f.from("companies").select("current_fmv").eq("id",a).single(),k=(m==null?void 0:m.current_fmv)||30,{data:$,error:y}=await f.from("vesting_events").select(`
          *,
          grants (
            id,
            total_shares,
            vested_shares
          )
        `).eq("company_id",a).order("vesting_date",{ascending:!0});if(y)throw y;const j=new Date().getFullYear(),_=[];for(let A=j;A<j+5;A++)_.push({year:String(A),unvestedShares:0,unvestedValuation:0,vestedShares:0,vestedValuation:0});const V=new Date;V.setHours(0,0,0,0),($||[]).forEach(A=>{const v=new Date(A.vesting_date),i=v.getFullYear(),C=Number(A.shares_to_vest||0);if(C<=0)return;const W=_.findIndex(se=>parseInt(se.year)===i);W>=0&&(v<V||A.status==="vested"||A.status==="transferred"||A.status==="exercised"||A.status==="due"?(_[W].vestedShares+=C,_[W].vestedValuation+=C*k):A.status!=="lapsed"&&(_[W].unvestedShares+=C,_[W].unvestedValuation+=C*k))}),ae(_)}catch(m){console.error("Error loading roadmap data:",m),ae([])}},M=a=>{G(a),I(!0)},N=async()=>{var a,m,k,$,y,j,_,V,A,v;try{const i=w();if(T()&&!i){console.log("Super admin - no company selected"),S(!1),U(null);return}if(!i){console.log("No company ID available"),S(!1);return}console.log("Loading dashboard for company ID:",i);const{data:C,error:W}=await f.from("companies").select("*").eq("id",i).maybeSingle();if(W){console.error("Error fetching company:",W),S(!1);return}if(C){U({company_id:i,companies:C}),console.log("Company ID:",i),Promise.all([re(i).catch(h=>{console.error("Error loading vesting events:",h)}),F(i).catch(h=>{console.error("Error loading roadmap:",h)})]).catch(()=>{});const[se,ie,le,de,Z,J,ce,me,je,ue,Ce,fs,ys]=await Promise.all([f.from("employees").select("id",{count:"exact",head:!0}).eq("company_id",i).eq("employment_status","active"),f.from("incentive_plans").select("id",{count:"exact",head:!0}).eq("company_id",i).eq("status","active"),f.from("grants").select("id",{count:"exact",head:!0}).eq("company_id",i).eq("status","active"),f.from("grants").select("total_shares").eq("company_id",i).eq("status","active"),f.from("market_data").select("closing_price").eq("tadawul_symbol",(C==null?void 0:C.tadawul_symbol)||"4084").order("trading_date",{ascending:!1}).limit(1).maybeSingle(),f.from("companies").select("available_shares, tadawul_symbol, current_fmv, fmv_source").eq("id",i).maybeSingle(),f.from("grants").select("id",{count:"exact",head:!0}).eq("company_id",i),f.from("grants").select("id",{count:"exact",head:!0}).eq("company_id",i).eq("status","active"),f.from("grants").select("id",{count:"exact",head:!0}).eq("company_id",i).eq("status","pending_signature"),f.from("grants").select("id",{count:"exact",head:!0}).eq("company_id",i).eq("status","cancelled"),f.from("shareholders").select("shares_owned").eq("company_id",i).eq("shareholder_type","employee").eq("is_active",!0),f.from("shareholders").select("shares_owned").eq("company_id",i).eq("is_active",!0),f.from("ltip_pools").select("total_shares_allocated, shares_used, shares_available").eq("company_id",i)]);if(!se||!ie||!le){console.error("Critical queries failed"),S(!1);return}const as=((a=de.data)==null?void 0:a.reduce((h,E)=>h+Number(E.total_shares||0),0))||0,[js,Ns,ls]=await Promise.all([f.from("grants").select("employee_id").eq("company_id",i).eq("status","active"),f.from("grants").select("employee_id, employees!inner(employment_status)").eq("company_id",i).neq("employees.employment_status","active"),f.from("incentive_plans").select("id, total_shares_allocated, shares_granted, shares_available").eq("company_id",i).eq("plan_type","ESOP").eq("status","active")]),_s=new Set(((m=js.data)==null?void 0:m.map(h=>h.employee_id))||[]).size,ws=new Set(((k=Ns.data)==null?void 0:k.map(h=>h.employee_id))||[]).size,ns=(($=ls.data)==null?void 0:$.map(h=>h.id))||[],rs=((y=(ns.length>0?await f.from("grants").select("total_shares").eq("company_id",i).eq("status","active").in("plan_id",ns):{data:[]}).data)==null?void 0:y.reduce((h,E)=>h+Number(E.total_shares||0),0))||0,Ss=((j=ls.data)==null?void 0:j.reduce((h,E)=>h+Number(E.total_shares_allocated||0),0))||0,os=(ys.data||[]).reduce((h,E)=>(h.total+=Number(E.total_shares_allocated||0),h.used+=Number(E.shares_used||0),h),{total:0,used:0}),ze=os.total,Ke=os.used,{data:Te,error:is}=await f.from("grants").select(`
            id, 
            total_shares, 
            vested_shares, 
            remaining_unvested_shares, 
            status,
            plan_id,
            incentive_plans (
              plan_type
            )
          `).eq("company_id",i);is&&console.error("Error fetching grants for breakdown:",is);const Ne=(Te||[]).filter(h=>{var te;const E=(te=h.incentive_plans)==null?void 0:te.plan_type;return E&&E.startsWith("LTIP")}),ke=Ne.filter(h=>h.status!=="cancelled"&&h.status!=="forfeited"),ds=Ne.filter(h=>!h.status||h.status===null);ds.length>0&&console.warn("âš ï¸ Found grants with null status:",ds.length);const Es=Ne.reduce((h,E)=>{const te=E.status||"unknown";return h[te]||(h[te]={count:0,shares:0}),h[te].count+=1,h[te].shares+=Number(E.total_shares||0),h},{}),Xe=ke.reduce((h,E)=>h+Number(E.total_shares||0),0),Ps=Ne.reduce((h,E)=>h+Number(E.total_shares||0),0),{data:Ls}=await f.from("incentive_plans").select("shares_granted, plan_type").eq("company_id",i).like("plan_type","LTIP%"),$e=(Ls||[]).reduce((h,E)=>h+Number(E.shares_granted||0),0),_e=$e>0?$e:Xe;console.log("ðŸ“Š Shares Breakdown Debug:",{totalGrants:(Te==null?void 0:Te.length)||0,ltipGrants:Ne.length,validLtipGrants:ke.length,ltipTotalAllocated:ze,ltipTotalShares:Ke,grantedSharesFromGrants:Xe,grantedSharesAll:Ps,grantedFromPlans:$e,grantedShares:_e,sharesByStatus:Es,differenceFromExpected:71131-_e,differenceFromPlans:$e-Xe,sampleGrant:ke[0]});const cs=Math.max(0,ze-_e),Me=ke.filter(h=>h.status==="active"),Ve=Me.reduce((h,E)=>h+Number(E.total_shares||0),0);let ge=0,we=0;if(Me.length>0&&(ge=Me.reduce((h,E)=>{const te=Number(E.vested_shares||0);return h+te},0),we=Math.max(0,Ve-ge),ge===0&&Ve>0)){const h=Me.map(te=>te.id),{data:E}=await f.from("vesting_events").select("grant_id, shares_to_vest, status").in("grant_id",h);if(E){const te=E.filter(Se=>Se.status==="vested"||Se.status==="transferred"||Se.status==="exercised").reduce((Se,Cs)=>Se+Number(Cs.shares_to_vest||0),0);ge=te,we=Math.max(0,Ve-te),console.log("ðŸ“Š Calculated from vesting events:",{vestedFromEvents:te,activeGrantedTotal:Ve,unvestedShares:we})}}console.log("ðŸ“Š Calculated Breakdown:",{granted:_e,ungranted:cs,vested:ge,unvested:we}),ne({granted:_e,ungranted:cs,vested:ge,unvested:we});const Ye=((_=Ce.data)==null?void 0:_.reduce((h,E)=>h+Number(E.shares_owned),0))||0,We=((V=fs.data)==null?void 0:V.reduce((h,E)=>h+Number(E.shares_owned),0))||0,xs=We-Ye,Ze=(A=Z==null?void 0:Z.data)==null?void 0:A.closing_price,Ae=Ze!=null?Number(Ze):null,Qe=(v=J.data)==null?void 0:v.current_fmv,Re=Qe!=null?Number(Qe):null,ms=Ae!==null&&!Number.isNaN(Ae)?Ae:Re!==null&&!Number.isNaN(Re)?Re:0;console.log("Employee shares total:",Ye),console.log("Total shares from shareholders:",We),console.log("Option pool balance:",xs),console.log("Query results:",{employeesCount:se.count,plansCount:ie.count,activeGrantsCount:le.count,totalShares:as,closingPrice:Ae,manualFmv:Re,resolvedCurrentFmv:ms,employeeSharesTotal:Ye,totalSharesFromShareholders:We,optionPoolBalance:xs}),console.log("Full responses with errors:",{employeesRes:se,plansRes:ie,activeGrantsRes:le}),H({totalEmployees:se.count||0,activePlans:ie.count||0,activeGrants:le.count||0,totalShares:as,currentFMV:ms,optionPoolBalance:rs,totalGrants:ce.count||0,grantsAccepted:me.count||0,grantsPending:je.count||0,grantsRejected:ue.count||0,activeESOPEmployees:_s,inactiveESOPEmployees:ws,equityPoolSize:Ke,esopTotalAllocated:Ss,esopTotalShares:rs,ltipTotalAllocated:ze,ltipTotalShares:Ke})}}catch(i){console.error("Error loading dashboard data:",i)}finally{S(!1)}},K=l.useMemo(()=>[{name:"Active Employees",value:r.totalEmployees,icon:Pe,change:"+12%",changeType:"increase",color:"blue",tooltip:"Total number of employees with active employment status in the system"},{name:"Active Plans",value:r.activePlans,icon:He,change:"+3",changeType:"increase",color:"green",tooltip:"Number of currently active LTIP or ESOP plans in your company"},{name:"Shares Granted",value:r.totalShares.toLocaleString(),icon:ye,change:"+8%",changeType:"increase",color:"orange",tooltip:"Total number of shares granted to employees across all active grants"},{name:"Current FMV",value:`SAR ${r.currentFMV.toFixed(2)}`,icon:es,change:"+2.5%",changeType:"increase",color:"emerald",tooltip:"Fair Market Value - The latest closing price from Tadawul stock exchange"},{name:"Equity Pool Size",value:r.equityPoolSize.toLocaleString(),icon:pe,change:"0%",changeType:"increase",color:"violet",tooltip:"Total LTIP shares used across all pools compared to the overall LTIP allocation"},{name:"Options Pool Used",value:r.optionPoolBalance.toLocaleString(),icon:pe,change:"-5%",changeType:"decrease",color:"sky",tooltip:"Total ESOP options used across the ESOP plan compared to the available pool"},{name:"Total Grants",value:r.totalGrants,icon:Oe,change:"+15",changeType:"increase",color:"purple",tooltip:"Total number of equity grants issued to employees, regardless of status"},{name:"Grants Accepted",value:r.grantsAccepted,icon:hs,change:"+8",changeType:"increase",color:"teal",tooltip:"Number of grants that have been accepted and signed by employees"},{name:"Grants Pending",value:r.grantsPending,icon:ss,change:"+3",changeType:"increase",color:"amber",tooltip:"Number of grants awaiting employee signature and acceptance"},{name:"Grants Rejected",value:r.grantsRejected,icon:As,change:"+1",changeType:"increase",color:"red",tooltip:"Number of grants that have been cancelled or rejected"},{name:"Active ESOP Employees",value:r.activeESOPEmployees,icon:Rs,change:"+7",changeType:"increase",color:"cyan",tooltip:"Number of currently employed individuals with active equity grants"},{name:"Inactive ESOP Employees",value:r.inactiveESOPEmployees,icon:qs,change:"+2",changeType:"increase",color:"gray",tooltip:"Number of former employees who had equity grants (terminated, resigned, or retired)"}],[r]),X={blue:"bg-blue-500",green:"bg-green-500",purple:"bg-purple-500",orange:"bg-orange-500",teal:"bg-teal-500",red:"bg-red-500",cyan:"bg-cyan-500",gray:"bg-gray-500",emerald:"bg-emerald-500",violet:"bg-violet-500",sky:"bg-sky-500",amber:"bg-amber-500"};return O?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):T()&&!Q?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s("dashboard.title")}),e.jsx("p",{className:"text-gray-600 mt-1",children:s("dashboard.welcome")})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-8 text-center",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx(he,{className:"w-12 h-12 text-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a Company"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"As a super admin, please select a company from the dropdown in the header to view its dashboard."}),e.jsxs("p",{className:"text-sm text-gray-500",children:["You can also access the ",e.jsx("a",{href:"/operator/companies",className:"text-blue-600 hover:underline",children:"Operator Console"})," to manage all companies."]})]})})]}):u?e.jsxs("div",{className:`space-y-6 ${g?"text-right":"text-left"}`,children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s("dashboard.title")}),e.jsx("p",{className:"text-gray-600 mt-1",children:s("dashboard.welcome")})]}),u&&e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl p-6 text-white",children:e.jsxs("div",{className:`flex items-center justify-between ${g?"flex-row-reverse":""}`,children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:(R=u.companies)==null?void 0:R.company_name_en}),e.jsxs("p",{className:"text-blue-100 mt-1",children:[s("dashboard.tadawul"),": ",(ee=u.companies)==null?void 0:ee.tadawul_symbol]})]}),e.jsxs("div",{className:g?"text-left":"text-right",children:[e.jsx("p",{className:"text-sm text-blue-100",children:s("dashboard.verificationStatus")}),e.jsx("span",{className:"inline-block mt-1 px-3 py-1 bg-white/20 rounded-full text-sm font-medium",children:(xe=u.companies)==null?void 0:xe.verification_status})]})]})}),e.jsxs("div",{className:"space-y-10",children:[e.jsx(Fs,{}),e.jsx(Hs,{}),e.jsx(Bs,{})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 hover:shadow-lg transition",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-violet-500",children:e.jsx(pe,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:s("dashboard.equityPoolSize")}),e.jsxs("div",{className:"group relative",children:[e.jsx(he,{className:"w-4 h-4 text-gray-400 cursor-help"}),e.jsx("div",{className:`absolute ${g?"right-0":"left-0"} top-6 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10 shadow-lg`,children:s("dashboard.equityPoolSizeTooltip")})]})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:[r.equityPoolSize.toLocaleString()," / ",r.ltipTotalAllocated.toLocaleString()]})]})]})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600",children:s("dashboard.usedVsTotalPool")}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[r.ltipTotalAllocated>0?(r.ltipTotalShares/r.ltipTotalAllocated*100).toFixed(1):0,"% ",s("dashboard.used")]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-violet-500 to-purple-600 h-3 rounded-full transition-all duration-500",style:{width:`${r.ltipTotalAllocated>0?Math.min(r.ltipTotalShares/r.ltipTotalAllocated*100,100):0}%`}})}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-2",children:[e.jsxs("span",{children:[r.ltipTotalShares.toLocaleString()," ",s("dashboard.sharesUsed")]}),e.jsxs("span",{children:[r.ltipTotalAllocated.toLocaleString()," ",s("dashboard.totalPool")]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 hover:shadow-lg transition",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-indigo-500",children:e.jsx(pe,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Used Shares Breakdown"}),e.jsxs("div",{className:"group relative",children:[e.jsx(he,{className:"w-4 h-4 text-gray-400 cursor-help"}),e.jsx("div",{className:"absolute left-0 top-6 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10 shadow-lg",children:"Breakdown of used shares showing granted vs ungranted, and vested vs unvested"})]})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:[x.granted.toLocaleString()," / ",r.ltipTotalAllocated.toLocaleString()]})]})]})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-3",children:[e.jsx("span",{className:"text-gray-600",children:s("dashboard.breakdownOfUsedShares")}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[r.ltipTotalAllocated>0?(x.granted/r.ltipTotalAllocated*100).toFixed(1):0,"% ",s("dashboard.granted")]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 mb-4 overflow-hidden",children:e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-indigo-600 transition-all duration-500",style:{width:`${r.ltipTotalAllocated>0?Math.min(x.granted/r.ltipTotalAllocated*100,100):0}%`},title:`Granted: ${x.granted.toLocaleString()}`}),e.jsx("div",{className:"bg-gradient-to-r from-gray-300 to-gray-400 transition-all duration-500",style:{width:`${r.ltipTotalAllocated>0?Math.min(x.ungranted/r.ltipTotalAllocated*100,100):0}%`},title:`Ungranted: ${x.ungranted.toLocaleString()}`})]})}),e.jsx("div",{className:"w-full bg-gray-100 rounded-full h-3 mb-4 overflow-hidden",children:e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 transition-all duration-500",style:{width:`${x.granted>0?Math.min(x.vested/x.granted*100,100):0}%`},title:`Vested: ${x.vested.toLocaleString()}`}),e.jsx("div",{className:"bg-gradient-to-r from-amber-500 to-amber-600 transition-all duration-500",style:{width:`${x.granted>0?Math.min(x.unvested/x.granted*100,100):0}%`},title:`Unvested: ${x.unvested.toLocaleString()}`})]})}),e.jsxs("div",{className:`grid grid-cols-2 gap-3 text-xs ${g?"text-right":"text-left"}`,children:[e.jsxs("div",{className:`flex items-center gap-2 ${g?"flex-row-reverse":""}`,children:[e.jsx("div",{className:"w-3 h-3 rounded bg-indigo-500"}),e.jsxs("span",{className:"text-gray-600",children:[s("dashboard.grantedLabel"),": ",x.granted.toLocaleString()]})]}),e.jsxs("div",{className:`flex items-center gap-2 ${g?"flex-row-reverse":""}`,children:[e.jsx("div",{className:"w-3 h-3 rounded bg-gray-400"}),e.jsxs("span",{className:"text-gray-600",children:[s("dashboard.ungranted"),": ",x.ungranted.toLocaleString()]})]}),e.jsxs("div",{className:`flex items-center gap-2 ${g?"flex-row-reverse":""}`,children:[e.jsx("div",{className:"w-3 h-3 rounded bg-green-500"}),e.jsxs("span",{className:"text-gray-600",children:[s("dashboard.vested"),": ",x.vested.toLocaleString()]})]}),e.jsxs("div",{className:`flex items-center gap-2 ${g?"flex-row-reverse":""}`,children:[e.jsx("div",{className:"w-3 h-3 rounded bg-amber-500"}),e.jsxs("span",{className:"text-gray-600",children:[s("dashboard.unvested"),": ",x.unvested.toLocaleString()]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 hover:shadow-lg transition",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-500",children:e.jsx(pe,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:s("dashboard.usedSharesBreakdown")}),e.jsxs("div",{className:"group relative",children:[e.jsx(he,{className:"w-4 h-4 text-gray-400 cursor-help"}),e.jsx("div",{className:`absolute ${g?"right-0":"left-0"} top-6 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10 shadow-lg`,children:s("dashboard.usedSharesBreakdownTooltip")})]})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:[x.granted.toLocaleString()," / ",r.ltipTotalAllocated.toLocaleString()]})]})]})}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:s("dashboard.grantedVsUngranted")}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[r.ltipTotalAllocated>0?(x.granted/r.ltipTotalAllocated*100).toFixed(1):0,"% ",s("dashboard.granted")]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:"bg-purple-500 transition-all duration-500 flex items-center justify-end pr-2",style:{width:`${r.ltipTotalAllocated>0?Math.min(x.granted/r.ltipTotalAllocated*100,100):0}%`},children:e.jsx("span",{className:"text-xs font-semibold text-white",children:x.granted>0?x.granted.toLocaleString():""})}),e.jsx("div",{className:"bg-gray-400 transition-all duration-500 flex items-center pl-2",style:{width:`${r.ltipTotalAllocated>0?Math.min(x.ungranted/r.ltipTotalAllocated*100,100):0}%`},children:e.jsx("span",{className:"text-xs font-semibold text-white",children:x.ungranted>0?x.ungranted.toLocaleString():""})})]})}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-1",children:[e.jsxs("span",{children:[s("dashboard.grantedLabel"),": ",x.granted.toLocaleString()]}),e.jsxs("span",{children:[s("dashboard.ungranted"),": ",x.ungranted.toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:s("dashboard.vestedVsUnvested")}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[x.granted>0?(x.vested/x.granted*100).toFixed(1):0,"% ",s("dashboard.vested").toLowerCase()]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:"bg-green-500 transition-all duration-500 flex items-center justify-end pr-2",style:{width:`${x.granted>0?Math.min(x.vested/x.granted*100,100):0}%`},children:e.jsx("span",{className:"text-xs font-semibold text-white",children:x.vested>0?x.vested.toLocaleString():""})}),e.jsx("div",{className:"bg-orange-500 transition-all duration-500 flex items-center pl-2",style:{width:`${x.granted>0?Math.min(x.unvested/x.granted*100,100):0}%`},children:e.jsx("span",{className:"text-xs font-semibold text-white",children:x.unvested>0?x.unvested.toLocaleString():""})})]})}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-1",children:[e.jsxs("span",{children:[s("dashboard.vested"),": ",x.vested.toLocaleString()]}),e.jsxs("span",{children:[s("dashboard.unvested"),": ",x.unvested.toLocaleString()]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 hover:shadow-lg transition",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-sky-500",children:e.jsx(pe,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:s("dashboard.optionsPoolUsed")}),e.jsxs("div",{className:"group relative",children:[e.jsx(he,{className:"w-4 h-4 text-gray-400 cursor-help"}),e.jsx("div",{className:`absolute ${g?"right-0":"left-0"} top-6 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10 shadow-lg`,children:s("dashboard.optionsPoolUsedTooltip")})]})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:[r.optionPoolBalance.toLocaleString()," / ",r.esopTotalAllocated.toLocaleString()]})]})]})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600",children:s("dashboard.usedVsAvailable")}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[r.esopTotalAllocated>0?(r.esopTotalShares/r.esopTotalAllocated*100).toFixed(1):0,"% ",s("dashboard.used")]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-sky-500 to-blue-600 h-3 rounded-full transition-all duration-500",style:{width:`${r.esopTotalAllocated>0?Math.min(r.esopTotalShares/r.esopTotalAllocated*100,100):0}%`}})}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-2",children:[e.jsxs("span",{children:[r.esopTotalShares.toLocaleString()," ",s("dashboard.sharesUsed")]}),e.jsxs("span",{children:[r.esopTotalAllocated.toLocaleString()," ",s("dashboard.totalPool")]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:K.filter(a=>a.name!=="Current FMV"&&a.name!=="Equity Pool Size"&&a.name!=="Options Pool Used").slice(0,2).map(a=>e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-200 hover:shadow-lg transition",children:[e.jsx("div",{className:"flex items-center mb-3",children:e.jsx("div",{className:`p-2 rounded-lg ${X[a.color]}`,children:e.jsx(a.icon,{className:"w-5 h-5 text-white"})})}),e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:a.name}),e.jsxs("div",{className:"group relative",children:[e.jsx(he,{className:"w-4 h-4 text-gray-400 cursor-help"}),e.jsx("div",{className:"absolute left-0 top-6 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10 shadow-lg",children:a.tooltip})]})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.value})]},a.name))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-200 hover:shadow-lg transition",children:[e.jsx("div",{className:"flex items-center mb-3",children:e.jsx("div",{className:"p-2 rounded-lg bg-emerald-500",children:e.jsx(es,{className:"w-5 h-5 text-white"})})}),e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:s("dashboard.currentFMV")}),e.jsxs("div",{className:"group relative",children:[e.jsx(he,{className:"w-4 h-4 text-gray-400 cursor-help"}),e.jsx("div",{className:`absolute ${g?"right-0":"left-0"} top-6 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10 shadow-lg`,children:s("dashboard.currentFMVTooltip")})]})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["SAR ",r.currentFMV.toFixed(2)]})]}),K.filter(a=>a.name!=="Current FMV"&&a.name!=="Equity Pool Size"&&a.name!=="Options Pool Used").slice(2).map(a=>e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-200 hover:shadow-lg transition",children:[e.jsx("div",{className:"flex items-center mb-3",children:e.jsx("div",{className:`p-2 rounded-lg ${X[a.color]}`,children:e.jsx(a.icon,{className:"w-5 h-5 text-white"})})}),e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:a.name}),e.jsxs("div",{className:"group relative",children:[e.jsx(he,{className:"w-4 h-4 text-gray-400 cursor-help"}),e.jsx("div",{className:"absolute left-0 top-6 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10 shadow-lg",children:a.tooltip})]})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.value})]},a.name))]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:s("dashboard.recentActivity")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`flex items-center space-x-4 p-4 bg-gray-50 rounded-lg ${g?"space-x-reverse":""}`,children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Oe,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s("dashboard.newGrantIssued")}),e.jsxs("p",{className:"text-xs text-gray-500",children:["2 ",s("dashboard.hoursAgo")]})]})]}),e.jsxs("div",{className:`flex items-center space-x-4 p-4 bg-gray-50 rounded-lg ${g?"space-x-reverse":""}`,children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(Pe,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["25 ",s("dashboard.employeesAdded")]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["1 ",s("dashboard.daysAgo")]})]})]}),e.jsxs("div",{className:`flex items-center space-x-4 p-4 bg-gray-50 rounded-lg ${g?"space-x-reverse":""}`,children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(He,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s("dashboard.newLTIPPlanCreated")}),e.jsxs("p",{className:"text-xs text-gray-500",children:["3 ",s("dashboard.daysAgo")]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:`flex items-center justify-between mb-4 ${g?"flex-row-reverse":""}`,children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:s("dashboard.upcomingVestingEvents")}),e.jsxs("div",{className:`flex items-center gap-2 ${g?"flex-row-reverse":""}`,children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[s("dashboard.nextOf")," 3 ",s("dashboard.of")," ",b.length]}),b.length>3&&e.jsx("button",{onClick:()=>window.location.href="/dashboard/vesting-events",className:"px-3 py-1 text-xs font-medium bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 transition",children:s("dashboard.more")})]})]}),b.length>0?e.jsx("div",{className:"space-y-3",children:b.slice(0,3).map(a=>{var _;const m=a.event_type==="cliff",k=m?"border-orange-500":"border-blue-500",$=m?"bg-orange-50":"bg-blue-50",y=m?"bg-orange-100 text-orange-800":"bg-blue-100 text-blue-800",j=a.status==="due"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800";return e.jsx("div",{className:`p-4 border-l-4 ${k} ${$} rounded-r-lg`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:a.employee_name}),e.jsx("button",{onClick:()=>M(a),className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800 hover:bg-blue-200 transition cursor-pointer",children:Fe(a.id,a.sequence_number,a.vesting_date,((_=a.grants)==null?void 0:_.grant_number)??a.grant_id).displayId}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${y}`,children:s(m?"dashboard.cliff":"dashboard.vesting")}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${j}`,children:a.status.charAt(0).toUpperCase()+a.status.slice(1)}),a.requires_exercise&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-purple-100 text-purple-800",children:"ESOP"})]}),e.jsxs("p",{className:"text-xs text-gray-600 mb-1",children:[Math.floor(a.shares_to_vest).toLocaleString()," ",s("dashboard.shares")," â€¢ ",a.plan_name," (",a.plan_code,")"]}),a.exercise_price&&e.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:[s("dashboard.exercisePrice"),": $",a.exercise_price.toFixed(2)," â€¢ ",s("dashboard.totalCost"),": $",(a.shares_to_vest*a.exercise_price).toFixed(2)]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-gray-500",children:Ee(a.vesting_date)}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:Ue(a.days_remaining)})]})]})})},a.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ss,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-500",children:s("dashboard.noUpcomingVestingEvents")}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:s("dashboard.noUpcomingVestingEventsDesc")})]}),b.length>3&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 text-center",children:e.jsxs("button",{onClick:()=>window.location.href="/dashboard/vesting-events",className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:[s("dashboard.viewAllUpcomingEvents")," ",b.length," ",s("dashboard.upcomingEvents")," â†’"]})})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:`flex items-center justify-between mb-4 ${g?"flex-row-reverse":""}`,children:[e.jsxs("div",{className:`flex items-center gap-2 ${g?"flex-row-reverse":""}`,children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:s("dashboard.vestingEventsDue")}),B.length>0&&e.jsxs("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800",children:[B.length," ",s("dashboard.dueNow")]})]}),e.jsx("span",{className:"text-sm text-gray-500",children:s("dashboard.requiresImmediateAttention")})]}),B.length>0?e.jsx("div",{className:"space-y-3",children:B.map(a=>{var j;const m=a.event_type==="cliff",k="border-red-500",$="bg-red-50",y=m?"bg-orange-100 text-orange-800":"bg-blue-100 text-blue-800";return e.jsx("div",{className:`p-4 border-l-4 ${k} ${$} rounded-r-lg`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:a.employee_name}),e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800",children:Fe(a.id,a.sequence_number,a.vesting_date,((j=a.grants)==null?void 0:j.grant_number)??a.grant_id).displayId}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${y}`,children:m?"Cliff":"Vesting"}),e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800",children:"DUE NOW"}),a.requires_exercise&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-purple-100 text-purple-800",children:"ESOP"})]}),e.jsxs("p",{className:"text-xs text-gray-600 mb-1",children:[Math.floor(a.shares_to_vest).toLocaleString()," shares â€¢ ",a.plan_name," (",a.plan_code,")"]}),a.exercise_price&&e.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:["Exercise Price: $",a.exercise_price.toFixed(2)," â€¢ Total Cost: $",(a.shares_to_vest*a.exercise_price).toFixed(2)]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-gray-500",children:Ee(a.vesting_date)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-red-600",children:Ue(a.days_remaining)}),e.jsx("button",{onClick:()=>M(a),className:"px-3 py-1 text-xs font-medium bg-blue-600 text-white rounded-md hover:bg-blue-700 transition",children:"View Details"})]})]})]})})},a.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(hs,{className:"w-12 h-12 text-green-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No vesting events due"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"All vesting events are up to date"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm mb-6",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Shares Roadmap"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Company-wide vesting schedule overview"})]}),e.jsx("div",{className:"p-6",children:Y&&Y.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-end justify-between gap-2",style:{height:"256px"},children:Y.map((a,m)=>{const k=Math.max(...Y.map(i=>(i.unvestedValuation||0)+(i.vestedValuation||0)),1),$=(a.unvestedValuation||0)+(a.vestedValuation||0),j=k>0?$/k*256:0,_=$>0?(a.vestedValuation||0)/$*j:0,V=j-_,A=_>0?Math.max(_,4):0,v=V>0?Math.max(V,4):0;return e.jsxs("div",{className:"flex-1 h-full flex flex-col items-center group cursor-pointer relative",children:[e.jsxs("div",{className:"hidden group-hover:block absolute bottom-full mb-2 bg-gray-900 text-white text-xs rounded-lg px-3 py-2 shadow-lg z-10 whitespace-nowrap transform -translate-x-1/2 left-1/2",children:[e.jsx("div",{className:"font-semibold mb-1",children:a.year}),a.vestedValuation>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-green-300",children:["â€¢ Vested Valuation: ",e.jsxs("strong",{children:["SAR ",a.vestedValuation.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"text-green-300",children:["â€¢ Vested Shares: ",e.jsx("strong",{children:a.vestedShares.toLocaleString()})]})]}),a.unvestedValuation>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-purple-300",children:["â€¢ Unvested Valuation: ",e.jsxs("strong",{children:["SAR ",a.unvestedValuation.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"text-purple-300",children:["â€¢ Unvested Shares: ",e.jsx("strong",{children:a.unvestedShares.toLocaleString()})]})]}),$===0&&e.jsx("div",{className:"text-gray-400",children:"No shares in this period"})]}),e.jsxs("div",{className:"relative w-full h-full flex flex-col items-center justify-end",children:[(a.unvestedShares>0||a.vestedShares>0)&&e.jsx("div",{className:"absolute text-xs font-semibold text-gray-700 whitespace-nowrap",style:{bottom:`${j+4}px`,left:"50%",transform:"translateX(-50%)"},children:(a.unvestedShares+a.vestedShares).toLocaleString()}),v>0&&e.jsx("div",{className:"w-full bg-gradient-to-t from-purple-600 to-purple-500 rounded-t-lg transition-all duration-300 group-hover:from-purple-700 group-hover:to-purple-600 group-hover:shadow-lg",style:{height:`${v}px`}}),A>0&&e.jsx("div",{className:"w-full bg-gradient-to-t from-green-600 to-green-500 transition-all duration-300 group-hover:from-green-700 group-hover:to-green-600 group-hover:shadow-lg",style:{height:`${A}px`,borderRadius:v===0?"0.5rem 0.5rem 0 0":"0"}})]})]},m)})}),e.jsx("div",{className:"flex items-center justify-between gap-2 mt-2 border-t border-gray-200 pt-3",children:Y.map((a,m)=>e.jsx("div",{className:"flex-1 text-center",children:e.jsx("div",{className:"text-xs text-gray-600 font-medium",children:a.year})},m))}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-4 text-xs text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-green-600"}),e.jsx("span",{children:"Vested Shares (SAR)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-purple-600"}),e.jsx("span",{children:"Unvested Shares (SAR)"})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 text-center space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Vested includes:"})," vested, transferred, exercised, due, and past-dated events"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Unvested includes:"})," pending and future-dated events"]})]})]})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ye,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No roadmap data available"})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"Vesting Events Calendar"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Visual timeline of upcoming vesting events"})]}),e.jsx(Us,{events:n,onEventClick:M})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Quick Actions"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("button",{className:"flex items-center space-x-3 p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition group",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 group-hover:bg-blue-200 rounded-lg flex items-center justify-center transition",children:e.jsx(He,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Create New Plan"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Define LTIP/ESOP parameters"})]})]}),e.jsxs("button",{className:"flex items-center space-x-3 p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition group",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 group-hover:bg-green-200 rounded-lg flex items-center justify-center transition",children:e.jsx(Pe,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Import Employees"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Bulk upload via CSV"})]})]}),e.jsxs("button",{className:"flex items-center space-x-3 p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition group",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 group-hover:bg-purple-200 rounded-lg flex items-center justify-center transition",children:e.jsx(Oe,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Issue Grants"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Allocate shares to employees"})]})]})]})]}),D&&o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Vesting Event Details"}),e.jsx("p",{className:"text-gray-600",children:Fe(o.id,o.sequence_number,o.vesting_date,((oe=o.grants)==null?void 0:oe.grant_number)??o.grant_id).displayId})]}),e.jsx("button",{onClick:()=>I(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(Ds,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-3",children:"Event Information"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Employee:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:o.employee_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Event Type:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:o.event_type.replace("_"," ").toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Vesting Date:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:Ee(o.vesting_date)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Status:"}),e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800",children:o.status.toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Days Remaining:"}),e.jsx("span",{className:"text-sm font-medium text-red-600",children:Ue(o.days_remaining)})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-3",children:"Shares & Financial"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Shares to Vest:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:Math.floor(o.shares_to_vest).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Plan:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[o.plan_name," (",o.plan_code,")"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Plan Type:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:o.plan_type})]}),o.exercise_price&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Exercise Price:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["$",o.exercise_price.toFixed(2)," per share"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Exercise Cost:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["$",(o.shares_to_vest*o.exercise_price).toFixed(2)]})]})]})]})]}),o.status==="due"&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-3",children:"Action Required"}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Be,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"This vesting event is due and requires processing"}),e.jsx("p",{className:"text-xs text-red-600 mt-1",children:o.requires_exercise?"Employee needs to exercise options to receive shares":"Shares should be transferred to employee portfolio"})]})]})})]}),o.status!=="due"&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-3",children:"Status Information"}),e.jsx("div",{className:`border rounded-lg p-4 ${o.status==="pending"?"bg-blue-50 border-blue-200":o.status==="vested"?"bg-green-50 border-green-200":(o.status==="exercised"||o.status==="transferred","bg-gray-50 border-gray-200")}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(he,{className:`w-5 h-5 mt-0.5 ${o.status==="pending"?"text-blue-600":o.status==="vested"?"text-green-600":"text-gray-600"}`}),e.jsxs("div",{children:[e.jsxs("p",{className:`text-sm font-medium ${o.status==="pending"?"text-blue-800":o.status==="vested"?"text-green-800":"text-gray-800"}`,children:[o.status==="pending"&&"This vesting event is scheduled for the future",o.status==="vested"&&"This vesting event has been processed and shares are vested",o.status==="exercised"&&"This ESOP event has been exercised by the employee",o.status==="transferred"&&"These shares have been transferred to the employee portfolio",!["pending","vested","exercised","transferred"].includes(o.status)&&"Event status information"]}),e.jsxs("p",{className:`text-xs mt-1 ${o.status==="pending"?"text-blue-600":o.status==="vested"?"text-green-600":"text-gray-600"}`,children:[o.status==="pending"&&`Vesting date: ${Ee(o.vesting_date)}`,o.status==="vested"&&"No further action required",(o.status==="exercised"||o.status==="transferred")&&"Transaction completed"]})]})]})})]})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>I(!1),className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Close"}),o.status==="due"&&e.jsx("button",{onClick:()=>{window.location.href="/dashboard/vesting-events"},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Process in Vesting Events"})]})]})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s("dashboard.title")}),e.jsx("p",{className:"text-gray-600 mt-1",children:s("dashboard.welcome")})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-8 text-center",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx(Be,{className:"w-12 h-12 text-yellow-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Company Data Available"}),e.jsx("p",{className:"text-gray-600",children:"Unable to load company information. Please contact support if this issue persists."})]})})]})}export{Js as default};
