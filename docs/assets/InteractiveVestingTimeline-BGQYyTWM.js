import{j as e}from"./index-CHcuUdej.js";import{r as v}from"./react-vendor-xiFAdxLt.js";import{f as u}from"./numberUtils-CWVJ76A6.js";import{f as p}from"./dateUtils-DoPl8O0G.js";import{q as M,C as Y,s as L,X as U,a as W}from"./ui-vendor-a8g5-7pO.js";function te({grantDate:C,totalShares:r,vestedShares:P,vestingSchedule:R,individualVestingRecords:g}){const[b,J]=v.useState(null),[B,V]=v.useState(null),[H,N]=v.useState(!1),[a,O]=v.useState(null),$=v.useMemo(()=>{const s=[],l=new Date;if(g&&g.length>0){const n=g.filter(t=>{const _=new Date(t.vesting_date),f=t.actual_vest_date?new Date(t.actual_vest_date):null;return!(t.status==="vested"||t.status==="transferred"||t.status==="exercised"||f&&f<=l)&&_<=l&&t.status==="pending"});n.length>2&&(console.log("ðŸ” DEBUG: Multiple due events detected"),console.log("Due records count:",n.length),console.log("Due records details:",n.map(t=>({sequence:t.sequence_number,date:t.vesting_date,shares:t.shares_to_vest,status:t.status,id:t.id,daysPastDue:Math.floor((l.getTime()-new Date(t.vesting_date).getTime())/(1e3*60*60*24))}))),console.log("All records for this grant:",g.map(t=>({sequence:t.sequence_number,date:t.vesting_date,shares:t.shares_to_vest,status:t.status}))));let d=0,y=0;return g.forEach(t=>{const _=new Date(t.vesting_date),f=t.actual_vest_date?new Date(t.actual_vest_date):null,D=t.status==="vested"||t.status==="transferred"||t.status==="exercised"||f&&f<=l,I=!D&&_<=l&&t.status==="pending";d+=Number(t.shares_to_vest);const A=Number(t.shares_to_vest)/r*100;y+=A;const X=t.event_type==="cliff"?"cliff":t.event_type==="time_based"?"time":t.event_type==="performance"?"performance":t.sequence_number===1?"cliff":"time";let h;t.status==="transferred"||t.status==="exercised"||t.status==="cancelled"||t.status==="forfeited"?h=t.status:D?h="vested":I?h="pending":h="upcoming",s.push({event:{date:t.vesting_date,shares:Number(t.shares_to_vest),cumulativeShares:Math.min(d,r),percentage:A,cumulativePercentage:Math.min(y,100),status:h,type:X},record:t})}),s}const i=new Date(C),{cliff_months:o,total_duration_months:T,vesting_frequency:F}=R;let j=1;F==="quarterly"&&(j=3),F==="annually"&&(j=12);const k=Math.ceil((T-o)/j),w=1+Math.max(0,k),G=r/w,m=[];let q=0;for(let n=0;n<w;n++)if(n===w-1)m.push(Math.max(0,r-q));else{const d=Math.floor(G);m.push(d),q+=d}if(o>0){const n=new Date(i);n.setMonth(n.getMonth()+o),s.push({event:{date:n.toISOString(),shares:m[0],cumulativeShares:m[0],percentage:m[0]/r*100,cumulativePercentage:m[0]/r*100,status:n<=l?"vested":"upcoming",type:"cliff"}})}let E=o>0?m[0]:0;for(let n=0;n<k;n++){const d=new Date(i);if(d.setMonth(d.getMonth()+o+(n+1)*j),d.getMonth()>i.getMonth()+T)break;const y=o>0?n+1:n,t=m[y]??0;E+=t,s.push({event:{date:d.toISOString(),shares:t,cumulativeShares:Math.min(E,r),percentage:t/r*100,cumulativePercentage:Math.min(E/r*100,100),status:d<=l?"vested":"upcoming",type:"time"}})}return s},[C,r,R,g]),c=$.map(s=>s.event),S=P/r*100,x=c.find(s=>s.status==="pending")||c.find(s=>s.status==="upcoming"),z=s=>{const l=$[s];O({vestingEvent:l.event,individualRecord:l.record,eventIndex:s}),N(!0)};return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Vesting Progress"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track your share vesting journey"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-3xl font-bold text-blue-600",children:[S.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Vested"})]})]}),e.jsxs("div",{className:"relative pt-2",children:[e.jsx("div",{className:"flex mb-2 items-center justify-between",children:e.jsx("div",{children:e.jsxs("span",{className:"text-xs font-semibold inline-block text-blue-600",children:[u(P)," of ",u(r)," shares"]})})}),e.jsx("div",{className:"overflow-hidden h-4 mb-4 text-xs flex rounded-full bg-gray-200",children:e.jsx("div",{style:{width:`${S}%`},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-gradient-to-r from-blue-500 to-blue-600 transition-all duration-500"})})]}),x&&e.jsx("div",{className:`mt-4 p-4 rounded-lg border ${x.status==="pending"?"bg-yellow-50 border-yellow-200":"bg-blue-50 border-blue-200"}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[x.status==="pending"?e.jsx(M,{className:"w-5 h-5 text-yellow-600 mt-0.5"}):e.jsx(Y,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:x.status==="pending"?"Due Vesting Event":"Next Vesting Event"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[u(x.shares)," shares ",x.status==="pending"?"are due for vesting (scheduled":"vest"," on ",p(x.date),x.status==="pending"&&")"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:(()=>{const s=Math.ceil((new Date(x.date).getTime()-new Date().getTime())/864e5);return x.status==="pending"?s<=0?"Ready for processing":`Due ${Math.abs(s)} days ago`:`${s} days remaining`})()})]})]})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Vesting Timeline"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click events for details"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200"}),e.jsx("div",{className:"space-y-6",children:c.map((s,l)=>{const i=B===l,o=(b==null?void 0:b.date)===s.date;return e.jsxs("div",{className:"relative pl-10 cursor-pointer transition-all",onMouseEnter:()=>V(l),onMouseLeave:()=>V(null),onClick:()=>z(l),children:[e.jsx("div",{className:"absolute left-0 top-1",children:e.jsx("div",{className:`w-8 h-8 rounded-full border-4 border-white flex items-center justify-center transition-all ${s.status==="vested"?"bg-green-500 shadow-lg shadow-green-200":s.status==="transferred"?"bg-purple-500 shadow-lg shadow-purple-200":s.status==="exercised"?"bg-orange-500 shadow-lg shadow-orange-200":s.status==="pending"?"bg-yellow-500 shadow-lg shadow-yellow-200":s.status==="forfeited"||s.status==="cancelled"?"bg-red-500 shadow-lg shadow-red-200":s.type==="cliff"?"bg-orange-500 shadow-lg shadow-orange-200":"bg-gray-300"} ${i||o?"scale-110":""}`,children:s.status==="vested"||s.status==="transferred"||s.status==="exercised"?e.jsx(L,{className:"w-4 h-4 text-white"}):s.status==="pending"?e.jsx(M,{className:"w-4 h-4 text-white"}):s.status==="forfeited"||s.status==="cancelled"?e.jsx(U,{className:"w-4 h-4 text-white"}):s.type==="cliff"?e.jsx(M,{className:"w-4 h-4 text-white"}):e.jsx(W,{className:"w-4 h-4 text-white"})})}),e.jsxs("div",{className:`bg-white border-2 rounded-lg p-4 transition-all cursor-pointer ${i||o?"border-blue-500 shadow-lg transform scale-[1.02]":"border-gray-200 hover:border-blue-300 hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:p(s.date)}),s.type==="cliff"&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-orange-100 text-orange-700 rounded-full",children:"Cliff"}),s.status==="transferred"||s.status==="exercised"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full bg-green-100 text-green-700",children:"Vested"}),e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full ${s.status==="transferred"?"bg-purple-100 text-purple-700":"bg-orange-100 text-orange-700"}`,children:s.status==="transferred"?"Transferred":"Exercised"})]}):e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full ${s.status==="vested"?"bg-green-100 text-green-700":s.status==="pending"?"bg-yellow-100 text-yellow-700":s.status==="forfeited"||s.status==="cancelled"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-600"}`,children:s.status==="vested"?"Vested":s.status==="pending"?"Due":s.status==="forfeited"?"Forfeited":s.status==="cancelled"?"Cancelled":"Upcoming"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[u(s.shares)," shares (",s.percentage.toFixed(1),"%)"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-gray-900",children:u(s.cumulativeShares)}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.cumulativePercentage.toFixed(1),"% total"]})]})]}),(i||o)&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"This Period"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[u(s.shares)," shares"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Cumulative"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[u(s.cumulativeShares)," shares"]})]})]})})]})]},l)})})]})]}),e.jsx("div",{className:"p-6 bg-gray-50 border-t border-gray-200 rounded-b-xl",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Vested"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:c.filter(s=>s.status==="vested"||s.status==="transferred"||s.status==="exercised").length})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx("div",{className:"w-3 h-3 bg-purple-500 rounded-full"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Transferred"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:c.filter(s=>s.status==="transferred").length})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded-full"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Exercised"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:c.filter(s=>s.status==="exercised").length})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Due"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:c.filter(s=>s.status==="pending").length})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Forfeited"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:c.filter(s=>s.status==="forfeited").length})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-600 rounded-full"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Cancelled"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:c.filter(s=>s.status==="cancelled").length})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-300 rounded-full"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Upcoming"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:c.filter(s=>s.status==="upcoming").length})]})]})}),H&&a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Vesting Event Details"}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:p(a.vestingEvent.date)})]}),e.jsx("button",{onClick:()=>N(!1),className:"text-gray-400 hover:text-gray-600 transition",children:e.jsx(U,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Event Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Vesting Date:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:p(a.vestingEvent.date)})]}),a.individualRecord&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sequence Number:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["#",a.individualRecord.sequence_number]})]}),a.individualRecord.actual_vest_date&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Actual Vest Date:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:p(a.individualRecord.actual_vest_date)})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Event Type:"}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${a.vestingEvent.type==="cliff"?"bg-orange-100 text-orange-700":a.vestingEvent.type==="performance"?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"}`,children:a.vestingEvent.type==="cliff"?"Cliff":a.vestingEvent.type==="performance"?"Performance":"Time-Based"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Status:"}),e.jsx("div",{className:"flex items-center gap-2",children:a.vestingEvent.status==="transferred"||a.vestingEvent.status==="exercised"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-700",children:"Vested"}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${a.vestingEvent.status==="transferred"?"bg-purple-100 text-purple-700":"bg-orange-100 text-orange-700"}`,children:a.vestingEvent.status==="transferred"?"Transferred":"Exercised"})]}):e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${a.vestingEvent.status==="vested"?"bg-green-100 text-green-700":a.vestingEvent.status==="pending"?"bg-yellow-100 text-yellow-700":a.vestingEvent.status==="forfeited"||a.vestingEvent.status==="cancelled"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}`,children:a.vestingEvent.status==="vested"?"Vested":a.vestingEvent.status==="pending"?"Due (Not Yet Processed)":a.vestingEvent.status==="forfeited"?"Forfeited":a.vestingEvent.status==="cancelled"?"Cancelled":"Upcoming"})})]})]})]})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Shares Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Shares to Vest:"}),e.jsx("span",{className:"text-sm font-bold text-gray-900",children:Math.floor(a.vestingEvent.shares).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Percentage:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[a.vestingEvent.percentage.toFixed(2),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Cumulative Shares:"}),e.jsx("span",{className:"text-sm font-bold text-gray-900",children:Math.floor(a.vestingEvent.cumulativeShares).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Cumulative %:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[a.vestingEvent.cumulativePercentage.toFixed(2),"%"]})]})]})]})})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Vesting Progress"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Progress up to this event"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[a.vestingEvent.cumulativePercentage.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-blue-600 h-3 rounded-full transition-all",style:{width:`${a.vestingEvent.cumulativePercentage}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"0 shares"}),e.jsxs("span",{children:[r.toLocaleString()," shares"]})]})]})]}),a.individualRecord&&e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Database Record Details"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Record ID:"}),e.jsx("span",{className:"text-sm font-mono text-gray-900",children:a.individualRecord.id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Record Status:"}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${a.individualRecord.status==="vested"||a.individualRecord.status==="transferred"||a.individualRecord.status==="exercised"?"bg-green-100 text-green-700":a.individualRecord.status==="pending"?"bg-yellow-100 text-yellow-700":a.individualRecord.status==="cancelled"||a.individualRecord.status==="forfeited"?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}`,children:a.individualRecord.status})]}),a.individualRecord.performance_condition_met!==void 0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Performance Condition:"}),e.jsx("span",{className:`text-sm font-medium ${a.individualRecord.performance_condition_met?"text-green-600":"text-red-600"}`,children:a.individualRecord.performance_condition_met?"Met":"Not Met"})]})]})]}),e.jsx("div",{className:"border-t border-gray-200 pt-6",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:(()=>{const s=new Date(a.vestingEvent.date),l=new Date,i=Math.ceil((s.getTime()-l.getTime())/(1e3*60*60*24));return i<0?`Vested ${Math.abs(i)} days ago`:i===0?"Vests today":`${i} days until vesting`})()}),e.jsx("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${a.vestingEvent.status==="vested"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:a.vestingEvent.status==="vested"?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 mr-1"}),"Completed"]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4 mr-1"}),"Pending"]})})]})})})]}),e.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50 flex justify-end",children:e.jsx("button",{onClick:()=>N(!1),className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition",children:"Close"})})]})})]})}export{te as I};
