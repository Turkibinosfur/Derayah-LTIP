import{a as _e,j as e,s as f,u as Cs,b as Ts}from"./index-CHcuUdej.js";import{r as n}from"./react-vendor-xiFAdxLt.js";import{u as cs,g as ks,a as $s}from"./vestingEventsService-BxvgAzhC.js";import{f as Pe,a as Re,b as Ve}from"./dateUtils-DoPl8O0G.js";import{n as Ms,c as we,D as Xe,U as Le,P as Ze,o as Ue,p as He,F as Ae,C as Rs,q as De,a as We,b as qe,r as fe,s as ns,t as Vs,u as As,v as qs,I as ge,X as Ds}from"./ui-vendor-a8g5-7pO.js";import{V as Us}from"./VestingEventsCalendar-BmRKjrzq.js";import"./supabase-vendor-B-LuImWU.js";const rs=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4","#84cc16"];function Hs(){const{t:s,i18n:U}=_e();U.language;const[p,N]=n.useState(!0),[r,V]=n.useState([]),[S,O]=n.useState({}),[o,A]=n.useState({}),[y,w]=n.useState({}),[m,v]=n.useState(!0),[_,M]=n.useState(!0),[d,l]=n.useState(!0),[T,I]=n.useState(null),[F,P]=n.useState(null),[i,ie]=n.useState(null),c=n.useRef(null),[de,J]=n.useState(null),[ne,H]=n.useState(null),[E,C]=n.useState(null),B=n.useRef(null),[L,q]=n.useState(null),[Y,R]=n.useState(null),[ee,he]=n.useState(null),ce=n.useRef(null);n.useEffect(()=>{(async()=>{try{const{data:{user:h}}=await f.auth.getUser();if(!h)return;const{data:b}=await f.from("company_users").select("company_id").eq("user_id",h.id).maybeSingle();if(!b)return;const $=b.company_id,[{data:se},{data:te}]=await Promise.all([f.from("ltip_pools").select("id, pool_name_en, total_shares_allocated, shares_used, shares_available").eq("company_id",$).order("created_at",{ascending:!1}),f.from("grants").select("id, total_shares, incentive_plans(id, ltip_pool_id)").eq("company_id",$)]);V(se||[]);const Q={},Z={};if((te||[]).forEach(g=>{var ae;const K=(ae=g==null?void 0:g.incentive_plans)==null?void 0:ae.ltip_pool_id;if(!K)return;const re=Number(g.total_shares||0);Q[K]=(Q[K]||0)+re,Z[g.id]=K}),O(Q),Object.keys(Z).length){const{data:g}=await f.from("vesting_events").select("grant_id, shares_to_vest, status").in("grant_id",Object.keys(Z)),K={},re={},ae=["vested","transferred","exercised","due"];(g||[]).forEach(oe=>{const le=Z[oe.grant_id];if(!le)return;const ue=Math.floor(Number(oe.shares_to_vest||0));ae.includes(oe.status)?K[le]=(K[le]||0)+ue:re[le]=(re[le]||0)+ue}),A(K),w(re)}else A({}),w({})}finally{N(!1)}})()},[]);const X=n.useMemo(()=>r.reduce((u,h)=>u+h.total_shares_allocated,0),[r]),W=n.useMemo(()=>r.reduce((u,h)=>u+h.shares_used,0),[r]),xe=n.useMemo(()=>r.reduce((u,h)=>u+h.shares_available,0),[r]),me=n.useMemo(()=>Object.values(S).reduce((u,h)=>u+h,0),[S]),a=n.useMemo(()=>Object.values(o).reduce((u,h)=>u+h,0),[o]),x=n.useMemo(()=>Object.values(y).reduce((u,h)=>u+h,0),[y]),k=n.useMemo(()=>r.reduce((h,b)=>h+b.total_shares_allocated,0)?r.filter(h=>h.total_shares_allocated>0).map((h,b)=>({label:h.pool_name_en,value:h.total_shares_allocated,color:rs[b%rs.length]})):[],[r]),G=n.useMemo(()=>{const u=[];return W>0&&u.push({label:s("dashboard.usedLabel"),value:W,color:"#10b981"}),xe>0&&u.push({label:s("dashboard.available"),value:xe,color:"#f59e0b"}),u},[W,xe,s]),D=n.useMemo(()=>{const u=Math.max(W-me,0),h=Math.max(me-(a+x),0),b=[];return a>0&&b.push({label:s("dashboard.vested"),value:a,color:"#22c55e"}),x>0&&b.push({label:s("dashboard.unvested"),value:x,color:"#ec4899"}),h>0&&b.push({label:s("dashboard.grantedNoVestingEvents"),value:h,color:"#f97316"}),u>0&&b.push({label:s("dashboard.allocatedNotGranted"),value:u,color:"#6366f1"}),b},[W,me,a,x,s]);return p?e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})})}):e.jsxs("section",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:s("dashboard.ltipPoolsSnapshot")}),e.jsx("p",{className:"text-gray-600 text-sm",children:s("dashboard.ltipPoolsSnapshotDesc")})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx($e,{icon:e.jsx(Ms,{className:"w-6 h-6 text-blue-600"}),title:s("dashboard.totalPools"),value:r.length.toString(),iconBg:"bg-blue-100"}),e.jsx($e,{icon:e.jsx(we,{className:"w-6 h-6 text-green-600"}),title:s("dashboard.totalAllocated"),value:X.toLocaleString(),iconBg:"bg-green-100"}),e.jsx($e,{icon:e.jsx(Xe,{className:"w-6 h-6 text-yellow-600"}),title:s("dashboard.sharesUsedLabel"),value:W.toLocaleString(),iconBg:"bg-yellow-100"}),e.jsx($e,{icon:e.jsx(Le,{className:"w-6 h-6 text-purple-600"}),title:s("dashboard.available"),value:xe.toLocaleString(),iconBg:"bg-purple-100"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(Ye,{title:s("dashboard.sharesByPool"),iconColor:"text-blue-600",expanded:m,onToggle:()=>v(u=>!u),slices:k,totalLabel:s("dashboard.shares"),totalValue:X.toLocaleString(),highlightKey:T,lockedKey:F,hoveredSlice:i,onHoverSlice:ie,onHighlightChange:I,onLockChange:P,chartRef:c}),e.jsx(Ye,{title:s("dashboard.sharesByStatus"),iconColor:"text-green-600",expanded:_,onToggle:()=>M(u=>!u),slices:G,totalLabel:s("dashboard.shares"),totalValue:(W+xe).toLocaleString(),highlightKey:de,lockedKey:ne,hoveredSlice:E,onHoverSlice:C,onHighlightChange:J,onLockChange:H,chartRef:B}),e.jsx(Ye,{title:s("dashboard.usedSharesBreakdown"),iconColor:"text-indigo-600",expanded:d,onToggle:()=>l(u=>!u),slices:D,totalLabel:`${s("dashboard.shares")} (${s("dashboard.usedLabel")})`,totalValue:W.toLocaleString(),highlightKey:L,lockedKey:Y,hoveredSlice:ee,onHoverSlice:he,onHighlightChange:q,onLockChange:R,chartRef:ce})]})]})}function $e({icon:s,iconBg:U,title:p,value:N}){return e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${U}`,children:s}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:N})]}),e.jsx("p",{className:"text-gray-600 font-medium text-sm",children:p})]})}function Ye(s){const{t:U}=_e(),{title:p,iconColor:N,slices:r,totalLabel:V,totalValue:S,expanded:O,onToggle:o,highlightKey:A,lockedKey:y,hoveredSlice:w,onHoverSlice:m,onHighlightChange:v,onLockChange:_,chartRef:M}=s,d=r.reduce((l,T)=>l+T.value,0);return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("button",{onClick:o,className:"w-full p-4 border-b border-gray-200 flex items-center justify-between hover:bg-gray-50 transition",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ze,{className:`w-5 h-5 ${N}`}),e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:p})]}),O?e.jsx(Ue,{className:"w-5 h-5 text-gray-500"}):e.jsx(He,{className:"w-5 h-5 text-gray-500"})]}),e.jsx("div",{className:"p-4",children:d===0?e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:U("common.noData")}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{ref:M,className:"relative w-full h-40 flex items-center justify-center",onClick:l=>{(l.target===l.currentTarget||l.target.tagName==="svg")&&(_(null),v(null),m(null))},children:[e.jsxs("svg",{viewBox:"0 0 120 120",className:"w-full max-w-40 h-40 cursor-pointer",onMouseLeave:()=>{m(null),y||v(null)},children:[r.map(l=>{const T=r.slice(0,r.indexOf(l)).reduce((L,q)=>L+q.value/d*360,0),I=l.value/d*360,F=T+I,P=(T-90)*(Math.PI/180),i=(F-90)*(Math.PI/180),ie=60+50*Math.cos(P),c=60+50*Math.sin(P),de=60+50*Math.cos(i),J=60+50*Math.sin(i),ne=I>180?1:0,H=y===l.label,E=A===l.label,C=y?!H:A!==null&&!E,B=l.value/d*100;return e.jsx("path",{d:`M 60 60 L ${ie} ${c} A 50 50 0 ${ne} 1 ${de} ${J} Z`,fill:l.color,stroke:"white",strokeWidth:H||E?3:2,style:{opacity:H?1:C?.3:E?1:.85,filter:H||E?"brightness(1.2)":y?"brightness(0.5)":"none",transition:"none"},onMouseEnter:L=>{if(M.current){const q=M.current.getBoundingClientRect(),Y=L.clientX-q.left,R=L.clientY-q.top;y||v(l.label),m({label:l.label,value:l.value,percentage:B,x:Y,y:R})}},onMouseLeave:()=>{m(null),y||v(null)},onClick:L=>{if(L.stopPropagation(),M.current){const Y=M.current.getBoundingClientRect();m({label:l.label,value:l.value,percentage:B,x:Y.width/2,y:Y.height/2})}const q=y===l.label?null:l.label;_(q),v(q)}},l.label)}),e.jsx("circle",{cx:"60",cy:"60",r:"30",fill:"white"}),e.jsx("text",{x:"60",y:"56",textAnchor:"middle",className:"font-bold",fill:"#111827",fontSize:"12",children:S}),e.jsx("text",{x:"60",y:"70",textAnchor:"middle",fill:"#6b7280",fontSize:"9",children:V})]}),w&&e.jsxs("div",{className:"absolute z-10 bg-gray-900 text-white text-xs rounded-lg px-3 py-2 shadow-lg pointer-events-none whitespace-nowrap",style:{left:`${w.x}px`,top:`${w.y-30}px`,transform:"translateX(-50%)"},children:[e.jsx("div",{className:"font-semibold",children:w.label}),e.jsxs("div",{className:"text-gray-300",children:[w.value.toLocaleString()," (",w.percentage.toFixed(1),"%)"]})]})]}),O&&e.jsx("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:r.map(l=>{const T=d>0?l.value/d*100:0,I=y===l.label,F=A===l.label;return e.jsxs("div",{className:`flex items-center gap-2 text-xs p-1 rounded cursor-pointer transition-colors ${I||F?"bg-blue-50":"hover:bg-gray-50"}`,onMouseEnter:()=>{if(M.current){const P=M.current.getBoundingClientRect();m({label:l.label,value:l.value,percentage:T,x:P.width/2,y:P.height/2}),y||v(l.label)}},onMouseLeave:()=>{m(null),y||v(null)},onClick:()=>{const P=y===l.label?null:l.label;_(P),v(P)},children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:l.color}}),e.jsx("span",{className:"flex-1 truncate",children:l.label}),e.jsxs("span",{className:"font-medium",children:[l.value.toLocaleString()," (",T.toFixed(1),"%)"]})]},l.label)})})]})})]})}const os=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4","#84cc16"];function Fs(){const{t:s,i18n:U}=_e(),p=U.language==="ar",[N,r]=n.useState(!0),[V,S]=n.useState([]),[O,o]=n.useState({total:0,allocated:0,available:0}),[A,y]=n.useState({}),[w,m]=n.useState(!0),[v,_]=n.useState(!0),[M,d]=n.useState(null),[l,T]=n.useState(null),[I,F]=n.useState(null),P=n.useRef(null),[i,ie]=n.useState(null),[c,de]=n.useState(null),[J,ne]=n.useState(null),H=n.useRef(null);n.useEffect(()=>{(async()=>{try{const{data:{user:ee}}=await f.auth.getUser();if(!ee)return;const{data:he}=await f.from("company_users").select("company_id").eq("user_id",ee.id).maybeSingle();if(!he)return;const ce=he.company_id,[{data:X},{data:W},{data:xe}]=await Promise.all([f.from("incentive_plans").select("id, plan_name_en, status, total_shares_allocated").eq("company_id",ce),f.from("ltip_pools").select("total_shares_allocated, shares_used, shares_available").eq("company_id",ce),f.from("grants").select("plan_id, total_shares").eq("company_id",ce)]);S(X||[]);const me=(W||[]).reduce((x,k)=>(x.total+=Number(k.total_shares_allocated||0),x.allocated+=Number(k.shares_used||0),x.available+=Number(k.shares_available||0),x),{total:0,allocated:0,available:0});o(me);const a={};(xe||[]).forEach(x=>{const k=x.plan_id;k&&(a[k]=(a[k]||0)+Number(x.total_shares||0))}),y(a)}finally{r(!1)}})()},[]);const E=n.useMemo(()=>V.reduce((R,ee)=>R+Number(ee.total_shares_allocated||0),0),[V]),C=n.useMemo(()=>Object.values(A).reduce((R,ee)=>R+ee,0),[A]),B=Math.max(E-C,0),L=n.useMemo(()=>O.total?[{label:s("incentivePlans.plannedShares"),value:E,color:"#3b82f6"},{label:s("incentivePlans.unplannedShares"),value:Math.max(O.total-E,0),color:"#94a3b8"}].filter(R=>R.value>0):[],[O.total,E,s]),q=n.useMemo(()=>E?V.filter(R=>R.total_shares_allocated>0).map((R,ee)=>({label:R.plan_name_en,value:R.total_shares_allocated,color:os[ee%os.length]})):[],[V,E]);if(N)return e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})})});const Y=V.filter(R=>R.status==="active").length;return e.jsxs("section",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:s("incentivePlans.title")}),e.jsx("p",{className:"text-gray-600 text-sm",children:s("incentivePlans.description")})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(Ae,{className:"w-6 h-6 text-blue-600"})}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(we,{className:"w-6 h-6 text-green-600"})})]}),e.jsxs("div",{className:p?"text-left":"text-right",children:[e.jsx("div",{className:"text-xs text-gray-500",children:s("incentivePlans.totalPlans")}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:V.length})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:s("incentivePlans.active")}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[Y," / ",V.length]})]}),e.jsx(Os,{percentage:V.length?Y/V.length*100:0,t:s})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-3 bg-slate-100 rounded-lg",children:e.jsx(Le,{className:"w-6 h-6 text-slate-600"})}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:O.total.toLocaleString()})]}),e.jsx("p",{className:"text-gray-600 font-medium mb-2",children:s("incentivePlans.ltipPool")}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx(Me,{label:s("incentivePlans.plannedShares"),value:E}),e.jsx(Me,{label:s("incentivePlans.granted"),value:C,indent:!0}),e.jsx(Me,{label:s("incentivePlans.ungranted"),value:B,indent:!0}),e.jsx(Me,{label:s("incentivePlans.availableToPlan"),value:O.available,highlight:!0})]})]}),e.jsx(is,{title:s("incentivePlans.ltipPoolVsPlanned"),iconColor:"text-cyan-600",totalLabel:s("incentivePlans.totalPool"),totalValue:O.total.toLocaleString(),slices:L,expanded:w,onToggle:()=>m(R=>!R),chartRef:P,hoveredSlice:I,onHoverSlice:F,highlightKey:M,onHighlightChange:d,lockedKey:l,onLockChange:T}),e.jsx(is,{title:s("incentivePlans.plannedSharesByPlan"),iconColor:"text-purple-600",totalLabel:s("dashboard.shares"),totalValue:E.toLocaleString(),slices:q,expanded:v,onToggle:()=>_(R=>!R),chartRef:H,hoveredSlice:J,onHoverSlice:ne,highlightKey:i,onHighlightChange:ie,lockedKey:c,onLockChange:de})]})]})}function Me({label:s,value:U,indent:p=!1,highlight:N=!1}){return e.jsxs("div",{className:`flex justify-between ${p?"pl-4":""}`,children:[e.jsxs("span",{className:`text-xs ${N?"text-green-600 font-semibold":"text-gray-500"}`,children:[s,":"]}),e.jsx("span",{className:`text-xs ${N?"text-green-600 font-semibold":"text-gray-900 font-medium"}`,children:U.toLocaleString()})]})}function Os({percentage:s,t:U}){const p=Math.round(s);return e.jsxs("div",{children:[e.jsx("div",{className:"w-full h-2 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-2 bg-green-500 rounded-full transition-all",style:{width:`${Math.min(Math.max(p,0),100)}%`}})}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:[p,"% ",U("incentivePlans.activePercent")]})]})}function is(s){const{t:U}=_e(),{title:p,iconColor:N,totalLabel:r,totalValue:V,slices:S,expanded:O,onToggle:o,chartRef:A,hoveredSlice:y,onHoverSlice:w,highlightKey:m,onHighlightChange:v,lockedKey:_,onLockChange:M}=s,d=S.reduce((l,T)=>l+T.value,0);return e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("button",{className:"w-full flex items-center justify-between mb-4",onClick:o,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:`w-5 h-5 ${N}`}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:p})]}),O?e.jsx(Ue,{className:"w-5 h-5 text-gray-500"}):e.jsx(He,{className:"w-5 h-5 text-gray-500"})]}),d===0?e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:U("common.noData")}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:A,className:"relative w-full h-40 flex items-center justify-center",onClick:l=>{(l.target===l.currentTarget||l.target.tagName==="svg")&&(M(null),v(null),w(null))},children:[e.jsxs("svg",{viewBox:"0 0 120 120",className:"w-full max-w-40 h-40 cursor-pointer",onMouseLeave:()=>{w(null),_||v(null)},children:[S.map(l=>{const T=S.slice(0,S.indexOf(l)).reduce((L,q)=>L+q.value/d*360,0),I=l.value/d*360,F=T+I,P=(T-90)*(Math.PI/180),i=(F-90)*(Math.PI/180),ie=60+50*Math.cos(P),c=60+50*Math.sin(P),de=60+50*Math.cos(i),J=60+50*Math.sin(i),ne=I>180?1:0,H=l.value/d*100,E=_===l.label,C=m===l.label,B=_?!E:m!==null&&!C;return e.jsx("path",{d:`M 60 60 L ${ie} ${c} A 50 50 0 ${ne} 1 ${de} ${J} Z`,fill:l.color,stroke:"white",strokeWidth:E||C?3:2,style:{opacity:E?1:B?.3:C?1:.85,filter:E||C?"brightness(1.2)":_?"brightness(0.5)":"none",transition:"none"},onMouseEnter:L=>{if(A.current){const q=A.current.getBoundingClientRect(),Y=L.clientX-q.left,R=L.clientY-q.top;_||v(l.label),w({label:l.label,value:l.value,percentage:H,x:Y,y:R})}},onMouseLeave:()=>{w(null),_||v(null)},onClick:L=>{L.stopPropagation();const q=_===l.label?null:l.label;M(q),v(q)}},l.label)}),e.jsx("circle",{cx:"60",cy:"60",r:"30",fill:"white"}),e.jsx("text",{x:"60",y:"56",textAnchor:"middle",className:"font-bold",fill:"#111827",fontSize:"12",children:V}),e.jsx("text",{x:"60",y:"70",textAnchor:"middle",fill:"#6b7280",fontSize:"9",children:r})]}),y&&e.jsxs("div",{className:"absolute z-10 bg-gray-900 text-white text-xs rounded-lg px-3 py-2 shadow-lg pointer-events-none whitespace-nowrap",style:{left:`${y.x}px`,top:`${y.y-30}px`,transform:"translateX(-50%)"},children:[e.jsx("div",{className:"font-semibold",children:y.label}),e.jsxs("div",{className:"text-gray-300",children:[y.value.toLocaleString()," (",y.percentage.toFixed(1),"%)"]})]})]}),O&&e.jsx("div",{className:"space-y-1 max-h-40 overflow-y-auto mt-3",children:S.map(l=>{const T=d>0?l.value/d*100:0,I=_===l.label,F=m===l.label;return e.jsxs("div",{className:`flex items-center gap-2 text-xs p-1 rounded cursor-pointer transition-colors ${I||F?"bg-blue-50":"hover:bg-gray-50"}`,onMouseEnter:()=>{if(A.current){const P=A.current.getBoundingClientRect();w({label:l.label,value:l.value,percentage:T,x:P.width/2,y:P.height/2}),_||v(l.label)}},onMouseLeave:()=>{w(null),_||v(null)},onClick:()=>{const P=_===l.label?null:l.label;M(P),v(P)},children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:l.color}}),e.jsx("span",{className:"flex-1 truncate",title:l.label,children:l.label}),e.jsxs("span",{className:"font-medium",children:[l.value.toLocaleString()," (",T.toFixed(1),"%)"]})]},l.label)})})]})]})}const ye={"Due Now":"#ef4444",Pending:"#f59e0b",Transferred:"#10b981",Exercised:"#8b5cf6",Vested:"#06b6d4","Forfeited/Cancelled":"#6b7280"},je={"Due Now":"#ef4444",Pending:"#f59e0b",Transferred:"#10b981",Exercised:"#8b5cf6",Vested:"#06b6d4","Forfeited/Cancelled":"#6b7280"};function Bs(){const{t:s,i18n:U}=_e();U.language;const[p,N]=n.useState(!0),[r,V]=n.useState(null),[S,O]=n.useState([]),[o,A]=n.useState(!0),[y,w]=n.useState(!0),[m,v]=n.useState(!0),[_,M]=n.useState(null),[d,l]=n.useState(null),[T,I]=n.useState(null),F=n.useRef(null),[P,i]=n.useState(null),[ie,c]=n.useState(null),[de,J]=n.useState(null),ne=n.useRef(null);n.useEffect(()=>{(async()=>{try{const{data:{user:B}}=await f.auth.getUser();if(!B)return;const{data:L}=await f.from("company_users").select("company_id").eq("user_id",B.id).maybeSingle();if(!L)return;const q=L.company_id;await cs();const Y=await ks(q);Y.success&&Y.data&&V(Y.data);const R=new Date().toISOString().split("T")[0],{data:ee}=await f.from("vesting_events").select(`
            *,
            employees(first_name_en, last_name_en),
            grants(plan_id, grant_number, incentive_plans(plan_name_en, plan_code, plan_type))
          `).eq("company_id",q).eq("status","due").lte("vesting_date",R).order("vesting_date",{ascending:!0}).limit(5),he=(ee||[]).map(ce=>{var x;const X=(x=ce.grants)==null?void 0:x.incentive_plans,W=ce.employees,xe=new Date(ce.vesting_date),me=new Date,a=Math.ceil((xe.getTime()-me.getTime())/(1e3*60*60*24));return{...ce,employee_name:`${(W==null?void 0:W.first_name_en)||""} ${(W==null?void 0:W.last_name_en)||""}`.trim()||"Employee",plan_name:(X==null?void 0:X.plan_name_en)||"Unknown Plan",plan_code:(X==null?void 0:X.plan_code)||"N/A",plan_type:(X==null?void 0:X.plan_type)||"LTIP_RSU",days_remaining:a,requires_exercise:(X==null?void 0:X.plan_type)==="ESOP"}});O(he)}finally{N(!1)}})()},[]);const H=n.useMemo(()=>r?[{label:s("vestingEvents.dueNow"),value:r.due_events,color:ye["Due Now"]},{label:s("vestingEvents.pending"),value:r.pending_events,color:ye.Pending},{label:s("vestingEvents.transferred"),value:r.transferred_events,color:ye.Transferred},{label:s("vestingEvents.exercised"),value:r.exercised_events,color:ye.Exercised},{label:s("vestingEvents.vested"),value:r.vested_events,color:ye.Vested},{label:s("vestingEvents.forfeitedCancelled"),value:r.forfeited_events+r.cancelled_events,color:ye["Forfeited/Cancelled"]}].filter(C=>C.value>0):[],[r,s]),E=n.useMemo(()=>r?[{label:s("vestingEvents.dueNow"),value:r.total_due_shares,color:je["Due Now"]},{label:s("vestingEvents.pending"),value:r.total_pending_shares,color:je.Pending},{label:s("vestingEvents.transferred"),value:r.total_transferred_shares,color:je.Transferred},{label:s("vestingEvents.exercised"),value:r.total_exercised_shares,color:je.Exercised},{label:s("vestingEvents.vested"),value:r.total_vested_shares,color:je.Vested},{label:s("vestingEvents.forfeitedCancelled"),value:r.total_forfeited_shares+r.total_cancelled_shares,color:je["Forfeited/Cancelled"]}].filter(C=>C.value>0):[],[r,s]);return p||!r?e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})})}):e.jsxs("section",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:s("vestingEvents.title")}),e.jsx("p",{className:"text-gray-600 text-sm",children:s("vestingEvents.description")})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(Ne,{icon:e.jsx(Rs,{className:"w-5 h-5 text-blue-600"}),title:s("vestingEvents.totalEvents"),primary:`${r.total_events}`,secondary:`${r.total_total_shares.toLocaleString()} ${s("dashboard.shares")}`}),e.jsx(Ne,{icon:e.jsx(De,{className:"w-5 h-5 text-red-600"}),title:s("vestingEvents.dueNow"),primary:r.due_events.toString(),secondary:`${r.total_due_shares.toLocaleString()} ${s("dashboard.shares")}`,highlight:!0}),e.jsx(Ne,{icon:e.jsx(We,{className:"w-5 h-5 text-amber-600"}),title:s("vestingEvents.pending"),primary:r.pending_events.toString(),secondary:`${r.total_pending_shares.toLocaleString()} ${s("dashboard.shares")}`}),e.jsx(Ne,{icon:e.jsx(we,{className:"w-5 h-5 text-indigo-600"}),title:s("vestingEvents.vested"),primary:r.vested_events.toString(),secondary:`${r.total_vested_shares.toLocaleString()} ${s("dashboard.shares")}`}),e.jsx(Ne,{icon:e.jsx(qe,{className:"w-5 h-5 text-purple-600"}),title:s("vestingEvents.exercised"),primary:r.exercised_events.toString(),secondary:`${r.total_exercised_shares.toLocaleString()} ${s("dashboard.shares")}`}),e.jsx(Ne,{icon:e.jsx(we,{className:"w-5 h-5 text-green-600"}),title:s("vestingEvents.transferred"),primary:r.transferred_events.toString(),secondary:`${r.total_transferred_shares.toLocaleString()} ${s("dashboard.shares")}`})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(ds,{title:s("vestingEvents.eventsByStatus"),iconColor:"text-blue-600",slices:H,totalValue:`${r.total_events.toLocaleString()}`,totalLabel:s("vestingEvents.events"),expanded:o,onToggle:()=>A(C=>!C),chartRef:F,hoveredSlice:T,onHoverSlice:I,highlightKey:_,onHighlightChange:M,lockedKey:d,onLockChange:l}),e.jsx(ds,{title:s("vestingEvents.sharesByStatus"),iconColor:"text-green-600",slices:E,totalValue:`${r.total_total_shares.toLocaleString()}`,totalLabel:s("dashboard.shares"),expanded:y,onToggle:()=>w(C=>!C),chartRef:ne,hoveredSlice:de,onHoverSlice:J,highlightKey:P,onHighlightChange:i,lockedKey:ie,onLockChange:c}),e.jsx(Is,{events:S,expanded:m,onToggle:()=>v(C=>!C),t:s})]})]})}function Ne({icon:s,title:U,primary:p,secondary:N,highlight:r}){return e.jsxs("div",{className:`bg-white rounded-xl p-5 border ${r?"border-red-300 shadow-sm":"border-gray-200"} hover:shadow-lg transition`,children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("div",{className:`p-2 rounded-lg ${r?"bg-red-100":"bg-blue-100"}`,children:s})}),e.jsx("p",{className:"text-sm text-gray-600 font-medium mb-1",children:U}),e.jsx("div",{className:`text-3xl font-bold ${r?"text-red-600":"text-gray-900"}`,children:p}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:N})]})}function ds(s){const{title:U,iconColor:p,slices:N,totalValue:r,totalLabel:V,expanded:S,onToggle:O,chartRef:o,hoveredSlice:A,onHoverSlice:y,highlightKey:w,onHighlightChange:m,lockedKey:v,onLockChange:_}=s,M=N.reduce((d,l)=>d+l.value,0);return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("button",{className:"w-full p-4 border-b border-gray-200 flex items-center justify-between hover:bg-gray-50 transition",onClick:O,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:`w-5 h-5 ${p}`}),e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:U})]}),S?e.jsx(Ue,{className:"w-5 h-5 text-gray-500"}):e.jsx(He,{className:"w-5 h-5 text-gray-500"})]}),e.jsx("div",{className:"p-4",children:M===0?e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:t("vestingEvents.noEventsAvailable")}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{ref:o,className:"relative w-full h-40 flex items-center justify-center",onClick:d=>{(d.target===d.currentTarget||d.target.tagName==="svg")&&(_(null),m(null),y(null))},children:[e.jsxs("svg",{viewBox:"0 0 120 120",className:"w-full max-w-40 h-40 cursor-pointer",onMouseLeave:()=>{y(null),v||m(null)},children:[N.map(d=>{const l=N.slice(0,N.indexOf(d)).reduce((B,L)=>B+L.value/M*360,0),T=d.value/M*360,I=l+T,F=(l-90)*(Math.PI/180),P=(I-90)*(Math.PI/180),i=60+50*Math.cos(F),ie=60+50*Math.sin(F),c=60+50*Math.cos(P),de=60+50*Math.sin(P),J=T>180?1:0,ne=d.value/M*100,H=v===d.label,E=w===d.label,C=v?!H:w!==null&&!E;return e.jsx("path",{d:`M 60 60 L ${i} ${ie} A 50 50 0 ${J} 1 ${c} ${de} Z`,fill:d.color,stroke:"white",strokeWidth:H||E?3:2,style:{opacity:H?1:C?.3:E?1:.85,filter:H||E?"brightness(1.2)":v?"brightness(0.5)":"none",transition:"none"},onMouseEnter:B=>{if(o.current){const L=o.current.getBoundingClientRect(),q=B.clientX-L.left,Y=B.clientY-L.top;v||m(d.label),y({label:d.label,value:d.value,percentage:ne,x:q,y:Y})}},onMouseLeave:()=>{y(null),v||m(null)},onClick:B=>{B.stopPropagation();const L=v===d.label?null:d.label;_(L),m(L)}},d.label)}),e.jsx("circle",{cx:"60",cy:"60",r:"30",fill:"white"}),e.jsx("text",{x:"60",y:"56",textAnchor:"middle",className:"font-bold",fill:"#111827",fontSize:"12",children:r}),e.jsx("text",{x:"60",y:"70",textAnchor:"middle",fill:"#6b7280",fontSize:"9",children:V})]}),A&&e.jsxs("div",{className:"absolute z-10 bg-gray-900 text-white text-xs rounded-lg px-3 py-2 shadow-lg pointer-events-none whitespace-nowrap",style:{left:`${A.x}px`,top:`${A.y-30}px`,transform:"translateX(-50%)"},children:[e.jsx("div",{className:"font-semibold",children:A.label}),e.jsxs("div",{className:"text-gray-300",children:[A.value.toLocaleString()," (",A.percentage.toFixed(1),"%)"]})]})]}),S&&e.jsx("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:N.map(d=>{const l=M>0?d.value/M*100:0,T=v===d.label,I=w===d.label;return e.jsxs("div",{className:`flex items-center gap-2 text-xs p-1 rounded cursor-pointer transition-colors ${T||I?"bg-blue-50":"hover:bg-gray-50"}`,onMouseEnter:()=>{if(o.current){const F=o.current.getBoundingClientRect();y({label:d.label,value:d.value,percentage:l,x:F.width/2,y:F.height/2}),v||m(d.label)}},onMouseLeave:()=>{y(null),v||m(null)},onClick:()=>{const F=v===d.label?null:d.label;_(F),m(F)},children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:d.color}}),e.jsx("span",{className:"flex-1 truncate",children:d.label}),e.jsxs("span",{className:"font-medium",children:[d.value.toLocaleString()," (",l.toFixed(1),"%)"]})]},d.label)})})]})})]})}function Is({events:s,expanded:U,onToggle:p,t:N}){var V;const r=((V=N.i18n)==null?void 0:V.language)==="ar";return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("button",{onClick:p,className:"w-full p-4 border-b border-gray-200 flex items-center justify-between hover:bg-gray-50 transition",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:N("vestingEvents.dueEvents")}),s.length>0&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800",children:s.length})]}),U?e.jsx(Ue,{className:"w-5 h-5 text-gray-500"}):e.jsx(He,{className:"w-5 h-5 text-gray-500"})]}),e.jsx("div",{className:"p-4",children:s.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:N("vestingEvents.noDueEvents")}):e.jsxs("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:[(U?s:s.slice(0,3)).map(S=>{var O;return e.jsx("div",{className:`p-3 border-l-4 border-red-500 bg-red-50 rounded-r-lg ${r?"border-r-4 border-l-0 rounded-l-lg rounded-r-none":""}`,children:e.jsxs("div",{className:`flex items-start justify-between ${r?"flex-row-reverse":""}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 mb-1",children:S.employee_name}),e.jsxs("div",{className:"text-xs text-gray-600",children:[Math.floor(S.shares_to_vest).toLocaleString()," ",N("dashboard.shares")," â€¢ ",S.plan_name]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[Pe(S.vesting_date)," â€¢ ",Re(S.days_remaining)]})]}),e.jsx("div",{className:"text-xs font-mono bg-white border border-red-200 text-red-600 px-2 py-1 rounded",children:Ve(S.id,S.sequence_number,S.vesting_date,((O=S.grants)==null?void 0:O.grant_number)??S.grant_id).displayId})]})},S.id)}),!U&&s.length>3&&e.jsx("div",{className:"text-center",children:e.jsxs("button",{onClick:p,className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:[N("vestingEvents.showAllDueEvents")," â†’"]})})]})})]})}function Js(){var X,W,xe,me;const{t:s,i18n:U}=_e(),p=U.language==="ar",{getCurrentCompanyId:N,userRole:r,isSuperAdmin:V}=Cs(),{brandColor:S,getBgColor:O}=Ts(),[o,A]=n.useState({totalEmployees:0,activePlans:0,activeGrants:0,totalShares:0,currentFMV:0,optionPoolBalance:0,totalGrants:0,grantsAccepted:0,grantsPending:0,grantsRejected:0,activeESOPEmployees:0,inactiveESOPEmployees:0,equityPoolSize:0,esopTotalAllocated:0,esopTotalShares:0,ltipTotalAllocated:0,ltipTotalShares:0}),[y,w]=n.useState(!0),[m,v]=n.useState(null),[_,M]=n.useState([]),[d,l]=n.useState([]),[T,I]=n.useState([]),[F,P]=n.useState(!1),[i,ie]=n.useState(null),[c,de]=n.useState({granted:0,ungranted:0,vested:0,unvested:0}),[J,ne]=n.useState([]),H=N(),E=n.useRef(!1),C=n.useRef(null),B=n.useCallback(async()=>{var a,x,k,G,D,u,h,b,$,se,te,Q,Z;if(E.current){console.log("â¸ï¸ Dashboard data already loading, skipping...");return}try{E.current=!0;const g=N();if(g===C.current&&m){console.log("â¸ï¸ Data already loaded for this company, skipping...");return}if(V()&&!g){console.log("Super admin - no company selected"),w(!1),v(null);return}if(!g){console.log("No company ID available"),w(!1);return}console.log("Loading dashboard for company ID:",g),C.current=g;const{data:K,error:re}=await f.from("companies").select("*").eq("id",g).maybeSingle();if(re){console.error("Error fetching company:",re),w(!1);return}if(K){v({company_id:g,companies:K}),console.log("Company ID:",g),Promise.all([L(g).catch(j=>{console.error("Error loading vesting events:",j)}),R(g).catch(j=>{console.error("Error loading roadmap:",j)})]).catch(()=>{});const[ae,oe,le,ue,ve,xs,Fe,ms,hs,gs,us,ps,Qe]=await Promise.all([f.from("employees").select("id",{count:"exact",head:!0}).eq("company_id",g).eq("employment_status","active"),f.from("incentive_plans").select("id",{count:"exact",head:!0}).eq("company_id",g).eq("status","active"),f.from("grants").select("id",{count:"exact",head:!0}).eq("company_id",g).eq("status","active"),f.from("grants").select("total_shares").eq("company_id",g).eq("status","active"),f.from("market_data").select("closing_price").eq("tadawul_symbol",(K==null?void 0:K.tadawul_symbol)||"4084").order("trading_date",{ascending:!1}).limit(1).maybeSingle(),f.from("companies").select("available_shares, tadawul_symbol, current_fmv, fmv_source").eq("id",g).maybeSingle(),f.from("grants").select("id",{count:"exact",head:!0}).eq("company_id",g),f.from("grants").select("id",{count:"exact",head:!0}).eq("company_id",g).eq("status","active"),f.from("grants").select("id",{count:"exact",head:!0}).eq("company_id",g).eq("status","pending_signature"),f.from("grants").select("id",{count:"exact",head:!0}).eq("company_id",g).eq("status","cancelled"),f.from("shareholders").select("shares_owned").eq("company_id",g).eq("shareholder_type","employee").eq("is_active",!0),f.from("shareholders").select("shares_owned").eq("company_id",g).eq("is_active",!0),f.from("ltip_pools").select("total_shares_allocated, shares_used, shares_available").eq("company_id",g)]);if(!ae||!oe||!le){console.error("Critical queries failed"),w(!1);return}const vs=((a=ue.data)==null?void 0:a.reduce((j,z)=>j+Number(z.total_shares||0),0))||0,[bs,fs,Je]=await Promise.all([f.from("grants").select("employee_id").eq("company_id",g).eq("status","active"),f.from("grants").select("employee_id, employees!inner(employment_status)").eq("company_id",g).neq("employees.employment_status","active"),f.from("incentive_plans").select("id, total_shares_allocated, shares_granted, shares_available").eq("company_id",g).eq("plan_type","ESOP").eq("status","active")]),ys=new Set(((x=bs.data)==null?void 0:x.map(j=>j.employee_id))||[]).size,js=new Set(((k=fs.data)==null?void 0:k.map(j=>j.employee_id))||[]).size,es=((G=Je.data)==null?void 0:G.map(j=>j.id))||[],Ns=((D=(es.length>0?await f.from("grants").select("total_shares").eq("company_id",g).eq("status","active").in("plan_id",es):{data:[]}).data)==null?void 0:D.reduce((j,z)=>j+Number(z.total_shares||0),0))||0,ws=((u=Je.data)==null?void 0:u.reduce((j,z)=>j+Number(z.total_shares_allocated||0),0))||0,{data:_s}=await f.from("incentive_plans").select("shares_granted, plan_type").eq("company_id",g).like("plan_type","LTIP%"),ss=(_s||[]).reduce((j,z)=>j+Number(z.shares_granted||0),0),Ce=ss>0?ss:0,Oe=((h=Qe.data)==null?void 0:h.reduce((j,z)=>j+Number(z.total_shares_allocated||0),0))||0,Ss=((b=Qe.data)==null?void 0:b.reduce((j,z)=>j+Number(z.shares_used||0),0))||0;console.log("ðŸ“Š Shares Breakdown Debug:",{totalGrants:(($=Fe.data)==null?void 0:$.length)||0,ltipTotalAllocated:Oe,grantedShares:Ce});const ts=Math.max(0,Oe-Ce),{data:Es}=await f.from("grants").select("id, total_shares, vested_shares, remaining_unvested_shares, status, plan_id, incentive_plans!inner(plan_type)").eq("company_id",g).eq("status","active").like("incentive_plans.plan_type","LTIP%"),Te=(Es||[]).filter(j=>j.incentive_plans),ke=Te.reduce((j,z)=>j+Number(z.total_shares||0),0);let be=0,Se=0;if(Te.length>0&&(be=Te.reduce((j,z)=>{const pe=Number(z.vested_shares||0);return j+pe},0),Se=Math.max(0,ke-be),be===0&&ke>0)){const j=Te.map(pe=>pe.id),{data:z}=await f.from("vesting_events").select("grant_id, shares_to_vest, status").in("grant_id",j);if(z){const pe=z.filter(Ee=>Ee.status==="vested"||Ee.status==="transferred"||Ee.status==="exercised").reduce((Ee,Ls)=>Ee+Number(Ls.shares_to_vest||0),0);be=pe,Se=Math.max(0,ke-pe),console.log("ðŸ“Š Calculated from vesting events:",{vestedFromEvents:pe,activeGrantedTotal:ke,unvestedShares:Se})}}console.log("ðŸ“Š Calculated Breakdown:",{granted:Ce,ungranted:ts,vested:be,unvested:Se}),de({granted:Ce,ungranted:ts,vested:be,unvested:Se});const as=((se=us.data)==null?void 0:se.reduce((j,z)=>j+Number(z.shares_owned),0))||0,Be=((te=ps.data)==null?void 0:te.reduce((j,z)=>j+Number(z.shares_owned),0))||0,ls=Be-as,Ie=(Q=ve==null?void 0:ve.data)==null?void 0:Q.closing_price,Ge=Ie!=null?Number(Ie):null,ze=(Z=xs.data)==null?void 0:Z.current_fmv,Ke=ze!=null?Number(ze):null,Ps=Ge!==null&&!Number.isNaN(Ge)?Ge:Ke!==null&&!Number.isNaN(Ke)?Ke:30;console.log("Employee shares total:",as),console.log("Total shares from shareholders:",Be),console.log("Option pool balance:",ls),console.log("Query results:",{employees:ae.count,plans:oe.count,grants:Fe.count}),console.log("Full responses with errors:",{employeesRes:ae,plansRes:oe,activeGrantsRes:le}),A({totalEmployees:ae.count||0,activePlans:oe.count||0,activeGrants:le.count||0,totalShares:vs,currentFMV:Ps,optionPoolBalance:ls,totalGrants:Fe.count||0,grantsAccepted:ms.count||0,grantsPending:hs.count||0,grantsRejected:gs.count||0,activeESOPEmployees:ys,inactiveESOPEmployees:js,equityPoolSize:Be,esopTotalAllocated:ws,esopTotalShares:Ns,ltipTotalAllocated:Oe,ltipTotalShares:Ss}),w(!1)}else w(!1)}catch(g){console.error("Error loading dashboard data:",g),w(!1)}finally{E.current=!1}},[N,V,m]);n.useEffect(()=>{H&&!C.current&&B()},[H,B]),n.useEffect(()=>{H&&(m==null?void 0:m.company_id)!==H&&C.current!==H&&B()},[H,m==null?void 0:m.company_id,B]),n.useEffect(()=>{if(m!=null&&m.company_id){const a=setTimeout(()=>{Y(m.company_id)},300);return()=>clearTimeout(a)}},[m==null?void 0:m.company_id]);const L=async a=>{try{console.log("ðŸ” Loading vesting events for company:",a),await cs();const x=await $s(a,20);console.log("ðŸ“… Loaded vesting events:",x.length),console.log("ðŸŽ¯ Events data:",x),M(x),await q(a),await Y(a)}catch(x){console.error("Error loading vesting events:",x),M([])}},q=async a=>{try{console.log("ðŸ” Loading due vesting events for company:",a);const{data:x,error:k}=await f.from("vesting_events").select(`
          *,
          employees (
            id,
            first_name_en,
            first_name_ar,
            last_name_en,
            last_name_ar
          ),
          grants (
            id,
            total_shares,
            vested_shares,
            plan_id,
            incentive_plans (
              plan_name_en,
              plan_code,
              plan_type
            )
          )
        `).eq("company_id",a).eq("status","due").order("vesting_date",{ascending:!0}).limit(10);if(k)throw k;console.log("ðŸ“Š Raw due events from database:",x);const G=new Date,D=(x||[]).filter(b=>new Date(b.vesting_date)>G);D.length>0&&console.warn("âš ï¸ Found events marked as due but with future vesting dates:",D);const h=(x||[]).filter(b=>new Date(b.vesting_date)<=G).map(b=>{var Q,Z,g,K,re,ae,oe,le,ue,ve;const $=new Date(b.vesting_date),se=Math.ceil(($.getTime()-G.getTime())/(1e3*60*60*24)),te=((Z=(Q=b.grants)==null?void 0:Q.incentive_plans)==null?void 0:Z.plan_type)||"LTIP_RSU";return{...b,employee_name:`${((g=b.employees)==null?void 0:g.first_name_en)||((K=b.employees)==null?void 0:K.first_name_ar)||"Unknown"} ${((re=b.employees)==null?void 0:re.last_name_en)||((ae=b.employees)==null?void 0:ae.last_name_ar)||"Employee"}`,plan_name:((le=(oe=b.grants)==null?void 0:oe.incentive_plans)==null?void 0:le.plan_name_en)||"Unknown Plan",plan_code:((ve=(ue=b.grants)==null?void 0:ue.incentive_plans)==null?void 0:ve.plan_code)||"N/A",plan_type:te,days_remaining:se,can_exercise:te==="ESOP"&&b.status==="vested",requires_exercise:te==="ESOP"}});console.log("âœ… Filtered due events (only actually due):",h),l(h)}catch(x){console.error("Error loading due vesting events:",x),l([])}},Y=async a=>{try{console.log("ðŸ“… Loading calendar vesting events for company:",a);const{data:x,error:k}=await f.from("vesting_events").select(`
          *,
          employees (
            id,
            first_name_en,
            first_name_ar,
            last_name_en,
            last_name_ar
          ),
          grants (
            id,
            total_shares,
            vested_shares,
            plan_id,
            incentive_plans (
              plan_name_en,
              plan_code,
              plan_type
            )
          )
        `).eq("company_id",a).gte("vesting_date",new Date().toISOString().split("T")[0]).order("vesting_date",{ascending:!0}).limit(100);if(k)throw k;const G=(x||[]).map(D=>{var se,te,Q,Z,g,K,re,ae,oe,le;const u=new Date(D.vesting_date),h=new Date,b=Math.ceil((u.getTime()-h.getTime())/(1e3*60*60*24)),$=((te=(se=D.grants)==null?void 0:se.incentive_plans)==null?void 0:te.plan_type)||"LTIP_RSU";return{...D,employee_name:`${((Q=D.employees)==null?void 0:Q.first_name_en)||((Z=D.employees)==null?void 0:Z.first_name_ar)||"Unknown"} ${((g=D.employees)==null?void 0:g.last_name_en)||((K=D.employees)==null?void 0:K.last_name_ar)||"Employee"}`,plan_name:((ae=(re=D.grants)==null?void 0:re.incentive_plans)==null?void 0:ae.plan_name_en)||"Unknown Plan",plan_code:((le=(oe=D.grants)==null?void 0:oe.incentive_plans)==null?void 0:le.plan_code)||"N/A",plan_type:$,days_remaining:b,can_exercise:$==="ESOP"&&D.status==="vested",requires_exercise:$==="ESOP"}});console.log("ðŸ“… Loaded calendar events:",G.length),I(G)}catch(x){console.error("Error loading calendar vesting events:",x),I([])}},R=async a=>{try{const{data:x}=await f.from("companies").select("current_fmv").eq("id",a).single(),k=(x==null?void 0:x.current_fmv)||30,{data:G,error:D}=await f.from("vesting_events").select(`
          *,
          grants (
            id,
            total_shares,
            vested_shares
          )
        `).eq("company_id",a).order("vesting_date",{ascending:!0});if(D)throw D;const u=new Date().getFullYear(),h=[];for(let $=u;$<u+5;$++)h.push({year:String($),unvestedShares:0,unvestedValuation:0,vestedShares:0,vestedValuation:0});const b=new Date;b.setHours(0,0,0,0),(G||[]).forEach($=>{const se=new Date($.vesting_date),te=se.getFullYear(),Q=Number($.shares_to_vest||0);if(Q<=0)return;const Z=h.findIndex(g=>parseInt(g.year)===te);Z>=0&&(se<b||$.status==="vested"||$.status==="transferred"||$.status==="exercised"||$.status==="due"?(h[Z].vestedShares+=Q,h[Z].vestedValuation+=Q*k):$.status!=="lapsed"&&(h[Z].unvestedShares+=Q,h[Z].unvestedValuation+=Q*k))}),ne(h)}catch(x){console.error("Error loading roadmap data:",x),ne([])}},ee=a=>{ie(a),P(!0)},he=n.useMemo(()=>[{name:"Active Employees",value:o.totalEmployees,icon:Le,change:"+12%",changeType:"increase",color:"blue",tooltip:"Total number of employees with active employment status in the system"},{name:"Active Plans",value:o.activePlans,icon:Ae,change:"+3",changeType:"increase",color:"green",tooltip:"Number of currently active LTIP or ESOP plans in your company"},{name:"Shares Granted",value:o.totalShares.toLocaleString(),icon:we,change:"+8%",changeType:"increase",color:"orange",tooltip:"Total number of shares granted to employees across all active grants"},{name:"Current FMV",value:`SAR ${o.currentFMV.toFixed(2)}`,icon:Xe,change:"+2.5%",changeType:"increase",color:"emerald",tooltip:"Fair Market Value - The latest closing price from Tadawul stock exchange"},{name:"Equity Pool Size",value:o.equityPoolSize.toLocaleString(),icon:fe,change:"0%",changeType:"increase",color:"violet",tooltip:"Total LTIP shares used across all pools compared to the overall LTIP allocation"},{name:"Options Pool Used",value:o.optionPoolBalance.toLocaleString(),icon:fe,change:"-5%",changeType:"decrease",color:"sky",tooltip:"Total ESOP options used across the ESOP plan compared to the available pool"},{name:"Total Grants",value:o.totalGrants,icon:qe,change:"+15",changeType:"increase",color:"purple",tooltip:"Total number of equity grants issued to employees, regardless of status"},{name:"Grants Accepted",value:o.grantsAccepted,icon:ns,change:"+8",changeType:"increase",color:"teal",tooltip:"Number of grants that have been accepted and signed by employees"},{name:"Grants Pending",value:o.grantsPending,icon:We,change:"+3",changeType:"increase",color:"amber",tooltip:"Number of grants awaiting employee signature and acceptance"},{name:"Grants Rejected",value:o.grantsRejected,icon:Vs,change:"+1",changeType:"increase",color:"red",tooltip:"Number of grants that have been cancelled or rejected"},{name:"Active ESOP Employees",value:o.activeESOPEmployees,icon:As,change:"+7",changeType:"increase",color:"cyan",tooltip:"Number of currently employed individuals with active equity grants"},{name:"Inactive ESOP Employees",value:o.inactiveESOPEmployees,icon:qs,change:"+2",changeType:"increase",color:"gray",tooltip:"Number of former employees who had equity grants (terminated, resigned, or retired)"}],[o]),ce={blue:"bg-blue-500",green:"bg-green-500",purple:"bg-purple-500",orange:"bg-orange-500",teal:"bg-teal-500",red:"bg-red-500",cyan:"bg-cyan-500",gray:"bg-gray-500",emerald:"bg-emerald-500",violet:"bg-violet-500",sky:"bg-sky-500",amber:"bg-amber-500"};if(y)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(V()&&!H)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s("dashboard.title")}),e.jsx("p",{className:"text-gray-600 mt-1",children:s("dashboard.welcome")})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-8 text-center",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx(ge,{className:"w-12 h-12 text-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a Company"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"As a super admin, please select a company from the dropdown in the header to view its dashboard."}),e.jsxs("p",{className:"text-sm text-gray-500",children:["You can also access the ",e.jsx("a",{href:"/operator/companies",className:"text-blue-600 hover:underline",children:"Operator Console"})," to manage all companies."]})]})})]});if(!m){const a=!r||!r.company_id;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s("dashboard.title")}),e.jsx("p",{className:"text-gray-600 mt-1",children:s("dashboard.welcome")})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-8 text-center",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx(De,{className:"w-12 h-12 text-yellow-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:a?"Account Setup Incomplete":"No Company Data Available"}),e.jsx("p",{className:"text-gray-600 mb-4",children:a?"Your account was created but is not yet linked to a company. This may happen if you just signed up. Please try refreshing the page or contact support if the issue persists.":"Unable to load company information. Please contact support if this issue persists."}),a&&e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Refresh Page"})]})})]})}return e.jsxs("div",{className:`space-y-6 w-full max-w-full overflow-x-hidden ${p?"text-right":"text-left"}`,children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s("dashboard.title")}),e.jsx("p",{className:"text-gray-600 mt-1",children:s("dashboard.welcome")})]}),m&&e.jsx("div",{className:"rounded-xl p-6 text-white",style:{background:`linear-gradient(to right, ${S}, ${O("700")})`},children:e.jsxs("div",{className:`flex items-center justify-between ${p?"flex-row-reverse":""}`,children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:(X=m.companies)==null?void 0:X.company_name_en}),e.jsxs("p",{className:"mt-1 opacity-90",children:[s("dashboard.tadawul"),": ",(W=m.companies)==null?void 0:W.tadawul_symbol]})]}),e.jsxs("div",{className:p?"text-left":"text-right",children:[e.jsx("p",{className:"text-sm opacity-90",children:s("dashboard.verificationStatus")}),e.jsx("span",{className:"inline-block mt-1 px-3 py-1 bg-white/20 rounded-full text-sm font-medium",children:(xe=m.companies)==null?void 0:xe.verification_status})]})]})}),e.jsxs("div",{className:"space-y-10",children:[e.jsx(Hs,{}),e.jsx(Fs,{}),e.jsx(Bs,{})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 hover:shadow-lg transition",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-violet-500",children:e.jsx(fe,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:s("dashboard.equityPoolSize")}),e.jsxs("div",{className:"group relative",children:[e.jsx(ge,{className:"w-4 h-4 text-gray-400 cursor-help"}),e.jsx("div",{className:`absolute ${p?"right-0":"left-0"} top-6 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10 shadow-lg`,children:s("dashboard.equityPoolSizeTooltip")})]})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:[o.equityPoolSize.toLocaleString()," / ",o.ltipTotalAllocated.toLocaleString()]})]})]})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600",children:s("dashboard.usedVsTotalPool")}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[o.ltipTotalAllocated>0?(o.ltipTotalShares/o.ltipTotalAllocated*100).toFixed(1):0,"% ",s("dashboard.used")]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-violet-500 to-purple-600 h-3 rounded-full transition-all duration-500",style:{width:`${o.ltipTotalAllocated>0?Math.min(o.ltipTotalShares/o.ltipTotalAllocated*100,100):0}%`}})}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-2",children:[e.jsxs("span",{children:[o.ltipTotalShares.toLocaleString()," ",s("dashboard.sharesUsed")]}),e.jsxs("span",{children:[o.ltipTotalAllocated.toLocaleString()," ",s("dashboard.totalPool")]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 hover:shadow-lg transition",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-indigo-500",children:e.jsx(fe,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Used Shares Breakdown"}),e.jsxs("div",{className:"group relative",children:[e.jsx(ge,{className:"w-4 h-4 text-gray-400 cursor-help"}),e.jsx("div",{className:"absolute left-0 top-6 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10 shadow-lg",children:"Breakdown of used shares showing granted vs ungranted, and vested vs unvested"})]})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:[c.granted.toLocaleString()," / ",o.ltipTotalAllocated.toLocaleString()]})]})]})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-3",children:[e.jsx("span",{className:"text-gray-600",children:s("dashboard.breakdownOfUsedShares")}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[o.ltipTotalAllocated>0?(c.granted/o.ltipTotalAllocated*100).toFixed(1):0,"% ",s("dashboard.granted")]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 mb-4 overflow-hidden",children:e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-indigo-600 transition-all duration-500",style:{width:`${o.ltipTotalAllocated>0?Math.min(c.granted/o.ltipTotalAllocated*100,100):0}%`},title:`Granted: ${c.granted.toLocaleString()}`}),e.jsx("div",{className:"bg-gradient-to-r from-gray-300 to-gray-400 transition-all duration-500",style:{width:`${o.ltipTotalAllocated>0?Math.min(c.ungranted/o.ltipTotalAllocated*100,100):0}%`},title:`Ungranted: ${c.ungranted.toLocaleString()}`})]})}),e.jsx("div",{className:"w-full bg-gray-100 rounded-full h-3 mb-4 overflow-hidden",children:e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 transition-all duration-500",style:{width:`${c.granted>0?Math.min(c.vested/c.granted*100,100):0}%`},title:`Vested: ${c.vested.toLocaleString()}`}),e.jsx("div",{className:"bg-gradient-to-r from-amber-500 to-amber-600 transition-all duration-500",style:{width:`${c.granted>0?Math.min(c.unvested/c.granted*100,100):0}%`},title:`Unvested: ${c.unvested.toLocaleString()}`})]})}),e.jsxs("div",{className:`grid grid-cols-2 gap-3 text-xs ${p?"text-right":"text-left"}`,children:[e.jsxs("div",{className:`flex items-center gap-2 ${p?"flex-row-reverse":""}`,children:[e.jsx("div",{className:"w-3 h-3 rounded bg-indigo-500"}),e.jsxs("span",{className:"text-gray-600",children:[s("dashboard.grantedLabel"),": ",c.granted.toLocaleString()]})]}),e.jsxs("div",{className:`flex items-center gap-2 ${p?"flex-row-reverse":""}`,children:[e.jsx("div",{className:"w-3 h-3 rounded bg-gray-400"}),e.jsxs("span",{className:"text-gray-600",children:[s("dashboard.ungranted"),": ",c.ungranted.toLocaleString()]})]}),e.jsxs("div",{className:`flex items-center gap-2 ${p?"flex-row-reverse":""}`,children:[e.jsx("div",{className:"w-3 h-3 rounded bg-green-500"}),e.jsxs("span",{className:"text-gray-600",children:[s("dashboard.vested"),": ",c.vested.toLocaleString()]})]}),e.jsxs("div",{className:`flex items-center gap-2 ${p?"flex-row-reverse":""}`,children:[e.jsx("div",{className:"w-3 h-3 rounded bg-amber-500"}),e.jsxs("span",{className:"text-gray-600",children:[s("dashboard.unvested"),": ",c.unvested.toLocaleString()]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 hover:shadow-lg transition",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-500",children:e.jsx(fe,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:s("dashboard.usedSharesBreakdown")}),e.jsxs("div",{className:"group relative",children:[e.jsx(ge,{className:"w-4 h-4 text-gray-400 cursor-help"}),e.jsx("div",{className:`absolute ${p?"right-0":"left-0"} top-6 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10 shadow-lg`,children:s("dashboard.usedSharesBreakdownTooltip")})]})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:[c.granted.toLocaleString()," / ",o.ltipTotalAllocated.toLocaleString()]})]})]})}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:s("dashboard.grantedVsUngranted")}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[o.ltipTotalAllocated>0?(c.granted/o.ltipTotalAllocated*100).toFixed(1):0,"% ",s("dashboard.granted")]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:"bg-purple-500 transition-all duration-500 flex items-center justify-end pr-2",style:{width:`${o.ltipTotalAllocated>0?Math.min(c.granted/o.ltipTotalAllocated*100,100):0}%`},children:e.jsx("span",{className:"text-xs font-semibold text-white",children:c.granted>0?c.granted.toLocaleString():""})}),e.jsx("div",{className:"bg-gray-400 transition-all duration-500 flex items-center pl-2",style:{width:`${o.ltipTotalAllocated>0?Math.min(c.ungranted/o.ltipTotalAllocated*100,100):0}%`},children:e.jsx("span",{className:"text-xs font-semibold text-white",children:c.ungranted>0?c.ungranted.toLocaleString():""})})]})}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-1",children:[e.jsxs("span",{children:[s("dashboard.grantedLabel"),": ",c.granted.toLocaleString()]}),e.jsxs("span",{children:[s("dashboard.ungranted"),": ",c.ungranted.toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:s("dashboard.vestedVsUnvested")}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[c.granted>0?(c.vested/c.granted*100).toFixed(1):0,"% ",s("dashboard.vested").toLowerCase()]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:"bg-green-500 transition-all duration-500 flex items-center justify-end pr-2",style:{width:`${c.granted>0?Math.min(c.vested/c.granted*100,100):0}%`},children:e.jsx("span",{className:"text-xs font-semibold text-white",children:c.vested>0?c.vested.toLocaleString():""})}),e.jsx("div",{className:"bg-orange-500 transition-all duration-500 flex items-center pl-2",style:{width:`${c.granted>0?Math.min(c.unvested/c.granted*100,100):0}%`},children:e.jsx("span",{className:"text-xs font-semibold text-white",children:c.unvested>0?c.unvested.toLocaleString():""})})]})}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-1",children:[e.jsxs("span",{children:[s("dashboard.vested"),": ",c.vested.toLocaleString()]}),e.jsxs("span",{children:[s("dashboard.unvested"),": ",c.unvested.toLocaleString()]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-5 border border-gray-200 hover:shadow-lg transition",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-sky-500",children:e.jsx(fe,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:s("dashboard.optionsPoolUsed")}),e.jsxs("div",{className:"group relative",children:[e.jsx(ge,{className:"w-4 h-4 text-gray-400 cursor-help"}),e.jsx("div",{className:`absolute ${p?"right-0":"left-0"} top-6 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10 shadow-lg`,children:s("dashboard.optionsPoolUsedTooltip")})]})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:[o.optionPoolBalance.toLocaleString()," / ",o.esopTotalAllocated.toLocaleString()]})]})]})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600",children:s("dashboard.usedVsAvailable")}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[o.esopTotalAllocated>0?(o.esopTotalShares/o.esopTotalAllocated*100).toFixed(1):0,"% ",s("dashboard.used")]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-sky-500 to-blue-600 h-3 rounded-full transition-all duration-500",style:{width:`${o.esopTotalAllocated>0?Math.min(o.esopTotalShares/o.esopTotalAllocated*100,100):0}%`}})}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-2",children:[e.jsxs("span",{children:[o.esopTotalShares.toLocaleString()," ",s("dashboard.sharesUsed")]}),e.jsxs("span",{children:[o.esopTotalAllocated.toLocaleString()," ",s("dashboard.totalPool")]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:he.filter(a=>a.name!=="Current FMV"&&a.name!=="Equity Pool Size"&&a.name!=="Options Pool Used").slice(0,2).map(a=>e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-200 hover:shadow-lg transition",children:[e.jsx("div",{className:"flex items-center mb-3",children:e.jsx("div",{className:`p-2 rounded-lg ${ce[a.color]}`,children:e.jsx(a.icon,{className:"w-5 h-5 text-white"})})}),e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:a.name}),e.jsxs("div",{className:"group relative",children:[e.jsx(ge,{className:"w-4 h-4 text-gray-400 cursor-help"}),e.jsx("div",{className:"absolute left-0 top-6 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10 shadow-lg",children:a.tooltip})]})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.value})]},a.name))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-200 hover:shadow-lg transition",children:[e.jsx("div",{className:"flex items-center mb-3",children:e.jsx("div",{className:"p-2 rounded-lg bg-emerald-500",children:e.jsx(Xe,{className:"w-5 h-5 text-white"})})}),e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:s("dashboard.currentFMV")}),e.jsxs("div",{className:"group relative",children:[e.jsx(ge,{className:"w-4 h-4 text-gray-400 cursor-help"}),e.jsx("div",{className:`absolute ${p?"right-0":"left-0"} top-6 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10 shadow-lg`,children:s("dashboard.currentFMVTooltip")})]})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["SAR ",o.currentFMV.toFixed(2)]})]}),he.filter(a=>a.name!=="Current FMV"&&a.name!=="Equity Pool Size"&&a.name!=="Options Pool Used").slice(2).map(a=>e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-200 hover:shadow-lg transition",children:[e.jsx("div",{className:"flex items-center mb-3",children:e.jsx("div",{className:`p-2 rounded-lg ${ce[a.color]}`,children:e.jsx(a.icon,{className:"w-5 h-5 text-white"})})}),e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:a.name}),e.jsxs("div",{className:"group relative",children:[e.jsx(ge,{className:"w-4 h-4 text-gray-400 cursor-help"}),e.jsx("div",{className:"absolute left-0 top-6 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10 shadow-lg",children:a.tooltip})]})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.value})]},a.name))]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:s("dashboard.recentActivity")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`flex items-center space-x-4 p-4 bg-gray-50 rounded-lg ${p?"space-x-reverse":""}`,children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(qe,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s("dashboard.newGrantIssued")}),e.jsxs("p",{className:"text-xs text-gray-500",children:["2 ",s("dashboard.hoursAgo")]})]})]}),e.jsxs("div",{className:`flex items-center space-x-4 p-4 bg-gray-50 rounded-lg ${p?"space-x-reverse":""}`,children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(Le,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["25 ",s("dashboard.employeesAdded")]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["1 ",s("dashboard.daysAgo")]})]})]}),e.jsxs("div",{className:`flex items-center space-x-4 p-4 bg-gray-50 rounded-lg ${p?"space-x-reverse":""}`,children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(Ae,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s("dashboard.newLTIPPlanCreated")}),e.jsxs("p",{className:"text-xs text-gray-500",children:["3 ",s("dashboard.daysAgo")]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:`flex items-center justify-between mb-4 ${p?"flex-row-reverse":""}`,children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:s("dashboard.upcomingVestingEvents")}),e.jsxs("div",{className:`flex items-center gap-2 ${p?"flex-row-reverse":""}`,children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[s("dashboard.nextOf")," 3 ",s("dashboard.of")," ",_.length]}),_.length>3&&e.jsx("button",{onClick:()=>window.location.href="/dashboard/vesting-events",className:"px-3 py-1 text-xs font-medium bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 transition",children:s("dashboard.more")})]})]}),_.length>0?e.jsx("div",{className:"space-y-3",children:_.slice(0,3).map(a=>{var h;const x=a.event_type==="cliff",k=x?"border-orange-500":"border-blue-500",G=x?"bg-orange-50":"bg-blue-50",D=x?"bg-orange-100 text-orange-800":"bg-blue-100 text-blue-800",u=a.status==="due"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800";return e.jsx("div",{className:`p-4 border-l-4 ${k} ${G} rounded-r-lg`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:a.employee_name}),e.jsx("button",{onClick:()=>ee(a),className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800 hover:bg-blue-200 transition cursor-pointer",children:Ve(a.id,a.sequence_number,a.vesting_date,((h=a.grants)==null?void 0:h.grant_number)??a.grant_id).displayId}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${D}`,children:s(x?"dashboard.cliff":"dashboard.vesting")}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${u}`,children:a.status.charAt(0).toUpperCase()+a.status.slice(1)}),a.requires_exercise&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-purple-100 text-purple-800",children:"ESOP"})]}),e.jsxs("p",{className:"text-xs text-gray-600 mb-1",children:[Math.floor(a.shares_to_vest).toLocaleString()," ",s("dashboard.shares")," â€¢ ",a.plan_name," (",a.plan_code,")"]}),a.exercise_price&&e.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:[s("dashboard.exercisePrice"),": $",a.exercise_price.toFixed(2)," â€¢ ",s("dashboard.totalCost"),": $",(a.shares_to_vest*a.exercise_price).toFixed(2)]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-gray-500",children:Pe(a.vesting_date)}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:Re(a.days_remaining)})]})]})})},a.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(We,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-500",children:s("dashboard.noUpcomingVestingEvents")}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:s("dashboard.noUpcomingVestingEventsDesc")})]}),_.length>3&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 text-center",children:e.jsxs("button",{onClick:()=>window.location.href="/dashboard/vesting-events",className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:[s("dashboard.viewAllUpcomingEvents")," ",_.length," ",s("dashboard.upcomingEvents")," â†’"]})})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:`flex items-center justify-between mb-4 ${p?"flex-row-reverse":""}`,children:[e.jsxs("div",{className:`flex items-center gap-2 ${p?"flex-row-reverse":""}`,children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:s("dashboard.vestingEventsDue")}),d.length>0&&e.jsxs("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800",children:[d.length," ",s("dashboard.dueNow")]})]}),e.jsx("span",{className:"text-sm text-gray-500",children:s("dashboard.requiresImmediateAttention")})]}),d.length>0?e.jsx("div",{className:"space-y-3",children:d.map(a=>{var u;const x=a.event_type==="cliff",k="border-red-500",G="bg-red-50",D=x?"bg-orange-100 text-orange-800":"bg-blue-100 text-blue-800";return e.jsx("div",{className:`p-4 border-l-4 ${k} ${G} rounded-r-lg`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:a.employee_name}),e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800",children:Ve(a.id,a.sequence_number,a.vesting_date,((u=a.grants)==null?void 0:u.grant_number)??a.grant_id).displayId}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${D}`,children:x?"Cliff":"Vesting"}),e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800",children:"DUE NOW"}),a.requires_exercise&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-purple-100 text-purple-800",children:"ESOP"})]}),e.jsxs("p",{className:"text-xs text-gray-600 mb-1",children:[Math.floor(a.shares_to_vest).toLocaleString()," shares â€¢ ",a.plan_name," (",a.plan_code,")"]}),a.exercise_price&&e.jsxs("p",{className:"text-xs text-gray-500 mb-1",children:["Exercise Price: $",a.exercise_price.toFixed(2)," â€¢ Total Cost: $",(a.shares_to_vest*a.exercise_price).toFixed(2)]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-gray-500",children:Pe(a.vesting_date)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-red-600",children:Re(a.days_remaining)}),e.jsx("button",{onClick:()=>ee(a),className:"px-3 py-1 text-xs font-medium bg-blue-600 text-white rounded-md hover:bg-blue-700 transition",children:"View Details"})]})]})]})})},a.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ns,{className:"w-12 h-12 text-green-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No vesting events due"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"All vesting events are up to date"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm mb-6 overflow-hidden",children:[e.jsxs("div",{className:"p-4 sm:p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-gray-900",children:"Shares Roadmap"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-1",children:"Company-wide vesting schedule overview"})]}),e.jsx("div",{className:"p-3 sm:p-6 overflow-x-auto",children:J&&J.length>0?e.jsxs("div",{className:"space-y-4 min-w-[600px] sm:min-w-0",children:[e.jsx("div",{className:"flex items-end justify-between gap-2 sm:gap-3",style:{height:"200px",minHeight:"200px"},children:J.map((a,x)=>{const k=Math.max(...J.map(te=>(te.unvestedValuation||0)+(te.vestedValuation||0)),1),G=(a.unvestedValuation||0)+(a.vestedValuation||0),u=k>0?G/k*200:0,h=G>0?(a.vestedValuation||0)/G*u:0,b=u-h,$=h>0?Math.max(h,4):0,se=b>0?Math.max(b,4):0;return e.jsxs("div",{className:"flex-1 h-full flex flex-col items-center group cursor-pointer relative",children:[e.jsxs("div",{className:"hidden group-hover:block absolute bottom-full mb-2 bg-gray-900 text-white text-xs rounded-lg px-2 sm:px-3 py-2 shadow-lg z-10 whitespace-nowrap transform -translate-x-1/2 left-1/2",children:[e.jsx("div",{className:"font-semibold mb-1",children:a.year}),a.vestedValuation>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-green-300",children:["â€¢ Vested Valuation: ",e.jsxs("strong",{children:["SAR ",a.vestedValuation.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"text-green-300",children:["â€¢ Vested Shares: ",e.jsx("strong",{children:a.vestedShares.toLocaleString()})]})]}),a.unvestedValuation>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-purple-300",children:["â€¢ Unvested Valuation: ",e.jsxs("strong",{children:["SAR ",a.unvestedValuation.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"text-purple-300",children:["â€¢ Unvested Shares: ",e.jsx("strong",{children:a.unvestedShares.toLocaleString()})]})]}),G===0&&e.jsx("div",{className:"text-gray-400",children:"No shares in this period"})]}),e.jsxs("div",{className:"relative w-full h-full flex flex-col items-center justify-end",children:[(a.unvestedShares>0||a.vestedShares>0)&&e.jsx("div",{className:"absolute text-[10px] sm:text-xs font-semibold text-gray-700 whitespace-nowrap",style:{bottom:`${u+4}px`,left:"50%",transform:"translateX(-50%)"},children:(a.unvestedShares+a.vestedShares).toLocaleString()}),se>0&&e.jsx("div",{className:"w-full bg-gradient-to-t from-purple-600 to-purple-500 rounded-t-lg transition-all duration-300 group-hover:from-purple-700 group-hover:to-purple-600 group-hover:shadow-lg",style:{height:`${se}px`}}),$>0&&e.jsx("div",{className:"w-full bg-gradient-to-t from-green-600 to-green-500 transition-all duration-300 group-hover:from-green-700 group-hover:to-green-600 group-hover:shadow-lg",style:{height:`${$}px`,borderRadius:se===0?"0.5rem 0.5rem 0 0":"0"}})]})]},x)})}),e.jsx("div",{className:"flex items-center justify-between gap-2 sm:gap-3 mt-2 border-t border-gray-200 pt-3",children:J.map((a,x)=>e.jsx("div",{className:"flex-1 text-center",children:e.jsx("div",{className:"text-xs sm:text-sm text-gray-600 font-medium",children:a.year})},x))}),e.jsxs("div",{className:"mt-3 sm:mt-4 pt-3 sm:pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-2 sm:gap-4 text-xs text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-green-600 flex-shrink-0"}),e.jsx("span",{children:"Vested Shares (SAR)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-purple-600 flex-shrink-0"}),e.jsx("span",{children:"Unvested Shares (SAR)"})]})]}),e.jsxs("div",{className:"text-[10px] sm:text-xs text-gray-500 text-center space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Vested includes:"})," vested, transferred, exercised, due, and past-dated events"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Unvested includes:"})," pending and future-dated events"]})]})]})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(we,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No roadmap data available"})]})})]}),e.jsxs("div",{className:"mb-6 w-full max-w-full overflow-hidden",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"Vesting Events Calendar"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Visual timeline of upcoming vesting events"})]}),e.jsx("div",{className:"w-full max-w-full overflow-hidden",children:e.jsx(Us,{events:T,onEventClick:ee})})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Quick Actions"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("button",{className:"flex items-center space-x-3 p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition group",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 group-hover:bg-blue-200 rounded-lg flex items-center justify-center transition",children:e.jsx(Ae,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Create New Plan"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Define LTIP/ESOP parameters"})]})]}),e.jsxs("button",{className:"flex items-center space-x-3 p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition group",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 group-hover:bg-green-200 rounded-lg flex items-center justify-center transition",children:e.jsx(Le,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Import Employees"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Bulk upload via CSV"})]})]}),e.jsxs("button",{className:"flex items-center space-x-3 p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition group",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 group-hover:bg-purple-200 rounded-lg flex items-center justify-center transition",children:e.jsx(qe,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Issue Grants"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Allocate shares to employees"})]})]})]})]}),F&&i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Vesting Event Details"}),e.jsx("p",{className:"text-gray-600",children:Ve(i.id,i.sequence_number,i.vesting_date,((me=i.grants)==null?void 0:me.grant_number)??i.grant_id).displayId})]}),e.jsx("button",{onClick:()=>P(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(Ds,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-3",children:"Event Information"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Employee:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:i.employee_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Event Type:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:i.event_type.replace("_"," ").toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Vesting Date:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:Pe(i.vesting_date)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Status:"}),e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800",children:i.status.toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Days Remaining:"}),e.jsx("span",{className:"text-sm font-medium text-red-600",children:Re(i.days_remaining)})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-3",children:"Shares & Financial"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Shares to Vest:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:Math.floor(i.shares_to_vest).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Plan:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[i.plan_name," (",i.plan_code,")"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Plan Type:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:i.plan_type})]}),i.exercise_price&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Exercise Price:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["$",i.exercise_price.toFixed(2)," per share"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Exercise Cost:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["$",(i.shares_to_vest*i.exercise_price).toFixed(2)]})]})]})]})]}),i.status==="due"&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-3",children:"Action Required"}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(De,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"This vesting event is due and requires processing"}),e.jsx("p",{className:"text-xs text-red-600 mt-1",children:i.requires_exercise?"Employee needs to exercise options to receive shares":"Shares should be transferred to employee portfolio"})]})]})})]}),i.status!=="due"&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-3",children:"Status Information"}),e.jsx("div",{className:`border rounded-lg p-4 ${i.status==="pending"?"bg-blue-50 border-blue-200":i.status==="vested"?"bg-green-50 border-green-200":(i.status==="exercised"||i.status==="transferred","bg-gray-50 border-gray-200")}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ge,{className:`w-5 h-5 mt-0.5 ${i.status==="pending"?"text-blue-600":i.status==="vested"?"text-green-600":"text-gray-600"}`}),e.jsxs("div",{children:[e.jsxs("p",{className:`text-sm font-medium ${i.status==="pending"?"text-blue-800":i.status==="vested"?"text-green-800":"text-gray-800"}`,children:[i.status==="pending"&&"This vesting event is scheduled for the future",i.status==="vested"&&"This vesting event has been processed and shares are vested",i.status==="exercised"&&"This ESOP event has been exercised by the employee",i.status==="transferred"&&"These shares have been transferred to the employee portfolio",!["pending","vested","exercised","transferred"].includes(i.status)&&"Event status information"]}),e.jsxs("p",{className:`text-xs mt-1 ${i.status==="pending"?"text-blue-600":i.status==="vested"?"text-green-600":"text-gray-600"}`,children:[i.status==="pending"&&`Vesting date: ${Pe(i.vesting_date)}`,i.status==="vested"&&"No further action required",(i.status==="exercised"||i.status==="transferred")&&"Transaction completed"]})]})]})})]})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>P(!1),className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"Close"}),i.status==="due"&&e.jsx("button",{onClick:()=>{window.location.href="/dashboard/vesting-events"},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Process in Vesting Events"})]})]})})]})}export{Js as default};
